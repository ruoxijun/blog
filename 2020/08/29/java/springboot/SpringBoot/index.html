<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>SpringBoot | ruoxijun</title><meta name="keywords" content="springboot,swagger,druid"><meta name="author" content="ruoxijun,1460662245@qq.com"><meta name="copyright" content="ruoxijun"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="SpringBoot"><meta name="application-name" content="SpringBoot"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="SpringBoot"><meta property="og:url" content="http://ruoxijun.top/2020/08/29/java/springboot/SpringBoot/index.html"><meta property="og:site_name" content="ruoxijun"><meta property="og:description" content="SpringBoot SpringBoot 简化了 Spring 应用开发，约定大于配置，去繁从简，just run 就能创建一个独立的，产品级别的应用。 SpringBoot2 要求 java8 及以上， maven3.3 及以上。（查看方式：java -version，mvn -v） 参考文档："><meta property="og:locale" content="en"><meta property="og:image" content="https://www.ruoxijun.top/getRandomImageR2?_r_=99c9522a-1d3c-dfe0-72d7-dd2ed0d12255"><meta property="article:author" content="ruoxijun"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.ruoxijun.top/getRandomImageR2?_r_=99c9522a-1d3c-dfe0-72d7-dd2ed0d12255"><meta name="description" content="SpringBoot SpringBoot 简化了 Spring 应用开发，约定大于配置，去繁从简，just run 就能创建一个独立的，产品级别的应用。 SpringBoot2 要求 java8 及以上， maven3.3 及以上。（查看方式：java -version，mvn -v） 参考文档："><link rel="shortcut icon" href="/images/favicon.svg"><link rel="canonical" href="http://ruoxijun.top/2020/08/29/java/springboot/SpringBoot/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//static.cloudflareinsights.com"/><link rel="preconnect" href="//www.clarity.ms"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?b3a933e91b357919bc48b2dcf700920b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-7JZFCVWT7S"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-7JZFCVWT7S');
</script><script defer="defer" data-pjax="data-pjax" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;dddccd3510d7456c85b636b70477a196&quot;}"></script><script>(function(c,l,a,r,i,t,y){
    c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
    t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
    y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
})(window, document, "clarity", "script", "imlr52l3x8");</script><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'http://43.142.114.172:8080/',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"Author: ruoxijun","link":"Link: ","source":"Source: ruoxijun","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.","copySuccess":"Copy success, copy and reprint please mark the address of this article"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'ruoxijun',
  title: 'SpringBoot',
  postAI: '',
  pageFillDescription: 'SpringBoot, 简介, 微服务简介, 创建项目, 1. 官网创建：, 2. 手动创建：, 3. IDEA 创建：, 自动配置, 依赖管理：, 初探自动配置：, 容器功能：, 1. @Configuration：, 使用, Full 模式：, Lite 模式：, 2. @Import：, 3. @Conditional：, 4. @ImportResource：, 5. 配置绑定：, 1. 原生 java 方法：, 2. 类已是组件：, 3. 在配置类上开启：, 自动配置原理：, 1. @SpringBootConfiguration：, 2. @EnableAutoConfiguration：, 3. 修改默认配置：, 4. 总结：, 配置文件, 常用配置：, yml 配置方式：, 启动图标：, 热部署：, 1. pom.xml 配置：, 2. 主配置文件配置：, 打包：, jar 包：, war 包：, Profile：, 环境配置：, 自定义 starter, web 开发, 静态资源：, 静态资源使用：, 自定义静态资源处理规则：, 静态资源配置原理：, 1. WebMvcAutoConfiguration, 2. WebMvcAutoConfigurationAdapter：, 3. 静态资源处理规则：, 4. 欢迎页处理规则：, 5. favicon.ico：, 表单与 RestFul：, 1. 开启方式：, 2. 原理解析：, 3. 自定义 HiddenHttpMethodFilter：, 请求映射原理：, 自定义 MVC, 参数处理原理：, 1. 注解参数：, 2. Servlet API 参数：, 3. 复杂参数：, 4. 自定义对象参数：, 自定义 Converter：, 数据响应原理：, 1. 响应 JSON：, 2. 内容协商原理：, 3. 开启浏览器参数方式内容协商功能：, 自定义 HttpMessageConverter：, 视图解析, Thymeleaf 模板：, 1. 引入 Starter：, 2. Thymeleaf 使用：, 视图解析原理：, 拦截器, HandlerInterceptor：, 使用拦截器：, 拦截器原理：, 文件上传：, 文件上传：, 原理解析：, 错误处理：, 默认机制：, 自定义异常处理：, 异常处理原理：, 异常处理流程：, web 原生组件：, @ServletComponentScan：, xxxRegistrationBean：, DispatcherServlet 实现原理, 嵌入式 Servlet 容器：, 原理：, 切换或去除嵌入式服务器：, 数据校验, Swagger, 1. swagger 2 版：, 2. swagger 3 版：, 3.常用注解：, 跨域, 数据库开发, JDBC：, 1. 添加依赖：, 2. 数据库配置：, 自动配置分析：, 数据库相关配置：, 3. 测试使用：, Druid：, 1. 使用 druid：, 1. 引入依赖：, 2. 配置 druid：, 2. druid starter, 1. 引入 druid 的 starter：, 2. druid starter 配置：, Mybatis：, 1. 引入依赖：, 2. 添加配置：, 3. 基础使用：, Mybatis Plus：, 1. 引入依赖：, 2. 简单实例：, Redis：, 事务控制, 单元测试, 简介与使用：, 1. 引入依赖：, 2. Junit5：, 3. 使用方式：, Junit5 常用注解：, 断言机制：, 1. 简单断言：, 2. 组合断言：, 3. 异常断言：, 4. 超时断言：, 5. 快速失败：, 前置条件：, 嵌套测试：, 参数化测试：, 指标监控, SpringBoot Actuator, 启动过程, 启动原理：, 自定义监听组件：, 整合 Jsp, 1. 所需依赖：, 2. application 配置：, 3. idea 设置和问题：, 1. 资源过滤问题：, 2. 将webapp在idea中设置为web资源文件夹：, 3. 项目找不到 jsp 文件：, SpringBoot 任务, 异步任务, 邮件任务, 定时任务, WebSocket, 添加依赖：, Server（服务端）：, Client（客户端）：, 日志简化了应用开发约定大于配置去繁从简就能创建一个独立的产品级别的应用要求及以上及以上查看方式参考文档核心技术与响应式编程简介快速创建独立运行的项目以及与主流框架集成使用嵌入式的容器应用无需打成包自动依赖与版本控制自动配置简化开发无需配置开箱即用运行时应用监控与云计算的天然集成等微服务简介架构风格服务微化一个应用应该是一组小型服务各个服务之间可以通过的方式进行互通关联每一个功能元素最终都是一个可独立替换和独立升级的软件单元详细请参照微服务详解中文版创建项目官网创建官方创建项目网址将下载下来的项目压缩包解压使用打开我们就初始化成功了一个项目手动创建参考地址使用创建一个普通项目在中导入依赖父依赖模块依赖编写主程序启动应用新建类作为主程序类上使用注解表明它是的主程序在类中创建方法并使用方法来启动项目标注主程序类说明这是一个应用启动应用参表示当前主程序类参为方法的可变参数编写业务新建包新建类注意主程序与包同级运行主程序的方法启动应用在浏览器访问可以看到浏览器中返回了的字样创建连接不上时可以使用阿里镜像地址选择初始化项目项目配置选择项目依赖这里选择的模块依赖点击创建项目自动配置依赖管理中我们需要继承一个父项目正是它来管理我们项目中的依赖它也有一个父项目此项目中在内几乎声明了所有开发中常用依赖的所有版本号这也被称之为自动版本仲裁机制如需自定义依赖版本号需要在我们项目的添加配置在父项目中找到你需要修改依赖的重写配置即可提供以很多代表了一个具体的场景支持场景支持自定义官方建议取名所以我们看见的此类一般都是第三方为我们提供的所有的场景都有一个底层依赖初探自动配置以场景为例为我们引入并配置好了自动配置好了常用组件以及常用功能标记为主程序类容器查看容器中的组件输出组件可以看见配置了的的常用组件主程序下的包及其子包默认被扫描无需我们再手动配置包扫描支持修改扫描包路径也能修改包扫描路径但不支持与注解在同一类上通过源码可知由一下个注解组成因此我们可以使用这三个注解来代替注解一样可以实现功能各种配置拥有默认值且我们配置文件的配置最终都会绑定在某一个类上这个类对象存储在容器中所有的自动配置项按需加载我们引入了那个场景对应场景的自动配置才会开启在包中引入了一个包所有的自动配置功能都在其中容器功能使用使用配置类注册组件标记为配置类默认模式给容器中添加组件以方法名作为组件返回类型就是组件类型组件依赖调用方法也会从容器中获取组件指定组件名在主程序类中检验并获取组件容器获取组件配置类本身也是组件默认为单实例可以获取到单实例组件模式模式标注有或的类被称为模式的配置类生成子类单例组件之间有依赖关系时使用方便管理每次都会在容器中查找是否有此组件没有时创建并加入容器效率较低模式类上有注解或类上没有任何注解但是类中存在方法运行时不用生成子类提高运行性能降低启动时间可以作为普通类使用不方便管理组件之间的依赖关系可以作用在任意组件类的上方导入值为任意类型组件数组给容器中自动创建出对应类型的组件默认组件的名字是全类名高级用法条件装配注解当满足条件时装配组件标记为配置类当容器中没有为的组件时装配该配置类组件中存在为的组件时才装配组件在主程序中使用检验是否存在某组件常见条件装配注解如下允许我们导入的配置文件在配置类上使用导入中的配置文件配置绑定读取文件中的内容并且把它封装到中原生方法得到配置文件的名字封装到类已是组件中使用编辑器可能会提示未配置引导配置注释处理器引入如下依赖即可组件类上声明为组件注册到容器中通过前缀绑定配置省略方法配置属性组件中还支持属性方式注入在配置类上开启为类绑定前缀配置属性前缀在配置类声明开启标记为配置类开启属性配置功能并将组件自动注册到容器中自动配置原理注解有以下个主要注解构成指定扫描包主要构成如下表示标记的类是一个配置类由以下两个注解构成自动配置包指定了默认的包规则查看源码可以发现它导入了一个组件而查看这个组件源码可以发现它有一个方法会给容器注入一系列组件注解原信息注解标记位置属性值将指定包下的所有组件导入拿到项目包名封装到一个字符串数组中由此可知作用是利用将主程序包以及子包内的组件导入容器中查看它会批量给容器导入一些组件利用给容器中批量导入组件调用获取到所有需要导入容器中的配置类利用工厂最终调用方法得到所有配置类加载文件默认扫描项目中所有位置文件核心包的文件中配置了项目启动就需要全部加载的不同场景的配置类虽然一百多个场景的所有自动配置类启动的时候默认全部加载但它们还受条件装配规则限制最终实现按需配置目前版本文件位置修改默认配置注册文件上传解析器组件源码该配置类上对应的可配置选项容器中有这个类型组件容器中没有此名称的组件给标注的方法传入了对象参数这个参数的值就会从容器中寻找这个方法防止用户配置的文件上传解析器名称不符合规范注册字符编码过滤器组件源码该配置类上对应的可配置选项对字符编码配置后返回对象加入到容器中由上可知默认会在底层配好所有的组件但是如果用户自己配置了以用户的优先因此我们想修改默认配置或定制化配置方法如下在自己的配置文件中替换需要修改的组件通过查看配置类绑定了配置文件的哪些属性在中修改配置值总结先加载所有的自动配置类每个自动配置类按照条件进行生效默认都会绑定配置文件指定的值和配置文件进行了绑定生效的配置类就会给容器中装配很多相应场景的组件并帮我们配置好组件相应功能配置文件配置属性文档常用配置在文件夹中新建或者配置文件项目端口访问项目时的路径前缀数据源配置转在线与互转配置方式绑定配置项配置方式如有驼峰命名属性建议使用加小写字母字符串可不加引号单引号会转义双引号不会转义支持表达式对象行内写法数组行内写法启动图标在线生成字符图标工具推荐在线生成工具制作下载修改替换文字实现自定义个性化启动我们只需在文件夹下新建一个文件在该文本文件中粘贴你想要的启动时显示的字符图标就好了关闭图标热部署需要的设置勾选勾选这是设置的位置其它版本请上网自查配置添加热部署依赖使继承的项目不会继承热部署在的打包插件中配置将应用打包为一个可执行的包热部署开启主配置文件配置热部署配置开启设置监听的目录应付项目自动重启编译后问题热部署快捷键打包包添加插件将应用打包为可执行包并运行中添加如下代码默认将应用打包为一个可执行的包在打包的包位置使用项目的文件名命令即可运行如不能成功请尝试关闭快速编辑模式右击窗口点击属性包将文件打包为包在中配置设置打包类型为因为中默认内置服务器我们需要将它内置的在打包时忽略掉因此在的配置中添加最后在启动类中继承类重写方法之后打包即可环境配置同理表示默认环境配置还支持我们开启和配置不同环境的配置文件自定义环境配置文件环境名称常用配置环境名称有开发环境测试环境生产环境默认配置文件与环境配置文件同时生效且同名配置环境配置优先在默认配置文件中指定激活某环境配置激活并使用中的配置命令行开启方式项目使用命令行方式修改配置属性如这里还将配置为了条件装配该注解装配的类或方法在指定环境如这是环境下才生效激活多个配置文件激活一组环境组名脚标环境名配置文件位置注意数越大优先级越高根路径根路径下目录包当前目录包当前目录的目录子目录的直接子目录自定义原理解析开发静态资源静态资源使用在中规定下的同名文件按此优先级等文件夹都可以存放静态资源我们只需按规定建立文件夹即可在配置文件中指定文件夹中的哪些文件夹为静态资源文件夹指定静态资源文件夹使用逗号分隔多个访问方式项目根路径资源路径名访问时不用加上等静态文件夹的名作为路径一部分请求优先由处理没有相关请求时再寻找静态资源因此静态资源中有与相同的请求路径时由处理将不能请求到静态资源为静态资源设置访问前缀访问所有的静态资源都需要添加此路径前缀中默认静态资源文件夹下的为首页不推荐直接访问项目根路径将访问到此页面未设置静态资源访问前缀的情况下设置网页图标只需在静态资源文件夹中添加名为的图片即可自定义静态资源处理规则如我们需要访问指定位置的文件时可以如下配置添加静态资源处理规则请求路径访问方式项目路径文件名文件路径项目文件夹下使用前缀静态资源配置原理启动时自动加载类其中功能的自动配置类加载成功且生效在有一个配置类这个类绑定了两个配置属性且这个配置类只有一个有参构造器当配置类只有一个有参构造器时所有的参数都会自动充容器里面找获取配置绑定值的对象的找到所有的找到资源处理器的自定义器给应用注册静态资源处理规则在配置类中有一个方法它就是静态资源处理的默认规则检查配置默认为为时将关闭默认的资源处理规则对的所有请求做处理为资源路径对应配置请求路径默认值设置静态资源路径对应配置其默认值为欢迎页处理规则在类中有一个配置类其中向容器注册了一个组件构造函数中欢迎页不为且静态资源请求路径为时转发请求当欢迎页不存在时请求由处理浏览器会默认请求项目下作为标签页图标并保存在域中因此在配置文件中设置了静态资源访问前缀那么就会获取不到相对应的图标了表单与开启方式一般浏览器表单不能发送以外的其它请求其它请求都被请求代替提供了我们只需为请求添加一个参数参数值就是我们想使用的请求方式允许我们在配置中开启这项功能原理解析在中当容器中没有该组件时我们没有自定义时检查配置中的值是否开启此功能默认在过滤器中默认值修改拦截请求是请求且没有错误时获取到请求数据中参数的值有值时转为大写检查是否是允许的请求方式将原生替换为包装模式的重写了方法并传入参数的值过滤器放行上面条件成立则放行被替换的自定义参照自定义修改为参数表单现在只需添加一个参数参数值为其中一个它就会去访问对应的请求方法了请求映射原理中通过做请求分发同理也一样是因此它肯定有等方法继承关系中查看中重写了等方法中查看并且可以发现等方法都调用了方法它又调用了方法处理请求调用处理初始化过程省略调用统一处理请求省略它抽象方法因此可知请求被实现的方法处理中最终调用方法派发请求拿到当前请求的处理器在中有一个参数它存储了许多请求的映射处理器方法中它会遍历这些映射处理器并获取到能够处理当前请求的遍历当前映射处理器获取中有一个它保存了所有相关和的映射规则还有它就是欢迎页面的映射处理器它们都是中帮我们配置好的遍历时查询中是否有对应处理请求的如果当前中没有则继续在下一个中寻找同理我们可以自定义映射处理器自定义默认是关闭矩阵变量的在中内有一个方法它是来配置路径映射的我们需要修改一下路径路径匹配规则而这个方法是通过对路径进行解析此类中有一个默认为表示移除路径分号的内容想开启矩阵变量功能我们需要自定义提供了三种方式实现接口推荐使用实现接口重写自定义不让异常分号内容注册组件注册组件自定义重写继承全面接管慎用所有的规则需要手动重写配置会引入组件它继承而在上表示则存在该类时的自动配置将不生效参数处理原理在方法中参数会按照类型或注解帮我们自动注入值它是如何实现的注解参数在的方法中它通过找到能够处理当前请求的从中拿到具体处理该请求的它记录了具体的方法之后还会为当前的找到适配器方法中获取适配器它会遍历适配器集合找到能够处理当前的适配器保存了多种适配器的集合支不支持当前在适配器集合中有一个它就是主要来处理等方法的适配器找到适配器后执行目标方法方法中真正执行在通过来执行我们的目标方法方法为将执行的方法设置参数解析器与返回值处理器中可执行方法即要执行的方法设置参数解析器所以可知方法支持哪些参数类型取决于该解析器它会拿到方法的参数检查是否支持解析该参数如果支持再进行解析参数解析器列表设置返回值处理器返回值处理器列表调用和处理方法中方法内去执行方法并得到的返回值会利用的方法中确定每一个参数的具体值获取方法所有的参数声明为空时声明存储参数值的数组判断那个解析器支持当前参数类型它会遍历参数解析器找到合适的第一次执行时会将匹配的解析器加入缓存之后不再需要遍历使用参数解析器解析当前参数的具体值参数参数类型的解析器中是否为支持的类型支持的复杂参数等类型参数以参数类型为例在的方法中获取到类型的参数解析器为解析参数是利用的返回它是也是类型最终参数值封装到它里面用来保存请求需要的所有数据视图数据模型数据等等类型参数解析器为过程同理一样调用了自定义对象参数自定义参数类型的解析器它继承由之前可知来判断某解析器是否能解析该类型参数是否标注了注解不是必须的且不是简单属性同列解析参数再的方法中获取参数名获取看有没有注解判断中有没有同名参数创建一个对象实例所有属性值为空的实例绑定结果为空时创建数据绑定器拿到实例且不为将请求中的数据绑定到实例中绑定发生异常可通过获取数据校验错误就是从这里拿到的数据绑定器将请求参数的值绑定到指定的中它利用转换器将请求数据转换成指定的数据类型再次封装到中在设置每一个值的时候找它里面的所有那个可以将这个数据类型带来参数的字符串转换到指定的类型自定义接口包含注解它只能针对表单提交数据有效添加自定义类型转类型转换具体实现方式存在文字自定义操作设定属性值例如发起请求与结果结果数据响应原理响应由上可知的中会拿到的返回值之后它还会对返回值做处理执行方法并拿到返回值如果返回值为空是否是一个字符串处理返回值中根据返回值类型获取合适的返回值处理器它会遍历所有的返回值处理器拿到能够处理当前返回值的处理器处理返回值返回值处理器接口判断是否支持某类型返回值处理返回值各种返回值处理器支持的返回值类型方法有以下注解标注且返回值为对象类型的对应的处理器处理标注的方法的返回值在调用方法使用消息转换器进行写出操作内容协商协议中规定请求头中有属性它告诉服务器客户端能接收的响应类型是什么逗号比分号优先级高代表权重没有去默认为表示任意类型客户端能接收的类型用媒体类型对象表示与服务器支持生成的类型循环匹配筛选出能够支持类型的若客户端无法解析服务端返回的内容即媒体类型未匹配那么响应遍历容器中所有消息转换器找到支持相应类型的转换器主要作用看是否支持将返回值类型的对象转化为类型的数据是否支持读是否支持写利用中方法将对象转为利用再写出去内容协商原理判断当前请求头中是否已经有确定的媒体类型有就使用确定好的媒体类型没有则向下执行获取客户端支持接收的内容类型默认通过请求头字段内容协商管理器默认使用基于请求头的策略确定客户端可以接收的内容类型获取服务器支持生成的媒体类型再与客户端能接收的类型进行比对找到匹配的媒体类型遍历循环容器中所有的拿到所有支持转换当前返回值类型的客户端想要的类型和服务器支持的类型进行循环匹配最终使用匹配到的进行转换开启浏览器参数方式内容协商功能开启配置开启此配置后服务器不再默认通过请求头的字段来获取客户端支持接收的内容类型而是通过读取请求参数中的值来确定客户端接收的内容类型请求时添加参数指定接收的数据类型即可接收类型数据自定义自定义添加自定义方法返回值为类型返回值类型为类型服务器要统计所有都能写出哪些内容类型自定义类型自定义内容数据将内容写出当标注的方法返回值类型为且媒体类型为我们自定义的时将使用此自定义写出响应数据如果还想使用请求中添加参数来指定客户端接收响应数据的类型还需要在上中重写方法原来的策略全部失效配置内容协商功能自定义类型对应类型新增参数策略注意如果不添加其它策略则只能使用参数策略也可继续新增基于请求头的策略设置内容协商策略或者使用配置方式这样我们只需在请求中添加则表示客户端需要接收的类型为类型视图解析模板现代化服务端模板引擎官网使用与语法引入引入模板引擎使用默认帮我们配置好了默认在文件夹内的页面文件将会被模板引擎解析模版页面中的标签上需要声明的命名空间视图解析原理处理返回值时当返回值是一个字符串时会被处理器处理返回值是否为空或者一个字符串将所有数据都存放在了中是否要重定向判断是否需要重定向方法的参数是一个自定义类型对象时会默认自动将它存放在中任何目标方法执行完成以后都会返回数据与视图当你的没有设置时是给你使用默认的值为当前方法的请求路径如那么视图就是由的方法处理派发结果处理页面该如何响应它会执行渲染页面操作遍历所有找到对应视图解析器得到相应的对象定义了页面渲染逻辑如重定向是最后调用的方法进行页面渲染工作返回值以开头中原生转发请求返回值以开头中原生重定向请求普通字符串拦截器拦截器接口预先处理执行目标方法之前是否放行目标方法执行完成后请求处理完成后使用拦截器实现登录成功放行请登录配置拦截器中实现添加拦截器方法添加拦截器拦截路径放行路径排除由于拦截了包括静态资源的请求因此需要放行静态资源或为静态资源配置访问前缀再放行此前缀下的所有请求拦截器原理根据当前请求找到为它拿到了可以处理请求的和相关的拦截器之后拿到了相关的适配器最后使用适配器来执行目标方法但在执行目标方法之前还有一个前置步骤它会来执行我们拦截器的方法会先正序挨个执行拦截器的方法如果当前拦截器返回这执行下一个如果拦截器返回会执行方法它会逆序执行已经触发了的拦截器的方法并且返回因此如果任何一个拦截器返回则返回将直接不能执行目标方法如果成功执行了目标方法之后还会倒序执行所有拦截器的方法并且注意前任何步骤报错都将执行方法最后在页面渲完成以后也会触发方法文件上传文件上传表单设置与提交接收文件也能接收类型一般接收基本类型和一般接收表单数据适用于复杂的请求域像相关配置上传单个文件大小上限整个请求的大小上限原理解析对文件上传的自动配置封装在了中它自动帮我们配置了文件上传解析器在的中获取处理器之前会先解析请求是否是上传文件请求根据请求类型是否是来判断如果是文件上传请求文件上传解析器会将原生请求封装为继续向下执行最终参数解析器将请求中的文件内容封装成错误处理默认机制默认情况下提供处理所有错误映射如果是浏览器会响应一个的视图其它客户端会生产响应在任何静态资源文件夹中目录下以或开头页面会在发生相应错误时被自动解析并返回自定义异常处理处理全局异常处理所有异常的类指定方法处理哪些异常不指定则处理所有对异常进行处理并返回结果还能在中使用处理该中所有或者指定的异常优先使用中方法处理且匹配错误类型范围更小的优先自定义异常自定义异常请求响应返回的状态码错误信息请求错误自定义异常解析器因为我们自定义异常解析器的组件创建会比它默认的解析器后创建而一般异常都被默认的解析器处理了轮不到我们自定义的解析器因此我们需要提升自定义解析器创建的优先级设置创建该组件的优先级数字越小优先级越高继承且添加到组件中解析过程异常处理原理自动配置了异常处理规则给容器中存放了一些组件组件定义了错误页面中包含的数据组件默认处理请求没有配置值时默认使用同理默认表达式其中返回页面的请求方法会返回通过视图解析器按照视图名作为组件的去容器中寻找为的组件还有一个返回的请求方法组件发生错误它会以状态码作为视图名异常处理流程中执行目标方法期间发生任何异常都被捕获并将异常对象保存到中在执行视图解析时将处理异常由方法处理发生的异常并返回它会遍历所有的处理器异常解析器看谁能够处理当前异常默认是没有能够处理异常的解析器其中只会将错误信息保存到请求域中其它的解析器只在特定的情况发挥作用如有注解等如果没有任何解析器能够处理当前异常最终将发送请求并被中的方法处理它将遍历所有的错误视图解析器其中将返回错误页面视图原生组件注意原生组件不会触发的拦截器等功能在主类中使用指定组件存放的包位置默认将扫描并注入此注解所在包以及所有子类包中含有注解的原生组件属性指定扫描的包位置扫描并自动注入元素组件在注解能扫描的包内创建原生即可地址响应同理是中表示所有使用表示拦截的路径项目初始化项目销毁推荐使用在配置类中向注入类型组件的方式来分别添加不建议使用属性值自定义对象注册并设置访问路径自定义对象注册并拦截中的请求指定拦截请求注册自定义监听器实现原理在中给容器配置并注入了组件且属性绑定在中对应的配置项为其中另一个配置类中给容器配置注入了组件它继承至且配置器映射路径为对应配置配置项目上下文访问的前缀配置的是拦截的路径多个处理同一层路径采用精确优先原则如有与两个将进入第个由于的都基于的实现因此我们自定义注入的原生组件是直接执行不会通过的相关功能如拦截器嵌入式容器原理在包中默认引入的包配置类它导入了组件其中它会根据添加动态判断系统导入了那个服务器的包注入相应的服务器工厂组件它会在容器启动时寻找服务器工厂利用服务器工厂创建除服务器并启动切换或去除嵌入式服务器在中引入包时排除依赖的包引入你需要的服务器包已配置好版本号不需要填写版本号直接引入即可数据校验添加依赖数据校验使用数据校验邮箱格式错误必须是邮箱格式常用注解注解验证的数据类型说明值必须是值必须是任意类型值不能是任意类型值必须是以及任何或子类型大于等于指定的值同上小于等于指定的值同上大于等于指定的值超高精度同上小于等于指定的值超高精度同上限制整数位数和小数位数上限字符串数组等长度在指定区间之内如字符串长度集合大小等如等日期类型值必须比当前时间早同上值必须比当前时间晚及其子类值不为空在比较时会去除字符串的首位空格及其子类字符串长度在指定区间内及其子类数组值不为且长度不为空字符串长度不为集合大小不为以及原子类型和包装类型值在指定区间内及其子类值必须是邮件格式及其子类值需要与指定的正则表达式匹配任何非原子类型用于验证对象属性官网文档在线生成工具可直接运行支持在线测试版依赖文档工具配置类请产考下方配置启动依赖为文档类型为其它使用无太大变化浏览器访问地址为项目地址版依赖配置类开启开启配置实例是否开启分组指定扫描方式的类指定扫描需要生成的包扫描类上有指定注解的类如扫描方法上有指定注解的方法全部扫描不扫描请求过滤配置网页的一些显示信息作者信息项目标题项目描述需要有多个分组时就配置多个即可分组分组名其它配置暂不写了浏览器访问地址为项目地址常用注解类常用注解类说明类描述请求方法作用请求方法备注说明方法参数集表示参数是否必须参数名参数描述值参数较少时也可在方法参数旁添加参数描述方法响应描述抛出的异常类返回数据成功返回数据失败实体类常用注解用户实体类类描述用户成员变量描述跨域设置允许跨域的路径设置允许跨域请求的域名是否允许设置允许的请求方式设置允许的属性跨域允许时间数据库开发添加依赖引入驱动不提倡直接修改版本在中引入了数据源数据库连接池事务包因此我们需要操作什么数据库导入相应驱动即可默认数据库驱动版本一般与本机数据库版本不一致建议修改版本配置与本机一致数据库配置自动配置分析数据源自动配置数据源相关属性都与绑定对应配置的相关属性数据库连接池默认的配置在我们没有配置时才会自动配置且默认配置使用连接池事务管理器自动配置数据库相关配置配置数据源默认测试使用查询结果项目官方地址官方介绍是语言中最好的数据库连接池能够提供强大的监控和扩展功能使用引入依赖如需使用数据监控时需要用到配置监控防火墙要使用数据源由前可知需要注入的来使默认的数据源失效也支持配置文件中属性配置数据源想要开启监控与统计数据的页面需要配置页面开启后中配置属性开启各类监控值开启监控值开启防火墙配置可开启监控并设置统计和需要排除的请求配置数据源并将此数据源属性与配置绑定添加开启数据统计页面添加初始化参数并设置监控登录页面的账户开启监控设置连接路径添加初始化参数设置排除的请求不加如统计在浏览器中访问项目地址或项目地址即可查看监控页面引入的除了引入包手动配置以外提供了它引入了以及一个自动配置的包其中设置了大量默认配置项也可以在配置文件中自定义配置值配置使用方法与详细配置开启监控页面登录监控页面账号监控监控防火墙可单独详细配置监控切入点引入依赖数据库驱动添加分页插件集成依赖中已经引入场景添加配置指定原生总配置文件位置表示文件夹下位置此配置项中包含所有全局配置且不能与配置同时存在驼峰命名与下划线匹配为此包下的基类自动取别名分页插件配置使用基础使用创建接口声明此类是的类每一个类都要加一个注解表明它是一个接口也可以选择在启动类中利用直接扫描整个文件夹扫描文件夹中的所有接口使用扫描可能出现在使用注解自动装配对象时在编辑器中报红显示找不到对象但是放心运行时是没有问题的可以不理也可用以下方法解决使用注解装配对象在接口上使用标识为关闭或修改的代码检查在文件夹下新建配置中的文件夹然后建立接口的对应即可对应的文件位置引入依赖官网地址它已经引入了与等场景配置与绑定配置文件位置属性默认值表示任意工程路径下所有文件夹的下都是即不仅是当前项目还包括包该路径下简单实例在类上使用指定扫描的接口包也可使用注解方式编写接口并继承泛型是你要操作的表对应的基类在中已经为我们声明了一些常用的数据操作方法无需编写文件即可获得功能当它满足不了某些需求时可新建方法与进行自定义默认基类的属性在表中必须有对应字段否则报错如果属性无对应字段可在该属性上标注表示该属性在表中不存在实现业务类继承接口泛型为要操作的基类标注实现接口继承泛型分别为操作的与基类实现请求查询表中所有数据分页查询分页查询还需要使用分页插件其它插件使用方式同理分页拦截器已有默认属性可自定义分页属性引入场景需要操作时引入默认引入了操作使用需要我们手动引入并且在配置项中申明想使用的客户端配置开始需要配置项服务器地址端口数据库索引用户名没有可以去除密码连接超时时间切换操作的客户端客户端默认还有连接池配置最大连接数负数表示没有限制最大阻塞等待时间负数表示没有限制默认最大空闲连接最小空闲连接事务控制对事务提供了实现并自动配置我们只需在需要添加事务的方法上添加如下注释即可单元测试简介与使用引入依赖版本开始引入作为单元测试默认库由三个不同子项目的几个不同模块组成是在上启动测试框架的基础不仅支持自制的测试引擎其他测试引擎也都可以接入提供了的新的编程模型是新特性的核心内部包含了一个测试引擎用于在上运行由于已经发展多年为了照顾老的项目提供了兼容的测试引擎以上版本移除了默认对的依赖如果需要兼容需要自行引入测试兼容使用方式分别使用与注解标记测试类与测试方法被标记的类支持标注的测试方法测试完成后自动回滚等注解常用注解官方文档常用注解表示方法是参数化测试表示方法可重复执行为测试类或者测试方法设置展示名称表示方法在每个单元测试之前执行之后同理表示静态方法在所有单元测试之前执行同理表示单元测试类别类似于中的表示测试类或测试方法不执行类似于中的表示测试方法运行如果超过了指定时间将会返回错误为测试类或测试方法提供扩展类引用断言机制简单断言测试方法中前面的断言失败则后面的代码不会执行断言方法一般都是中的静态方法简单使用方式直接导入静态方法是否相等参期望值参实际值参可选错误信息值不相等是否是同一个对象常用简单断言方法说明两个对象值或两个原始类型值是否相等两个对象或两个原始类型是否不相等两个对象引用是否指向同一个对象两个对象引用是否指向不同的对象给定的布尔值是否为给定的布尔值是否为给定的对象引用是否为给定的对象引用是否不为两个对象或原始类型的数组是否相等组合断言有需要多个断言全部满足条件时可使用组合断言参可选为该组合断言取名字异常断言业务逻辑在某情况下一定出现异常时使用预期错误类型异常成功触发超时断言如果测试方法时间超过将会异常快速失败直接失败前置条件假设当不满足某前置条件时测试将不会继续执行但不会报错不是条件满足时执行接口是嵌套测试在内部类上标注注解可实现嵌套测试可无限嵌套且内部单元测试会激活外部的等方法反之不行测试方法或更多内部类嵌套测试方法参数化测试为参数化测试指定入参来源支持八大基础类以及类型类型表示为参数化测试提供一个的入参表示为参数化测试提供一个枚举入参表示读取指定文件内容作为参数化测试入参表示读取指定方法的返回值作为参数化测试入参注意方法返回需要是一个流使用注解标注方法表示这是一个参数化测试的方法将值依次传入测试方法中测试指定方法名方法必须是且返回流指标监控依赖导入访问路径在此路径下还可以访问更详细的监控端点默认暴露所有端点而只默认暴露和端点配置常用监控端点监控状况运行时指标日志记录配置所有端点的默认行为关闭所有监控端点以方式暴露所有监控端点配置具体端点开启监控端点开启端点的详细信息显示开启端点定制等信息略可视化启动过程启动原理在主程序中方法创建了一个对象保存信息判断当前应用类型找到所有的初始启动引导器在找找到所有的初始化器在找找到所有的应用监听器在找执行对象的方法记录应用启动时间创建引导上下文它会挨个执行之前获取的初始启动引导器的方法完成引导启动器上下文环境设置让当前应用进入模式获取所有运行监听器在找遍历所有的运行监听器并调用它的方法监听器执行应用开始启动事件保存命令行参数准备环境当前上下文有环境信息就获取否则就新创建一个基础环境信息配置环境信息对象读取所有配置源的配置属性值绑定环境信息遍历所有的运行监听器并调用它的方法监听器执行环境准备完成事件创建容器根据项目类型创建容器准备容器基本信息应用初始化器遍历所有初始化器对容器进行初始化遍历所有的运行监听器并调用它的方法监听器执行容器准备完成事件遍历所有的运行监听器并调用它的方法监听器执行容器已加载事件刷新容器在容器中创建所有需要创建的组件执行容器刷新后处理遍历所有的运行监听器并调用它的方法监听器执行容器已启动事件调用所有的获取容器中的与并且按照进行排序遍历所有执行方法如果以上有异常发生将调用运行监听器的方法监听器执行项目启动失败事件无异常将调用运行监听器的方法实际执行方法监听器执行项目已完全启动事件其中如果发生异常依然执行方法最后返回整个容器自定义监听组件需要在中内配置的组件直接可通过注入容器中的组件如添加注解等方式整合产考文献中使用之篇其它问题设置启动时初始化出错所需依赖内置对的解析包依赖依赖对语法的依赖配置存放文件夹注意不包含文件夹视图文件后缀这是文件配置配置文件同理转化即可设置和问题资源过滤问题如果遇到文件不在编译后的项目中可在的标签中添加如下资源过滤配置可以根据需要更改配置一些项目中包含配置文件或资源文件可能在打包时不能成功需要在中添加下配置将中的页面编译到中将在中设置为资源文件夹项目找不到文件视图前缀配置中有人容易加上文件夹前缀也是造成页面访问不到的原因任务异步任务在主程序类上使用注解开启异步任务在需要异步执行的业务方法上添加注解该方法执行时自动异步执行不会阻碍下方的代码执行邮件任务导入依赖以邮箱为例在账户中开启服务并获取授权码邮箱配置发送邮件简单的邮件协议发件人收件人邮件主题邮件内容发送成功复杂邮件创建邮件使用邮件助手设置邮件邮件主题开启解析附件名称桌面文件主题配色发送邮件定时任务在主程序类上使用注解标注开启定时任务功能在需要开启定时任务的业务方法上使用注解标注并使用表达式指定执行时间在线表达式生成器秒分时日月星期每五秒执行添加依赖服务端配置类中注入启用支持编写服务端定义访问地址地址前必须有当前连接数欢迎当前人数当前连接数退出当前人数参数必须有否则报错当前连接数出错当前人数客户端定义客户端连接连接成功接收消息连接关闭连接出错日志基本使用使用占位符调试时条件建议错误日志打印方式在项目中只需将文件放置在目录下就会在启动时自动加载并应用这个日志配置引入提供的默认配置定义变量日志文件的存储位置应用程序名称日志文件的最大历史记录数单个日志文件的最大大小控制台和文件的日志输出格式控制台日志配置文件日志配置文件名与日志格式日志滚动策略日志文件名单个日志文件最大大小文件保存最多个数超过时会删除之前的文件处理所有的日志事件日志级别为特定的包或类配置单独的日志事件可定义多个不会将日志传递给其祖先',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-09-14 10:28:59',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://ruoxijun.top/" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" href="https://ruoxijun.top/" title="其它"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="其它"/><span class="back-menu-item-text">其它</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">ruoxijun</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> Article</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> Tunnel</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> Classification</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> Label</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> Friend</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> Friends account</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> Moments</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-envelope"></use></svg><span> Message board</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> My</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> Music Hall</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili1"></use></svg><span> Chasing</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-images"></use></svg><span> Album Set</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-fan"></use></svg><span> Conditioning</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-zhifeiji"></use></svg><span> About</span></a></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> Search</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://ruoxijun.pythonanywhere.com/download" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://ruoxijun.pythonanywhere.com/download"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://ruoxijun.pythonanywhere.com/download" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://ruoxijun.pythonanywhere.com/download"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> Newest Comments</span></div><div class="aside-list"><span>loading...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/WebView/" style="font-size: 1.05rem;">WebView<sup>1</sup></a><a href="/tags/alertdialog/" style="font-size: 1.05rem;">alertdialog<sup>1</sup></a><a href="/tags/arduino/" style="font-size: 1.05rem;">arduino<sup>1</sup></a><a href="/tags/axios/" style="font-size: 1.05rem;">axios<sup>3</sup></a><a href="/tags/docker/" style="font-size: 1.05rem;">docker<sup>1</sup></a><a href="/tags/es6/" style="font-size: 1.05rem;">es6<sup>2</sup></a><a href="/tags/file/" style="font-size: 1.05rem;">file<sup>2</sup></a><a href="/tags/fragment/" style="font-size: 1.05rem;">fragment<sup>1</sup></a><a href="/tags/idea/" style="font-size: 1.05rem;">idea<sup>1</sup></a><a href="/tags/java/" style="font-size: 1.05rem;">java<sup>3</sup></a><a href="/tags/jdbc/" style="font-size: 1.05rem;">jdbc<sup>1</sup></a><a href="/tags/jquery/" style="font-size: 1.05rem;">jquery<sup>1</sup></a><a href="/tags/k8s/" style="font-size: 1.05rem;">k8s<sup>1</sup></a><a href="/tags/kubernetes/" style="font-size: 1.05rem;">kubernetes<sup>1</sup></a><a href="/tags/linux/" style="font-size: 1.05rem;">linux<sup>4</sup></a><a href="/tags/lombok/" style="font-size: 1.05rem;">lombok<sup>2</sup></a><a href="/tags/markdown/" style="font-size: 1.05rem;">markdown<sup>1</sup></a><a href="/tags/maven/" style="font-size: 1.05rem;">maven<sup>1</sup></a><a href="/tags/mysql/" style="font-size: 1.05rem;">mysql<sup>1</sup></a><a href="/tags/nginx/" style="font-size: 1.05rem;">nginx<sup>1</sup></a><a href="/tags/nps/" style="font-size: 1.05rem;">nps<sup>1</sup></a><a href="/tags/pecyclerView/" style="font-size: 1.05rem;">pecyclerView<sup>1</sup></a><a href="/tags/popupwindow/" style="font-size: 1.05rem;">popupwindow<sup>1</sup></a><a href="/tags/progressBar/" style="font-size: 1.05rem;">progressBar<sup>1</sup></a><a href="/tags/python/" style="font-size: 1.05rem;">python<sup>1</sup></a><a href="/tags/scrollView/" style="font-size: 1.05rem;">scrollView<sup>1</sup></a><a href="/tags/sharedpreferences/" style="font-size: 1.05rem;">sharedpreferences<sup>1</sup></a><a href="/tags/sql/" style="font-size: 1.05rem;">sql<sup>1</sup></a><a href="/tags/sqlite/" style="font-size: 1.05rem;">sqlite<sup>1</sup></a><a href="/tags/tabLayout/" style="font-size: 1.05rem;">tabLayout<sup>1</sup></a><a href="/tags/termux/" style="font-size: 1.05rem;">termux<sup>1</sup></a><a href="/tags/toast/" style="font-size: 1.05rem;">toast<sup>1</sup></a><a href="/tags/typescript/" style="font-size: 1.05rem;">typescript<sup>1</sup></a><a href="/tags/viewpager/" style="font-size: 1.05rem;">viewpager<sup>1</sup></a><a href="/tags/vue3/" style="font-size: 1.05rem;">vue3<sup>2</sup></a><a href="/tags/wsl/" style="font-size: 1.05rem;">wsl<sup>1</sup></a><a href="/tags/zerotermux/" style="font-size: 1.05rem;">zerotermux<sup>1</sup></a><a href="/tags/%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/" style="font-size: 1.05rem;">内网穿透<sup>1</sup></a><a href="/tags/%E7%89%A9%E8%81%94%E7%BD%91/" style="font-size: 1.05rem;">物联网<sup>1</sup></a><a href="/tags/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" style="font-size: 1.05rem;">面向对象<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>Archives</span><a class="card-more-btn" href="/archives/" title="More">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/04/"><span class="card-archive-list-date">April 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/03/"><span class="card-archive-list-date">March 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/07/"><span class="card-archive-list-date">July 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/02/"><span class="card-archive-list-date">February 2022</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/09/"><span class="card-archive-list-date">September 2021</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/08/"><span class="card-archive-list-date">August 2021</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2021/01/"><span class="card-archive-list-date">January 2021</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2020/10/"><span class="card-archive-list-date">October 2020</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/SpringBoot/" itemprop="url">SpringBoot</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/springboot/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>springboot</span></a><a class="article-meta__tags" href="/tags/swagger/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>swagger</span></a><a class="article-meta__tags" href="/tags/druid/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>druid</span></a></span></div></div><h1 class="post-title" itemprop="name headline">SpringBoot</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2020-08-29T08:31:14.000Z" title="Created 2020-08-29 16:31:14">2020-08-29</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-09-14T02:28:59.334Z" title="Updated 2024-09-14 10:28:59">2024-09-14</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">Word count:</span><span class="word-count" title="文章字数">21.6k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">Reading time:</span><span>91min</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="SpringBoot"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">Post View:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为重庆"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>重庆</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">Comments:</span><a href="/2020/08/29/java/springboot/SpringBoot/#post-comment" tabindex="-1"><span id="twikoo-count"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://www.ruoxijun.top/getRandomImageR2?_r_=99c9522a-1d3c-dfe0-72d7-dd2ed0d12255"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://ruoxijun.top/2020/08/29/java/springboot/SpringBoot/"><header><a class="post-meta-categories" href="/categories/SpringBoot/" itemprop="url">SpringBoot</a><a href="/tags/springboot/" tabindex="-1" itemprop="url">springboot</a><a href="/tags/swagger/" tabindex="-1" itemprop="url">swagger</a><a href="/tags/druid/" tabindex="-1" itemprop="url">druid</a><h1 id="CrawlerTitle" itemprop="name headline">SpringBoot</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">ruoxijun</span><time itemprop="dateCreated datePublished" datetime="2020-08-29T08:31:14.000Z" title="Created 2020-08-29 16:31:14">2020-08-29</time><time itemprop="dateCreated datePublished" datetime="2024-09-14T02:28:59.334Z" title="Updated 2024-09-14 10:28:59">2024-09-14</time></header><h1 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h1><blockquote>
<p>SpringBoot 简化了 Spring 应用开发，约定大于配置，去繁从简，just run 就能创建一个独立的，产品级别的应用。</p>
<p>SpringBoot2 要求 <strong>java8</strong> 及以上， <strong>maven3.3</strong> 及以上。（查看方式：java -version，mvn -v）</p>
<p>参考文档：<a target="_blank" rel="noopener" href="https://www.yuque.com/atguigu/springboot">SpringBoot2 核心技术与响应式编程</a></p>
</blockquote>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ol>
<li>快速创建独立运行的 Spring 项目以及与主流框架集成</li>
<li>使用嵌入式的 Servlet 容器，应用无需打成 war 包</li>
<li>starters 自动依赖与版本控制</li>
<li>自动配置简化开发，无需配置 XML 开箱即用</li>
<li>运行时应用监控与云计算的天然集成等</li>
</ol>
<h3 id="微服务简介"><a href="#微服务简介" class="headerlink" title="微服务简介"></a>微服务简介</h3><p><img src="http://blog.cuicc.com/images/sketch.png" alt="微服务框架图"></p>
<ul>
<li>架构风格（服务微化）</li>
<li>一个应用应该是一组小型服务，各个服务之间可以通过HTTP的方式进行互通关联</li>
<li>每一个功能元素最终都是一个可独立替换和独立升级的软件单元。</li>
</ul>
<p>详细请参照：<a target="_blank" rel="noopener" href="http://blog.cuicc.com/blog/2015/07/22/microservices/">微服务详解中文版</a></p>
<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><h3 id="1-官网创建："><a href="#1-官网创建：" class="headerlink" title="1. 官网创建："></a>1. 官网创建：</h3><p>官方创建 SpringBoot 项目网址：<a target="_blank" rel="noopener" href="https://start.spring.io/">https://start.spring.io/</a></p>
<p><img src="/images/java/springboot_start.jpg" alt="创建spring boot项目步骤"></p>
<p>将下载下来的项目压缩包解压使用 IDEA 打开，我们就初始化成功了一个 spring boot 项目。</p>
<h3 id="2-手动创建："><a href="#2-手动创建：" class="headerlink" title="2. 手动创建："></a>2. 手动创建：</h3><p>参考地址：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/getting-started.html#getting-started.first-application.code">Getting Started (spring.io)</a></p>
<ol>
<li>使用 IDEA 创建一个普通 maven 项目</li>
<li>在 pom.xml 中导入 SpringBoot 依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span> <span class="comment">&lt;!-- SpringBoot 父依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span> <span class="comment">&lt;!-- web 模块依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>编写主程序，启动 Spring Boot 应用：</li>
</ol>
<p>新建 MainApplication 类作为主程序，类上使用 <code>SpringBootApplication</code> 注解表明它是 SpringBoot 的主程序。在类中创建 <strong>main</strong> 方法，并使用 <code>SpringApplication.run</code> 方法来启动 SpringBoot 项目。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 标注主程序类，说明这是一个 SpringBoot 应用</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 启动spring应用，参1表示当前主程序类，参2为 main 方法的可变参数</span></span><br><span class="line">        SpringApplication.run(MainApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>编写业务：</li>
</ol>
<p>新建 controller 包，新建 HelloController 类(注意：SpringBoot 主程序与 controller包同级)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>运行主程序（MainApplication）的 main 方法启动 spring boot 应用，在浏览器访问 <a target="_blank" rel="noopener" href="http://localhost:8080/hello">http://localhost:8080/hello</a> 可以看到浏览器中返回了 <strong>hello world</strong> 的字样。</li>
</ol>
<h3 id="3-IDEA-创建："><a href="#3-IDEA-创建：" class="headerlink" title="3. IDEA 创建："></a>3. IDEA 创建：</h3><ul>
<li><a target="_blank" rel="noopener" href="https://start.spring.io/">Spring Initializr https://start.spring.io/</a> 连接不上时可以使用阿里镜像地址 ： <a target="_blank" rel="noopener" href="https://start.aliyun.com/">https://start.aliyun.com</a></li>
</ul>
<ol>
<li>选择初始化 spring 项目：</li>
</ol>
<p><img src="/images/java/springboot/springboot01.jpg" alt="选择初始化 spring 项目"></p>
<ol start="2">
<li>项目配置：</li>
</ol>
<p><img src="/images/java/springboot/springboot02.jpg" alt="项目配置"></p>
<ol start="3">
<li>选择项目依赖（这里选择 spring boot 的 web 模块依赖）</li>
</ol>
<p><img src="/images/java/springboot/springboot03.jpg" alt="添加依赖"></p>
<ol start="4">
<li>点击 finish 创建项目：</li>
</ol>
<p><img src="/images/java/springboot/springboot04.jpg" alt="创建项目"></p>
<h2 id="自动配置"><a href="#自动配置" class="headerlink" title="自动配置"></a>自动配置</h2><h3 id="依赖管理："><a href="#依赖管理：" class="headerlink" title="依赖管理："></a>依赖管理：</h3><ol>
<li><p>SpringBoot 中我们需要继承一个父项目 <code>spring-boot-starter-parent</code> 正是它来管理我们项目中的依赖，它也有一个父项目 <code>spring-boot-dependencies</code> 此项目中在 <code>properties</code> 内几乎声明了所有开发中常用依赖的所有版本号，这也被称之为 <strong>自动版本仲裁机制</strong> 。</p>
</li>
<li><p>如需自定义依赖版本号需要在我们项目的 <strong>pom.xml</strong> 添加 <code>&lt;properties&gt;&lt;/properties&gt;</code> 配置，在父项目中找到你需要修改依赖的 <strong>key</strong> 重写配置即可。</p>
</li>
<li><p>SpringBoot 提供以很多 starter， <code>spring-boot-starter-*</code> * 代表了一个具体的场景。<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.build-systems.starters">SpringBoot 支持场景 Developing with Spring Boot</a></p>
</li>
<li><p>SpringBoot 支持自定义 starter 官方建议取名 <code>*-spring-boot-starter</code> ，所以我们看见的此类 starter 一般都是第三方为我们提供的 starter。</p>
</li>
<li><p>所有的 starter 场景都有一个底层依赖：</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="初探自动配置："><a href="#初探自动配置：" class="headerlink" title="初探自动配置："></a>初探自动配置：</h3><p>以 web 场景为例：</p>
<ol>
<li>为我们引入并配置好了 Tomcat：</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>自动配置好了 SpringMVC 常用组件，以及 web 常用功能：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span> <span class="comment">// 标记为主程序类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// IOC 容器</span></span><br><span class="line">        <span class="type">ConfigurableApplicationContext</span> <span class="variable">run</span> <span class="operator">=</span> SpringApplication.run(MainApplication.class, args);</span><br><span class="line">        <span class="comment">// 查看容器中的组件</span></span><br><span class="line">        String[] beanDefinitionNames = run.getBeanDefinitionNames();</span><br><span class="line">        <span class="keyword">for</span> (String beanDefinitionName : beanDefinitionNames) &#123;</span><br><span class="line">            <span class="comment">// 输出组件，可以看见配置了的 springmvc 的常用组件</span></span><br><span class="line">            System.out.println(beanDefinitionName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>主程序（@SpringBootApplication）下的包及其子包默认被扫描，无需我们再手动配置包扫描。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 支持修改扫描包路径</span></span><br><span class="line"><span class="meta">@SpringBootApplication(scanBasePackages = &quot;com.ruoxijun&quot;)</span></span><br></pre></td></tr></table></figure>

<p><code>@ComponentScan</code> 也能修改包扫描路径，但不支持与 SpringBootApplication 注解在同一类上。通过 <code>@SpringBootApplication</code> 源码可知：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @SpringBootApplication 由一下 3 个注解组成</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br></pre></td></tr></table></figure>

<p>因此我们可以使用这三个注解来代替 SpringBootApplication 注解，一样可以实现 SpringBoot 功能。</p>
<ol start="4">
<li>各种配置拥有默认值，且我们配置文件（application.properties）的配置最终都会绑定在某一个类上，这个类对象存储在 IOC 容器中。</li>
<li>所有的自动配置项按需加载，我们引入了那个场景对应场景的自动配置才会开启。在 <strong>spring-boot-starter</strong> 包中引入了一个 <strong>spring-boot-autoconfigure</strong> 包 SpringBoot 所有的自动配置功能都在其中。</li>
</ol>
<h3 id="容器功能："><a href="#容器功能：" class="headerlink" title="容器功能："></a>容器功能：</h3><h4 id="1-Configuration："><a href="#1-Configuration：" class="headerlink" title="1. @Configuration："></a>1. @Configuration：</h4><h5 id="使用"><a href="#使用" class="headerlink" title="使用:"></a>使用:</h5><ul>
<li>使用 @Configuration 配置类注册组件：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">// 标记为配置类(默认 Full 模式)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">// 给容器中添加组件，以方法名作为组件 id，返回类型就是组件类型</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// new User(pet()); // 组件依赖，调用方法也会从容器中获取 pet 组件</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;tom&quot;)</span> <span class="comment">// 指定组件名</span></span><br><span class="line">    <span class="keyword">public</span> Pet <span class="title function_">pet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Pet</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在主程序类中检验并获取组件：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// IOC 容器</span></span><br><span class="line"><span class="type">ConfigurableApplicationContext</span> <span class="variable">run</span> <span class="operator">=</span> SpringApplication.run(MainApplication.class, args);</span><br><span class="line"><span class="comment">// 获取组件</span></span><br><span class="line"><span class="type">MyConfig</span> <span class="variable">myConfig</span> <span class="operator">=</span> run.getBean(<span class="string">&quot;myConfig&quot;</span>, MyConfig.class); <span class="comment">// 配置类本身也是组件</span></span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> run.getBean(<span class="string">&quot;user&quot;</span>, User.class); <span class="comment">// 默认为单实例</span></span><br><span class="line"><span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> myConfig.user(); <span class="comment">// user == user1</span></span><br><span class="line"><span class="type">Pet</span> <span class="variable">tom</span> <span class="operator">=</span> run.getBean(Pet.class);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>@Configuration(proxyBeanMethods = false)</code> ：可以获取到单实例组件（Lite 模式）</li>
</ul>
<h5 id="Full-模式："><a href="#Full-模式：" class="headerlink" title="Full 模式："></a>Full 模式：</h5><ol>
<li>标注有 <code>@Configuration</code> 或 <code>@Configuration(proxyBeanMethods = true)</code> 的类被称为Full模式的配置类。</li>
<li>生成 CGLIB 子类，单例组件之间有依赖关系时使用，方便管理。每次都会在容器中查找是否有此组件（没有时创建并加入容器），效率较低。</li>
</ol>
<h5 id="Lite-模式："><a href="#Lite-模式：" class="headerlink" title="Lite 模式："></a>Lite 模式：</h5><ol>
<li>类上有 <code>@Component</code> 、 <code>@ComponentScan</code> 、 <code>@Import</code> 、 <code>@ImportResource</code> 、 <code>@Configuration(proxyBeanMethods = false)</code> 注解或类上没有任何注解，但是类中存在 <code>@Bean</code> 方法。</li>
<li>运行时不用生成 CGLIB 子类，提高运行性能，降低启动时间，可以作为普通类使用。不方便管理组件之间的依赖关系。</li>
</ol>
<h4 id="2-Import："><a href="#2-Import：" class="headerlink" title="2. @Import："></a>2. @Import：</h4><ul>
<li>可以作用在任意组件类的上方导入，值为任意类型组件数组，给容器中自动创建出对应类型的组件，默认组件的名字是全类名。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(&#123;User.class, Pet.class&#125;)</span></span><br></pre></td></tr></table></figure>

<ul>
<li>@Import 高级用法： <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1gW411W7wy?p=8">https://www.bilibili.com/video/BV1gW411W7wy?p=8</a></li>
</ul>
<h4 id="3-Conditional："><a href="#3-Conditional：" class="headerlink" title="3. @Conditional："></a>3. @Conditional：</h4><p><code>@Conditional</code> 条件装配注解，当满足条件时装配组件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">// 标记为配置类</span></span><br><span class="line"><span class="comment">// 当容器中没有 id 为 tom 的组件时装配该配置类</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(name = &quot;tom&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line">    <span class="comment">// 组件中存在 id 为 tom 的组件时，才装配 user 组件</span></span><br><span class="line">    <span class="meta">@ConditionalOnBean(name = &quot;tom&quot;)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(&quot;tom&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Pet <span class="title function_">pet</span><span class="params">()</span> &#123; <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Pet</span>(); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在主程序中使用 <code>run.containsBean(&quot;tom&quot;);</code> 检验是否存在某组件。</p>
<ul>
<li>常见条件装配注解如下：</li>
</ul>
<p><img src="/images/java/springboot/conditional.png" alt="创建spring boot项目步骤"></p>
<h4 id="4-ImportResource："><a href="#4-ImportResource：" class="headerlink" title="4. @ImportResource："></a>4. @ImportResource：</h4><p><code>@ImportResource</code> 允许我们导入 spring 的 xml 配置文件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在配置类上使用</span></span><br><span class="line"><span class="meta">@ImportResource(&quot;classpath:beans.xml&quot;)</span> <span class="comment">// 导入 resources 中的 beans.xml 配置文件</span></span><br></pre></td></tr></table></figure>

<h4 id="5-配置绑定："><a href="#5-配置绑定：" class="headerlink" title="5. 配置绑定："></a>5. 配置绑定：</h4><p>读取 properties 文件中的内容，并且把它封装到 JavaBean 中。</p>
<h5 id="1-原生-java-方法："><a href="#1-原生-java-方法：" class="headerlink" title="1. 原生 java 方法："></a>1. 原生 java 方法：</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">getProperties</span> &#123;</span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> FileNotFoundException, IOException &#123;</span><br><span class="line">         <span class="type">Properties</span> <span class="variable">pps</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">         pps.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;a.properties&quot;</span>));</span><br><span class="line">         <span class="type">Enumeration</span> <span class="variable">enum1</span> <span class="operator">=</span> pps.propertyNames();<span class="comment">//得到配置文件的名字</span></span><br><span class="line">         <span class="keyword">while</span>(enum1.hasMoreElements()) &#123;</span><br><span class="line">             <span class="type">String</span> <span class="variable">strKey</span> <span class="operator">=</span> (String) enum1.nextElement();</span><br><span class="line">             <span class="type">String</span> <span class="variable">strValue</span> <span class="operator">=</span> pps.getProperty(strKey);</span><br><span class="line">             System.out.println(strKey + <span class="string">&quot;=&quot;</span> + strValue);</span><br><span class="line">             <span class="comment">//封装到JavaBean。</span></span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-类已是组件："><a href="#2-类已是组件：" class="headerlink" title="2. 类已是组件："></a>2. 类已是组件：</h5><ul>
<li>IDEA 中使用 ConfigurationProperties 编辑器可能会提示 <code>Spring Boot Configuration Annotation Processor not configured</code> 未配置 Spring 引导配置注释处理器，引入如下依赖即可：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">                         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>组件类上：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">// 1. 声明为组件注册到容器中</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;mycar&quot;)</span> <span class="comment">// 2. 通过前缀绑定配置</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="comment">// 省略 get、set 方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>配置属性：</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mycar.name = MyCar</span><br><span class="line">mycar.age = 18</span><br></pre></td></tr></table></figure>

<ul>
<li>组件中还支持 <code>@Value($&#123;属性&#125;)</code> 方式注入</li>
</ul>
<h5 id="3-在配置类上开启："><a href="#3-在配置类上开启：" class="headerlink" title="3. 在配置类上开启："></a>3. 在配置类上开启：</h5><ol>
<li>为类绑定前缀</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;mycar&quot;)</span> <span class="comment">// 配置属性前缀</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在配置类声明开启：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">// 标记为配置类</span></span><br><span class="line"><span class="comment">// 开启 Car 属性配置功能，并将 Car 组件自动注册到容器中</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(Car.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自动配置原理："><a href="#自动配置原理：" class="headerlink" title="自动配置原理："></a>自动配置原理：</h3><p><code>@SpringBootApplication</code> 注解有以下 3 个主要注解构成：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan( // 指定扫描包</span></span><br><span class="line"><span class="meta">    excludeFilters = &#123;@Filter(</span></span><br><span class="line"><span class="meta">    type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">    classes = &#123;TypeExcludeFilter.class&#125;</span></span><br><span class="line"><span class="meta">), @Filter(</span></span><br><span class="line"><span class="meta">    type = FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">    classes = &#123;AutoConfigurationExcludeFilter.class&#125;</span></span><br><span class="line"><span class="meta">)&#125;)</span></span><br></pre></td></tr></table></figure>

<h4 id="1-SpringBootConfiguration："><a href="#1-SpringBootConfiguration：" class="headerlink" title="1. @SpringBootConfiguration："></a>1. @SpringBootConfiguration：</h4><p>主要构成如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Indexed</span></span><br></pre></td></tr></table></figure>

<p><code>@SpringBootConfiguration</code> 表示 <code>@SpringBootApplication</code> 标记的类是一个配置类。</p>
<h4 id="2-EnableAutoConfiguration："><a href="#2-EnableAutoConfiguration：" class="headerlink" title="2. @EnableAutoConfiguration："></a>2. @EnableAutoConfiguration：</h4><p><code>@EnableAutoConfiguration</code> 由以下两个注解构成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@AutoConfigurationPackage</span><br><span class="line">@Import(&#123;AutoConfigurationImportSelector.class&#125;)</span><br></pre></td></tr></table></figure>

<ol>
<li>@AutoConfigurationPackage:</li>
</ol>
<p>自动配置包指定了默认的包规则，查看源码 <code>@Import(&#123;Registrar.class&#125;)</code> 可以发现它导入了一个 <code>Registrar</code> 组件，而查看这个组件源码可以发现它有一个方法会给容器注入一系列组件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(</span></span><br><span class="line"><span class="params">    AnnotationMetadata metadata, // 注解原信息（注解标记位置、属性值...）</span></span><br><span class="line"><span class="params">    BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">    <span class="comment">// 将指定包下的所有组件导入</span></span><br><span class="line">    AutoConfigurationPackages.register(registry,</span><br><span class="line">        <span class="comment">// 拿到项目包名（com.ruxijun），封装到一个字符串数组中</span></span><br><span class="line">        (String[])(<span class="keyword">new</span> <span class="title class_">AutoConfigurationPackages</span>.PackageImports(metadata)).getPackageNames()</span><br><span class="line">        .toArray(<span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>由此可知 <code>@AutoConfigurationPackage</code> 作用是利用 <code>Registrar</code> 将 <strong>主程序（@SpringBootApplication）</strong> 包以及子包内的组件导入容器中。</li>
</ul>
<ol start="2">
<li>AutoConfigurationImportSelector.class</li>
</ol>
<p>查看 <code>AutoConfigurationImportSelector</code> 它会批量给容器导入一些组件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 利用 getAutoConfigurationEntry(annotationMetadata) 给容器中批量导入组件</span><br><span class="line"><span class="number">2.</span> 调用 getCandidateConfigurations(annotationMetadata, attributes) 获取到所有需要导入容器中的配置类</span><br><span class="line"><span class="number">3.</span> 利用工厂 SpringFactoriesLoader.loadFactoryNames 最终调用 Map&lt;String, List&lt;String&gt;&gt; <span class="title function_">loadSpringFactories</span><span class="params">(ClassLoader classLoader)</span> 方法得到所有配置类</span><br><span class="line"><span class="number">4.</span> 加载文件 classLoader.getResources(<span class="string">&quot;META-INF/spring.factories&quot;</span>) 默认扫描项目中所有 META-INF/spring.factories 位置文件</span><br><span class="line">核心包 spring-boot-autoconfigure.jar 的 META-INF/spring.factories 文件中配置了项目启动就需要全部加载的不同场景的配置类</span><br></pre></td></tr></table></figure>

<ul>
<li><p>虽然 <strong>一百多</strong> 个场景的所有自动配置类启动的时候默认全部加载（xxxxAutoConfiguration），但它们还受条件装配规则限制（ <strong>@Conditional</strong> ），最终实现 <strong>按需配置</strong> 。</p>
</li>
<li><p>目前 2.7.1 版本文件位置： <strong>META-INF&#x2F;spring&#x2F;%s.imports</strong></p>
</li>
</ul>
<h4 id="3-修改默认配置："><a href="#3-修改默认配置：" class="headerlink" title="3. 修改默认配置："></a>3. 修改默认配置：</h4><ul>
<li>注册文件上传解析器组件源码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 该配置类上 @EnableConfigurationProperties(&#123;WebMvcProperties.class&#125;) // 对应的可配置选项</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnBean(&#123;MultipartResolver.class&#125;)</span> <span class="comment">// 容器中有这个类型组件</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(name = &#123;&quot;multipartResolver&quot;&#125;)</span> <span class="comment">// 容器中没有此名称的组件</span></span><br><span class="line"><span class="comment">//给 @Bean 标注的方法传入了对象参数，这个参数的值就会从容器中寻找</span></span><br><span class="line"><span class="keyword">public</span> MultipartResolver <span class="title function_">multipartResolver</span><span class="params">(MultipartResolver resolver)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> resolver; <span class="comment">// 这个方法防止用户配置的文件上传解析器名称不符合规范</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>注册字符编码过滤器组件源码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 该配置类上 @EnableConfigurationProperties(&#123;ServerProperties.class&#125;) // 对应的可配置选项</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="keyword">public</span> CharacterEncodingFilter <span class="title function_">characterEncodingFilter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 对字符编码配置后返回对象加入到容器中...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由上可知 SpringBoot 默认会在底层配好所有的组件，但是如果用户自己配置了以用户的优先。因此我们想修改默认配置或定制化配置方法如下：</p>
<ol>
<li>在自己的配置文件中 <code>@bean</code> 替换需要修改的组件。</li>
<li>通过查看配置类绑定了配置文件的哪些属性，在 properties 中修改配置值。</li>
</ol>
<h4 id="4-总结："><a href="#4-总结：" class="headerlink" title="4. 总结："></a>4. 总结：</h4><ul>
<li>SpringBoot先加载所有的自动配置类 xxxxxAutoConfiguration.class</li>
<li>每个自动配置类按照条件进行生效，默认都会绑定配置文件指定的值。 xxxxProperties.class 和配置文件进行了绑定。</li>
<li>生效的配置类就会给容器中装配很多相应场景的组件，并帮我们配置好组件相应功能。</li>
</ul>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/application-properties.html">配置属性文档 Common Application Properties (spring.io)</a></p>
<h3 id="常用配置："><a href="#常用配置：" class="headerlink" title="常用配置："></a>常用配置：</h3><p>在 <strong>resource</strong> 文件夹中新建 <strong><code>application.properties</code></strong> 或者 <strong><code>application.yml</code></strong> 配置文件。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 项目端口</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8081</span></span><br><span class="line"><span class="comment"># 访问项目时的路径前缀</span></span><br><span class="line"><span class="attr">server.servlet.context-path</span>=<span class="string">/bootTest</span></span><br><span class="line"><span class="comment">#数据源配置</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/test?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=GMT%2B8</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">88888888</span></span><br></pre></td></tr></table></figure>

<p><code>properties</code> 转 <code>yml</code> ：<a target="_blank" rel="noopener" href="https://www.toyaml.com/index.html">在线yaml与properties互转</a></p>
<h3 id="yml-配置方式："><a href="#yml-配置方式：" class="headerlink" title="yml 配置方式："></a>yml 配置方式：</h3><ol>
<li>绑定配置项：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> Car car;</span><br><span class="line">    <span class="keyword">private</span> String[] arr;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; list;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; set;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; map;</span><br><span class="line">    <span class="comment">// get set toString...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>yml 配置方式：</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">user:</span></span><br><span class="line">  <span class="comment"># 如有驼峰命名属性建议使用 ‘-’ 加小写字母</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ruoxi</span> <span class="comment"># 字符串可不加引号，单引号会转义（\n）双引号不会转义</span></span><br><span class="line">  <span class="attr">age:</span> <span class="string">$&#123;random.int&#125;</span> <span class="comment"># 支持表达式</span></span><br><span class="line">  <span class="attr">car:</span> <span class="comment"># &#123; name: rouxiCar, age: 1 &#125; # 对象行内写法（map、hash、object）</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">rouxiCar</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">arr:</span> <span class="comment"># [ 1, 2 ] # 数组行内写法（array、list、set、queue）</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">1</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">list:</span> [ <span class="number">3</span>, <span class="number">4</span> ]</span><br><span class="line">  <span class="attr">set:</span> [ <span class="number">5</span>, <span class="number">6</span> ]</span><br><span class="line">  <span class="attr">map:</span></span><br><span class="line">    <span class="attr">a:</span> &#123; <span class="attr">a:</span> <span class="string">map</span> &#125;</span><br><span class="line">    <span class="attr">b:</span> &#123; <span class="attr">b:</span> <span class="string">map</span> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="启动图标："><a href="#启动图标：" class="headerlink" title="启动图标："></a>启动图标：</h3><p>在线生成字符图标工具：</p>
<p><a target="_blank" rel="noopener" href="http://www.network-science.de/ascii/">http://www.network-science.de/ascii/</a><br><a target="_blank" rel="noopener" href="http://patorjk.com/software/taag/">http://patorjk.com/software/taag/</a></p>
<p><strong>推荐</strong> ：</p>
<p><a target="_blank" rel="noopener" href="https://www.bootschool.net/ascii">Spring Boot banner在线生成工具，制作下载banner.txt，修改替换banner.txt文字实现自定义，个性化启动banner-bootschool.net</a></p>
<p>我们只需在 <em>resource</em> 文件夹下新建一个 <strong>banner.txt</strong> 文件，在该文本文件中粘贴你想要的SpringBoot启动时显示的字符图标就好了。</p>
<p>关闭图标：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SpringApplication</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SpringApplication</span>(MainApplication.class);</span><br><span class="line">app.setBannerMode(Banner.Mode.OFF);</span><br><span class="line">app.run(args);</span><br></pre></td></tr></table></figure>

<h3 id="热部署："><a href="#热部署：" class="headerlink" title="热部署："></a>热部署：</h3><blockquote>
<p>  idea需要的设置：</p>
<ol>
<li>file-&gt;settings-&gt;build-&gt;Build project automatically <strong>勾选</strong></li>
<li>file-&gt;settings -&gt; Advanced Settings -&gt; Allow auto-make to start even if developed application is currently running <strong>勾选</strong> （这是idea2020.2设置的位置其它版本请上网自查）</li>
</ol>
</blockquote>
<h4 id="1-pom-xml-配置："><a href="#1-pom-xml-配置：" class="headerlink" title="1. pom.xml 配置："></a>1. pom.xml 配置：</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1. 添加热部署依赖 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span><span class="comment">&lt;!-- 使继承的项目不会继承热部署 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 2. 在SpringBoot的打包插件中配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span><span class="comment">&lt;!--将应用打包为一个可执行的jar包 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span> <span class="comment">&lt;!-- 热部署开启 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">fork</span>&gt;</span>true<span class="tag">&lt;/<span class="name">fork</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-主配置文件配置："><a href="#2-主配置文件配置：" class="headerlink" title="2. 主配置文件配置："></a>2. 主配置文件配置：</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">devtools:</span> <span class="comment"># 热部署配置</span></span><br><span class="line">    <span class="attr">restart:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启</span></span><br><span class="line">      <span class="comment"># 设置监听的目录</span></span><br><span class="line">      <span class="attr">additional-paths:</span> <span class="string">src/main/java</span></span><br><span class="line">      <span class="comment"># 应付项目自动重启编译后404问题</span></span><br><span class="line">      <span class="attr">poll-interval:</span> <span class="number">3000</span></span><br><span class="line">      <span class="attr">quiet-period:</span> <span class="number">1000</span></span><br></pre></td></tr></table></figure>

<p><strong>热部署快捷键 <code>Ctrl+F9</code></strong> </p>
<h3 id="打包："><a href="#打包：" class="headerlink" title="打包："></a>打包：</h3><h4 id="jar-包："><a href="#jar-包：" class="headerlink" title="jar 包："></a>jar 包：</h4><p>添加插件将 spring boot 应用打包为可执行 jar 包并运行，pom.xml 中添加如下代码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span><span class="comment">&lt;!-- 默认将应用打包为一个可执行的jar包 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在打包的 jar 包位置使用 <code>java -jar 项目的jar文件名</code> 命令即可运行。</p>
<ul>
<li>如不能成功请尝试关闭 cmd 快速编辑模式（右击 cmd 窗口点击属性）</li>
</ul>
<h4 id="war-包："><a href="#war-包：" class="headerlink" title="war 包："></a>war 包：</h4><p>将文件打包为war包，在pom.xml中配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 设置打包类型为war --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>因为 SpringBoot 中默认内置 tomcat 服务器，我们需要将它内置的 tomcat 在打包时忽略掉因此在 pom.xml 的 <strong>dependencies</strong> 配置中添加：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>最后在 SpringBoot 启动类中继承 <code>SpringBootServletInitializer</code> 类重写 <code>configure</code> 方法，之后打包即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApplication</span> <span class="keyword">extends</span> <span class="title class_">SpringBootServletInitializer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        SpringApplication.run(MainApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> SpringApplicationBuilder <span class="title function_">configure</span><span class="params">(SpringApplicationBuilder builder)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> builder.sources(MainApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Profile："><a href="#Profile：" class="headerlink" title="Profile："></a>Profile：</h3><h4 id="环境配置："><a href="#环境配置：" class="headerlink" title="环境配置："></a>环境配置：</h4><ul>
<li><p><code>application.properties</code> （yaml 同理）表示默认环境配置，SpringBoot 还支持我们开启和配置不同环境的配置文件。</p>
</li>
<li><p>自定义环境配置文件 <code>application-环境名称.yaml</code> ，常用配置环境名称有 <strong>dev</strong> 开发环境、 <strong>test</strong> 测试环境、 <strong>prod</strong> 生产环境。</p>
</li>
<li><p>默认配置文件与环境配置文件同时生效，且同名配置环境配置优先。</p>
</li>
<li><p>在 <strong><code>application.properties</code></strong> 默认配置文件中指定激活某环境配置：</p>
</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.profiles.active</span>=<span class="string">dev # 激活并使用 application-dev 中的配置</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>命令行开启方式 <code>java -jar 项目.jar --spring.profiles.active=prod  --person.name=haha</code> ，使用命令行方式修改配置属性（如这里还将 person.name 配置为了 haha）。</p>
</li>
<li><p>条件装配 <code>@Profile(&quot;test&quot;)</code> 该注解装配的类或方法在指定环境（如这是 test 环境）下才生效。</p>
</li>
<li><p>激活多个配置文件：</p>
</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 激活一组环境</span></span><br><span class="line"><span class="attr">spring.profiles.active</span>= <span class="string">production</span></span><br><span class="line"><span class="comment"># spring.profiles.group.组名[脚标]=环境名</span></span><br><span class="line"><span class="attr">spring.profiles.group.production[0]</span>=<span class="string">proddb</span></span><br><span class="line"><span class="attr">spring.profiles.group.production[1]</span>=<span class="string">prodmq</span></span><br></pre></td></tr></table></figure>

<ul>
<li>配置文件位置(注意 1-5 数越大优先级越高)：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1</span>) classpath 根路径</span><br><span class="line">(<span class="number">2</span>) classpath 根路径下 config 目录</span><br><span class="line">(<span class="number">3</span>) jar 包当前目录</span><br><span class="line">(<span class="number">4</span>) jar 包当前目录的 config 目录</span><br><span class="line">(<span class="number">5</span>) /config 子目录的直接子目录</span><br></pre></td></tr></table></figure>

<h3 id="自定义-starter"><a href="#自定义-starter" class="headerlink" title="自定义 starter"></a>自定义 starter</h3><p><a target="_blank" rel="noopener" href="https://www.yuque.com/atguigu/springboot/tmvr0e">原理解析 (https://www.yuque.com/atguigu/springboot/tmvr0e)</a></p>
<h2 id="web-开发"><a href="#web-开发" class="headerlink" title="web 开发"></a>web 开发</h2><h3 id="静态资源："><a href="#静态资源：" class="headerlink" title="静态资源："></a>静态资源：</h3><h4 id="静态资源使用："><a href="#静态资源使用：" class="headerlink" title="静态资源使用："></a>静态资源使用：</h4><p>在 SpringBoot 中规定 <strong>resources</strong> 下的 <code>/META-INF/resources</code> 、 <code>/resources</code> 、 <code>/static</code>、 <code>/public</code> （同名文件按此优先级）等文件夹都可以存放静态资源我们只需按规定建立文件夹即可。</p>
<p>在配置文件中指定 resources 文件夹中的哪些文件夹为静态资源文件夹：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="comment"># 指定静态资源文件夹，使用逗号分隔多个</span></span><br><span class="line">      <span class="attr">static-locations:</span> <span class="string">classpath:/public/,classpath:/static/,classpath:/staticFile</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>访问方式： <code>项目根路径/资源路径名</code> （访问时不用加上static等静态文件夹的名作为路径一部分）</p>
</li>
<li><p>请求优先由 Controller 处理，没有相关请求时再寻找静态资源。因此静态资源中有与 Controller 相同的请求路径时由 Controller 处理，将不能请求到静态资源。</p>
</li>
</ul>
<p>为静态资源设置访问前缀：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">static-path-pattern:</span> <span class="string">/static/**</span> <span class="comment"># 访问所有的静态资源都需要添加此路径前缀</span></span><br></pre></td></tr></table></figure>

<ul>
<li>SpringBoot 中默认静态资源文件夹下的 <code>index.html</code> 为首页（不推荐），直接访问项目根路径将访问到此页面（未设置静态资源访问前缀的情况下）。</li>
<li>设置网页图标只需在静态资源文件夹中添加名为 <code>favicon.ico</code> 的图片即可。</li>
</ul>
<h4 id="自定义静态资源处理规则："><a href="#自定义静态资源处理规则：" class="headerlink" title="自定义静态资源处理规则："></a>自定义静态资源处理规则：</h4><p>如我们需要访问指定位置的文件时可以如下配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// 添加静态资源处理规则</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// 请求路径 （访问方式：项目路径/file/文件名）</span></span><br><span class="line">        registry.addResourceHandler(<span class="string">&quot;/file/**&quot;</span>)</span><br><span class="line">                <span class="comment">// 文件路径（项目 resources 文件夹下使用 class: 前缀）</span></span><br><span class="line">                .addResourceLocations(<span class="string">&quot;file:E:\\myfile\\&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="静态资源配置原理："><a href="#静态资源配置原理：" class="headerlink" title="静态资源配置原理："></a>静态资源配置原理：</h4><h5 id="1-WebMvcAutoConfiguration"><a href="#1-WebMvcAutoConfiguration" class="headerlink" title="1. WebMvcAutoConfiguration:"></a>1. WebMvcAutoConfiguration:</h5><p>SpringBoot 启动时自动加载 xxxAutoConfiguration 类，其中 SpringMvc 功能的自动配置类 <code>WebMvcAutoConfiguration</code> 加载成功且生效：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration(</span></span><br><span class="line"><span class="meta">    after = &#123;DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class, ValidationAutoConfiguration.class&#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(</span></span><br><span class="line"><span class="meta">    type = Type.SERVLET</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class&#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(&#123;WebMvcConfigurationSupport.class&#125;)</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(-2147483638)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfiguration</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-WebMvcAutoConfigurationAdapter："><a href="#2-WebMvcAutoConfigurationAdapter：" class="headerlink" title="2. WebMvcAutoConfigurationAdapter："></a>2. WebMvcAutoConfigurationAdapter：</h5><p>在 WebMvcAutoConfiguration 有一个配置类 <code>WebMvcAutoConfigurationAdapter</code> ：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration( proxyBeanMethods = false )</span></span><br><span class="line"><span class="meta">@Import(&#123;WebMvcAutoConfiguration.EnableWebMvcConfiguration.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;WebMvcProperties.class, WebProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@Order(0)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfigurationAdapter</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span>, ServletContextAware &#123;...&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>这个类绑定了两个配置属性： WebMvcProperties.class &#x3D; spring.mvc，WebProperties.class &#x3D; spring.web</li>
<li>且这个配置类只有一个有参构造器，<strong>当配置类只有一个有参构造器时所有的参数都会自动充容器里面找</strong> ：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webProperties mvcProperties 获取配置绑定值的对象</span></span><br><span class="line"><span class="comment">// ListableBeanFactory beanFactory Spring 的 beanFactory</span></span><br><span class="line"><span class="comment">// HttpMessageConverters 找到所有的 HttpMessageConverters</span></span><br><span class="line"><span class="comment">// ResourceHandlerRegistrationCustomizer 找到 资源处理器的自定义器。=========</span></span><br><span class="line"><span class="comment">// DispatcherServletPath  </span></span><br><span class="line"><span class="comment">// ServletRegistrationBean 给应用注册 Servlet、Filter....</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">WebMvcAutoConfigurationAdapter</span><span class="params">(</span></span><br><span class="line"><span class="params">    WebProperties webProperties, WebMvcProperties mvcProperties,</span></span><br><span class="line"><span class="params">    ListableBeanFactory beanFactory,</span></span><br><span class="line"><span class="params">    ObjectProvider&lt;HttpMessageConverters&gt; messageConvertersProvider,</span></span><br><span class="line"><span class="params">    ObjectProvider&lt;WebMvcAutoConfiguration.ResourceHandlerRegistrationCustomizer&gt; resourceHandlerRegistrationCustomizerProvider,</span></span><br><span class="line"><span class="params">    ObjectProvider&lt;DispatcherServletPath&gt; dispatcherServletPath,</span></span><br><span class="line"><span class="params">    ObjectProvider&lt;ServletRegistrationBean&lt;?&gt;&gt; servletRegistrations)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.resourceProperties = webProperties.getResources();</span><br><span class="line">    <span class="built_in">this</span>.mvcProperties = mvcProperties;</span><br><span class="line">    <span class="built_in">this</span>.beanFactory = beanFactory;</span><br><span class="line">    <span class="built_in">this</span>.messageConvertersProvider = messageConvertersProvider;</span><br><span class="line">    <span class="built_in">this</span>.resourceHandlerRegistrationCustomizer = (WebMvcAutoConfiguration.ResourceHandlerRegistrationCustomizer)resourceHandlerRegistrationCustomizerProvider.getIfAvailable();</span><br><span class="line">    <span class="built_in">this</span>.dispatcherServletPath = dispatcherServletPath;</span><br><span class="line">    <span class="built_in">this</span>.servletRegistrations = servletRegistrations;</span><br><span class="line">    <span class="built_in">this</span>.mvcProperties.checkConfiguration();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-静态资源处理规则："><a href="#3-静态资源处理规则：" class="headerlink" title="3. 静态资源处理规则："></a>3. 静态资源处理规则：</h5><p>在 WebMvcAutoConfigurationAdapter 配置类中有一个 <code>addResourceHandlers</code> 方法，它就是静态资源处理的默认规则：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">    <span class="comment">// 检查配置 spring.web.resources.add-mappings 默认为true</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">        <span class="comment">// spring.web.resources.add-mappings 为 false 时将关闭默认的资源处理</span></span><br><span class="line">        logger.debug(<span class="string">&quot;Default resource handling disabled&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// webjars 规则：对 ‘/webjars’ 的所有请求做处理，classpath 为资源路径</span></span><br><span class="line">        <span class="built_in">this</span>.addResourceHandler(registry, <span class="string">&quot;/webjars/**&quot;</span>, <span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line">        <span class="comment">/* mvcProperties.getStaticPathPattern() 对应配置 spring.mvc.static-path-pattern，</span></span><br><span class="line"><span class="comment">           请求路径默认值 String staticPathPattern = &quot;/**&quot; */</span></span><br><span class="line">        <span class="built_in">this</span>.addResourceHandler(registry, <span class="built_in">this</span>.mvcProperties.getStaticPathPattern(), (registration) -&gt; &#123;</span><br><span class="line">            <span class="comment">/* resourceProperties.getStaticLocations() 设置静态资源路径，对应配置 spring.web.resources.static-locations,</span></span><br><span class="line"><span class="comment">               其默认值为 new String[]&#123;&quot;classpath:/META-INF/resources/&quot;, &quot;classpath:/resources/&quot;, &quot;classpath:/static/&quot;, &quot;classpath:/public/&quot;&#125; */</span></span><br><span class="line">            registration.addResourceLocations(<span class="built_in">this</span>.resourceProperties.getStaticLocations());</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.servletContext != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="type">ServletContextResource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletContextResource</span>(<span class="built_in">this</span>.servletContext, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">                registration.addResourceLocations(<span class="keyword">new</span> <span class="title class_">Resource</span>[]&#123;resource&#125;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-欢迎页处理规则："><a href="#4-欢迎页处理规则：" class="headerlink" title="4. 欢迎页处理规则："></a>4. 欢迎页处理规则：</h5><p>在 WebMvcAutoConfiguration 类中有一个 <code>EnableWebMvcConfiguration</code> 配置类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;WebProperties.class&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EnableWebMvcConfiguration</span> <span class="keyword">extends</span> <span class="title class_">DelegatingWebMvcConfiguration</span> <span class="keyword">implements</span> <span class="title class_">ResourceLoaderAware</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>

<p>其中向容器注册了一个组件 <code>WelcomePageHandlerMapping</code> ：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> WelcomePageHandlerMapping <span class="title function_">welcomePageHandlerMapping</span><span class="params">(ApplicationContext applicationContext, FormattingConversionService mvcConversionService, ResourceUrlProvider mvcResourceUrlProvider)</span> &#123;</span><br><span class="line">    <span class="type">WelcomePageHandlerMapping</span> <span class="variable">welcomePageHandlerMapping</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WelcomePageHandlerMapping</span>(<span class="keyword">new</span> <span class="title class_">TemplateAvailabilityProviders</span>(applicationContext), applicationContext, <span class="built_in">this</span>.getWelcomePage(), <span class="built_in">this</span>.mvcProperties.getStaticPathPattern());</span><br><span class="line">    welcomePageHandlerMapping.setInterceptors(<span class="built_in">this</span>.getInterceptors(mvcConversionService, mvcResourceUrlProvider));</span><br><span class="line">    welcomePageHandlerMapping.setCorsConfigurations(<span class="built_in">this</span>.getCorsConfigurations());</span><br><span class="line">    <span class="keyword">return</span> welcomePageHandlerMapping;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>WelcomePageHandlerMapping 构造函数中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">WelcomePageHandlerMapping(TemplateAvailabilityProviders templateAvailabilityProviders, ApplicationContext applicationContext, Resource welcomePage, String staticPathPattern) &#123;</span><br><span class="line">    <span class="comment">// 欢迎页不为 null 且静态资源请求路径为 /** 时，转发请求 index.html</span></span><br><span class="line">    <span class="keyword">if</span> (welcomePage != <span class="literal">null</span> &amp;&amp; <span class="string">&quot;/**&quot;</span>.equals(staticPathPattern)) &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;Adding welcome page: &quot;</span> + welcomePage);</span><br><span class="line">        <span class="built_in">this</span>.setRootViewName(<span class="string">&quot;forward:index.html&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.welcomeTemplateExists(templateAvailabilityProviders, applicationContext)) &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;Adding welcome page template: index&quot;</span>);</span><br><span class="line">        <span class="comment">// 当欢迎页不存在时请求由 controller 处理</span></span><br><span class="line">        <span class="built_in">this</span>.setRootViewName(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-favicon-ico："><a href="#5-favicon-ico：" class="headerlink" title="5. favicon.ico："></a>5. favicon.ico：</h5><p>浏览器会默认请求项目下 <code>/favicon.ico</code> 作为标签页图标，并保存在 session 域中。因此在配置文件中设置了静态资源访问前缀，那么 &#x2F;favicon.ico 就会获取不到相对应的图标了。</p>
<h3 id="表单与-RestFul："><a href="#表单与-RestFul：" class="headerlink" title="表单与 RestFul："></a>表单与 RestFul：</h3><h4 id="1-开启方式："><a href="#1-开启方式：" class="headerlink" title="1. 开启方式："></a>1. 开启方式：</h4><p>一般浏览器 <strong>表单</strong> 不能发送 get、post 以外的其它请求（其它请求都被 get 请求代替，），SpringMvc 提供了 <code>HiddenHttpMethodFilter</code> 我们只需为 post 请求添加一个 <code>_method</code> 参数，参数值就是我们想使用的请求方式。</p>
<p>SpringBoot 允许我们在配置中开启这项功能：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.mvc.hiddenmethod.filter.enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h4 id="2-原理解析："><a href="#2-原理解析：" class="headerlink" title="2. 原理解析："></a>2. 原理解析：</h4><p>在 WebMvcAutoConfiguration 中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(&#123;HiddenHttpMethodFilter.class&#125;)</span> <span class="comment">// 当容器中没有该组件时（我们没有自定义时）</span></span><br><span class="line"><span class="comment">// 检查配置中 spring.mvc.hiddenmethod.filter.enabled 的值是否开启此功能（默认 false）</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty( prefix = &quot;spring.mvc.hiddenmethod.filter&quot;, name = &#123;&quot;enabled&quot;&#125; )</span></span><br><span class="line"><span class="keyword">public</span> OrderedHiddenHttpMethodFilter <span class="title function_">hiddenHttpMethodFilter</span><span class="params">()</span> &#123; <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OrderedHiddenHttpMethodFilter</span>(); &#125;</span><br></pre></td></tr></table></figure>

<p>在 HiddenHttpMethodFilter 过滤器中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">String</span> <span class="variable">methodParam</span> <span class="operator">=</span> <span class="string">&quot;_method&quot;</span>; <span class="comment">// 默认值 _method</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMethodParam</span><span class="params">(String methodParam)</span> &#123; <span class="comment">// 修改 methodParam</span></span><br><span class="line">    Assert.hasText(methodParam, <span class="string">&quot;&#x27;methodParam&#x27; must not be empty&quot;</span>);</span><br><span class="line">    <span class="built_in">this</span>.methodParam = methodParam;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1. 拦截请求</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="type">HttpServletRequest</span> <span class="variable">requestToUse</span> <span class="operator">=</span> request;</span><br><span class="line">    <span class="comment">// 是 POST 请求且没有错误时</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;POST&quot;</span>.equals(request.getMethod()) &amp;&amp; request.getAttribute(<span class="string">&quot;javax.servlet.error.exception&quot;</span>) == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 获取到请求数据中 _method 参数的值</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">paramValue</span> <span class="operator">=</span> request.getParameter(<span class="built_in">this</span>.methodParam);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasLength(paramValue)) &#123; <span class="comment">// 有值时</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> paramValue.toUpperCase(Locale.ENGLISH); <span class="comment">// 转为大写</span></span><br><span class="line">            <span class="comment">// 2. 检查是否是允许的请求方式（ALLOWED_METHODS：PUT、DELETE、PATCH）</span></span><br><span class="line">            <span class="keyword">if</span> (ALLOWED_METHODS.contains(method)) &#123;</span><br><span class="line">                <span class="comment">// 3. 将原生 request 替换为包装模式的 requestWrapper 重写了 getMethod 方法并传入 _method 参数的值</span></span><br><span class="line">                requestToUse = <span class="keyword">new</span> <span class="title class_">HiddenHttpMethodFilter</span>.HttpMethodRequestWrapper(request, method);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4. 过滤器放行 request（上面条件成立则放行被替换的 request）</span></span><br><span class="line">    filterChain.doFilter((ServletRequest)requestToUse, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-自定义-HiddenHttpMethodFilter："><a href="#3-自定义-HiddenHttpMethodFilter：" class="headerlink" title="3. 自定义 HiddenHttpMethodFilter："></a>3. 自定义 HiddenHttpMethodFilter：</h4><p>参照 WebMvcAutoConfiguration 自定义 HiddenHttpMethodFilter：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HiddenHttpMethodFilter <span class="title function_">hiddenHttpMethodFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HiddenHttpMethodFilter</span> <span class="variable">hiddenHttpMethodFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HiddenHttpMethodFilter</span>();</span><br><span class="line">        hiddenHttpMethodFilter.setMethodParam(<span class="string">&quot;_m&quot;</span>); <span class="comment">// 修改 _method 为 _m 参数</span></span><br><span class="line">        <span class="keyword">return</span> hiddenHttpMethodFilter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>表单现在只需添加一个 <code>-m</code> 参数，参数值为 PUT、DELETE、PATCH 其中一个，它就会去访问对应的请求方法了。</p>
<h3 id="请求映射原理："><a href="#请求映射原理：" class="headerlink" title="请求映射原理："></a>请求映射原理：</h3><p>SpringMvc 中通过 <code>DispatcherServlet</code> 做请求分发，SpringBoot 同理也一样。DispatcherServlet 是 Servlet 因此它肯定有 doGet 等方法。</p>
<ol>
<li>DispatcherServlet 继承关系（idea 中 Ctrl+F12 查看）：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DispatcherServlet -&gt; FrameworkServlet -&gt; HttpServletBean -&gt; HttpServlet</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>FrameworkServlet 中重写了 doGet 等方法（idea 中 Ctrl+H 查看），并且可以发现 doGet 等方法都调用了 processRequest 方法它又调用了 doService 方法处理请求：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="built_in">this</span>.processRequest(request, response); <span class="comment">// 调用 processRequest 处理</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">processRequest</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">    <span class="comment">/* 初始化过程，省略... */</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.doService(request, response); <span class="comment">// 调用 doService 统一处理请求</span></span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">/* 省略... */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 它抽象方法因此可知请求被 DispatcherServlet 实现的 doService 方法处理</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">doService</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>DispatcherServlet 中 doService 最终调用 <code>doDispatch</code> 方法派发请求：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">/* ... */</span></span><br><span class="line">    <span class="comment">// 拿到当前请求的处理器</span></span><br><span class="line">    mappedHandler = <span class="built_in">this</span>.getHandler(processedRequest);</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>在 DispatcherServlet 中有一个 <code>List&lt;HandlerMapping&gt; handlerMappings</code> 参数它存储了许多请求的 <strong>映射处理器</strong> HandlerMapping， <code>getHandler</code> 方法中它会遍历这些映射处理器，并获取到能够处理当前请求的 handler：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> HandlerExecutionChain <span class="title function_">getHandler</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.handlerMappings != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">var2</span> <span class="operator">=</span> <span class="built_in">this</span>.handlerMappings.iterator();</span><br><span class="line">        <span class="keyword">while</span>(var2.hasNext()) &#123; <span class="comment">// 遍历</span></span><br><span class="line">            <span class="type">HandlerMapping</span> <span class="variable">mapping</span> <span class="operator">=</span> (HandlerMapping)var2.next(); <span class="comment">// 当前映射处理器</span></span><br><span class="line">            <span class="type">HandlerExecutionChain</span> <span class="variable">handler</span> <span class="operator">=</span> mapping.getHandler(request); <span class="comment">// 获取 handler</span></span><br><span class="line">            <span class="keyword">if</span> (handler != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> handler;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>handlerMappings 中有一个 <code>RequestMappingHandlerMapping</code> 它保存了所有 @RequestMapping 相关和handler 的映射规则。还有 <code>WelcomePageHandlerMapping</code> 它就是欢迎页面 <code>/index.html</code> 的映射处理器，它们都是 WebMvcAutoConfiguration 中帮我们配置好的。</li>
<li>遍历时查询 HandlerMapping 中是否有对应处理请求的 handler，如果当前 HandlerMapping 中没有则继续在下一个 HandlerMapping 中寻找。</li>
</ul>
<ol start="5">
<li>同理我们可以自定义映射处理器 HandlerMapping。</li>
</ol>
<h3 id="自定义-MVC"><a href="#自定义-MVC" class="headerlink" title="自定义 MVC:"></a>自定义 MVC:</h3><ul>
<li>SpringBoot 默认是关闭矩阵变量的 <code>@MatrixVariable</code>  ，在 WebMvcAutoConfiguration 中 WebMvcAutoConfigurationAdapter 内有一个 <code>configurePathMatch</code> 方法它是来配置路径映射的我们需要修改一下路径路径匹配规则，而这个方法是通过 <code>UrlPathHelper</code> 对路径进行解析此类中有一个 <code>removeSemicolonContent</code> 默认为 <code>true</code> 表示移除 URL 路径分号的内容。</li>
</ul>
<p>想开启矩阵变量功能，我们需要自定义 MVC SpringBoot 提供了三种方式：</p>
<ol>
<li>@Configuration + 实现 <code>WebMvcConfigurer</code> 接口(推荐使用)：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123; <span class="comment">// 实现 WebMvcConfigurer 接口</span></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// 重写 configurePathMatch</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configurePathMatch</span><span class="params">(PathMatchConfigurer configurer)</span> &#123;</span><br><span class="line">        <span class="type">UrlPathHelper</span> <span class="variable">urlPathHelper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlPathHelper</span>(); <span class="comment">// 自定义 UrlPathHelper</span></span><br><span class="line">        urlPathHelper.setRemoveSemicolonContent(<span class="literal">false</span>); <span class="comment">// 不让异常分号内容</span></span><br><span class="line">        configurer.setUrlPathHelper(urlPathHelper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>@Bean 注册 WebMvcConfigurer 组件：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">// 注册 WebMvcConfigurer 组件</span></span><br><span class="line">    <span class="keyword">public</span> WebMvcConfigurer <span class="title function_">webMvcConfigurer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>() &#123; <span class="comment">// 自定义 WebMvcConfigurer</span></span><br><span class="line">            <span class="meta">@Override</span> <span class="comment">// 重写</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configurePathMatch</span><span class="params">(PathMatchConfigurer configurer)</span> &#123;</span><br><span class="line">                <span class="type">UrlPathHelper</span> <span class="variable">urlPathHelper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlPathHelper</span>();</span><br><span class="line">                urlPathHelper.setRemoveSemicolonContent(<span class="literal">false</span>);</span><br><span class="line">                configurer.setUrlPathHelper(urlPathHelper);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>@Configuration + <code>@EnableWebMvc</code> + 继承 WebMvcConfigurer 全面接管 SpringMvc，慎用所有的规则需要手动重写配置。</li>
</ol>
<ul>
<li>@EnableWebMvc 会 <code>@Import(&#123;DelegatingWebMvcConfiguration.class&#125;)</code> 引入组件 <code>DelegatingWebMvcConfiguration</code> 它继承 <code>WebMvcConfigurationSupport</code> ，而在 <code>WebMvcAutoConfiguration</code> 上表示 <code>@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</code> 则存在该类时 WebMvc 的自动配置将不生效。</li>
</ul>
<h3 id="参数处理原理："><a href="#参数处理原理：" class="headerlink" title="参数处理原理："></a>参数处理原理：</h3><ul>
<li>在 Controller 方法中参数会按照类型或注解帮我们自动注入值，它是如何实现的？</li>
</ul>
<h4 id="1-注解参数："><a href="#1-注解参数：" class="headerlink" title="1. 注解参数："></a>1. 注解参数：</h4><ol>
<li><p>在 <code>DispatcherServlet</code> 的 <code>doDispatch</code> 方法中它通过 <code>getHandler</code> 找到能够处理当前请求的 HandlerMapping 从中拿到具体处理该请求的 Handler 它记录了具体的 Controller 方法。</p>
</li>
<li><p><code>getHandler</code> 之后还会为当前的 Handler 找到 <strong>适配器</strong> HandlerAdapter:</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// doDispatch 方法中</span></span><br><span class="line"><span class="type">HandlerAdapter</span> <span class="variable">ha</span> <span class="operator">=</span> <span class="built_in">this</span>.getHandlerAdapter(mappedHandler.getHandler()); <span class="comment">// 获取适配器</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>它会遍历适配器集合找到能够处理当前 Handler 的适配器：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> List&lt;HandlerAdapter&gt; handlerAdapters; <span class="comment">// 保存了多种 Handler 适配器的集合</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> HandlerAdapter <span class="title function_">getHandlerAdapter</span><span class="params">(Object handler)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.handlerAdapters != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">var2</span> <span class="operator">=</span> <span class="built_in">this</span>.handlerAdapters.iterator();</span><br><span class="line">        <span class="keyword">while</span>(var2.hasNext()) &#123;</span><br><span class="line">            <span class="type">HandlerAdapter</span> <span class="variable">adapter</span> <span class="operator">=</span> (HandlerAdapter)var2.next();</span><br><span class="line">            <span class="keyword">if</span> (adapter.supports(handler)) &#123; <span class="comment">// 支不支持当前 Handler</span></span><br><span class="line">                <span class="keyword">return</span> adapter;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServletException</span>(<span class="string">&quot;No adapter for handler [&quot;</span> + handler + <span class="string">&quot;]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>在适配器集合中有一个 <code>RequestMappingHandlerAdapter</code> 它就是主要来处理 @RequestMaping 等方法的适配器。</p>
</li>
<li><p>找到适配器后执行目标方法：</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// doDispatch 方法中</span></span><br><span class="line">mv = ha.handle(processedRequest, response, mappedHandler.getHandler()); <span class="comment">// 真正执行 Handler</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>在 <code>RequestMappingHandlerAdapter</code> 通过 <code>invokeHandlerMethod</code> 来执行我们的目标方法（Controller 方法）。</li>
<li>为将执行的方法设置 <strong>参数解析器</strong> 与 <strong>返回值处理器</strong> ：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RequestMappingHandlerAdapter -&gt; invokeHandlerMethod 中</span></span><br><span class="line"><span class="comment">// 1. 可执行方法即要执行的 Controller 方法</span></span><br><span class="line"><span class="type">ServletInvocableHandlerMethod</span> <span class="variable">invocableMethod</span> <span class="operator">=</span> <span class="built_in">this</span>.createInvocableHandlerMethod(handlerMethod);</span><br><span class="line"><span class="comment">/* 2. 设置参数解析器，所以可知 Controller 方法支持哪些参数类型取决于该解析器</span></span><br><span class="line"><span class="comment">它会拿到 Controller 方法的参数，检查是否支持解析该参数，如果支持再进行解析 */</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.argumentResolvers != <span class="literal">null</span>) &#123; <span class="comment">// 参数解析器列表 HandlerMethodArgumentResolvers</span></span><br><span class="line">    invocableMethod.setHandlerMethodArgumentResolvers(<span class="built_in">this</span>.argumentResolvers);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 3. 设置返回值处理器</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">this</span>.returnValueHandlers != <span class="literal">null</span>) &#123; <span class="comment">// 返回值处理器列表</span></span><br><span class="line">    invocableMethod.setHandlerMethodReturnValueHandlers(<span class="built_in">this</span>.returnValueHandlers);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* ... */</span></span><br><span class="line">invocableMethod.invokeAndHandle(webRequest, mavContainer, <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]); <span class="comment">// 调用和处理方法</span></span><br></pre></td></tr></table></figure>

<ol start="8">
<li><code>ServletInvocableHandlerMethod</code> 中 <code>invokeAndHandle</code> 方法内：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 去执行 Controller 方法，并得到 Controller 的返回值</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">returnValue</span> <span class="operator">=</span> <span class="built_in">this</span>.invokeForRequest(webRequest, mavContainer, providedArgs);</span><br></pre></td></tr></table></figure>

<ol start="9">
<li><code>invokeForRequest</code> 会利用 <code>InvocableHandlerMethod</code> 的 <code>getMethodArgumentValues</code> 方法中确定每一个参数的具体值：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Object[] getMethodArgumentValues(NativeWebRequest request, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer,</span><br><span class="line">			Object... providedArgs) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// 1. 获取方法所有的参数声明</span></span><br><span class="line">    MethodParameter[] parameters = getMethodParameters();</span><br><span class="line">    <span class="keyword">if</span> (ObjectUtils.isEmpty(parameters)) &#123; <span class="comment">// 为空时</span></span><br><span class="line">        <span class="keyword">return</span> EMPTY_ARGS;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// 2. 声明存储参数值的数组</span></span><br><span class="line">    Object[] args = <span class="keyword">new</span> <span class="title class_">Object</span>[parameters.length];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; parameters.length; i++) &#123;</span><br><span class="line">        <span class="type">MethodParameter</span> <span class="variable">parameter</span> <span class="operator">=</span> parameters[i];</span><br><span class="line">        parameter.initParameterNameDiscovery(<span class="built_in">this</span>.parameterNameDiscoverer);</span><br><span class="line">        args[i] = findProvidedArgument(parameter, providedArgs);</span><br><span class="line">        <span class="keyword">if</span> (args[i] != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* 3. 判断那个解析器支持当前参数类型</span></span><br><span class="line"><span class="comment">           它会遍历参数解析器（HandlerMethodArgumentResolvers），找到合适的 ArgumentResolver</span></span><br><span class="line"><span class="comment">           第一次执行时会将匹配的解析器加入缓存之后不再需要遍历 */</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.resolvers.supportsParameter(parameter)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(formatArgumentError(parameter, <span class="string">&quot;No suitable resolver&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123; <span class="comment">// 4. 使用参数解析器解析当前参数的具体值</span></span><br><span class="line">            args[i] = <span class="built_in">this</span>.resolvers.resolveArgument(parameter, mavContainer, request, <span class="built_in">this</span>.dataBinderFactory);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">exMsg</span> <span class="operator">=</span> ex.getMessage();</span><br><span class="line">                <span class="keyword">if</span> (exMsg != <span class="literal">null</span> &amp;&amp; !exMsg.contains(parameter.getExecutable().toGenericString())) &#123;</span><br><span class="line">                    logger.debug(formatArgumentError(parameter, exMsg));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> ex;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> args;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-Servlet-API-参数："><a href="#2-Servlet-API-参数：" class="headerlink" title="2. Servlet API 参数："></a>2. Servlet API 参数：</h4><p>Servlet 参数类型的解析器 <code>ServletRequestMethodArgumentResolver</code> 中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 是否为支持的 Servlet API 类型</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsParameter</span><span class="params">(MethodParameter parameter)</span> &#123;</span><br><span class="line">    Class&lt;?&gt; paramType = parameter.getParameterType();</span><br><span class="line">    <span class="keyword">return</span> WebRequest.class.isAssignableFrom(paramType) || <span class="comment">// 支持的 API</span></span><br><span class="line">        ServletRequest.class.isAssignableFrom(paramType) || </span><br><span class="line">        MultipartRequest.class.isAssignableFrom(paramType) || </span><br><span class="line">        HttpSession.class.isAssignableFrom(paramType) || </span><br><span class="line">        pushBuilder != <span class="literal">null</span> &amp;&amp; pushBuilder.isAssignableFrom(paramType) ||</span><br><span class="line">        Principal.class.isAssignableFrom(paramType) &amp;&amp; !parameter.hasParameterAnnotations() || InputStream.class.isAssignableFrom(paramType) || Reader.class.isAssignableFrom(paramType) || HttpMethod.class == paramType || Locale.class == paramType || TimeZone.class == paramType || ZoneId.class == paramType;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-复杂参数："><a href="#3-复杂参数：" class="headerlink" title="3. 复杂参数："></a>3. 复杂参数：</h4><p>Map、Model、ServletResponse 等类型参数。</p>
<ul>
<li>以参数 Map 类型为例，在 <code>InvocableHandlerMethod</code> 的 <code>getMethodArgumentValues</code> 方法中：</li>
</ul>
<ol>
<li><p>获取到 Map 类型的参数解析器为 <code>MapMethodProcessor</code> 。</p>
</li>
<li><p>解析参数是利用 <code>ModelAndViewContainer mavContainer</code> 的 <code>mavContainer.getModel()</code> 返回 <code>BindingAwareModelMap</code> 它是 Model 也是 Map 类型，最终参数值封装到它里面。</p>
</li>
<li><p><code>ModelAndViewContainer</code> 用来保存请求需要的所有数据，视图数据模型数据等等。</p>
</li>
</ol>
<ul>
<li>Model 类型参数解析器为 <code>ModelMethodProcessor</code> 过程同理一样调用了 <code>mavContainer.getModel()</code> 。</li>
</ul>
<h4 id="4-自定义对象参数："><a href="#4-自定义对象参数：" class="headerlink" title="4. 自定义对象参数："></a>4. 自定义对象参数：</h4><p>自定义 pojo 参数类型的解析器 <code>ServletModelAttributeMethodProcessor</code> 它继承 <code>ModelAttributeMethodProcessor</code> 。</p>
<ul>
<li>由之前可知 <code>resolvers.supportsParameter(parameter)</code> 来判断某解析器是否能解析该类型参数：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsParameter</span><span class="params">(MethodParameter parameter)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (parameter.hasParameterAnnotation(ModelAttribute.class) || <span class="comment">// 是否标注了 @ModelAttribute 注解</span></span><br><span class="line">            (<span class="built_in">this</span>.annotationNotRequired &amp;&amp; <span class="comment">// 不是必须的</span></span><br><span class="line">             !BeanUtils.isSimpleProperty(parameter.getParameterType()))); <span class="comment">// 且不是简单属性</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>同列解析参数 <code>resolvers.resolveArgument(...)</code> ，再<code>ModelAttributeMethodProcessor</code> 的 <code>resolveArgument</code> 方法中:</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">resolveArgument</span><span class="params">(MethodParameter parameter, <span class="meta">@Nullable</span> ModelAndViewContainer mavContainer,</span></span><br><span class="line"><span class="params">                                    NativeWebRequest webRequest, <span class="meta">@Nullable</span> WebDataBinderFactory binderFactory)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> ModelFactory.getNameForParameter(parameter); <span class="comment">// 获取参数名</span></span><br><span class="line">    <span class="comment">// 获取看有没有 @ModelAttribute 注解</span></span><br><span class="line">    <span class="type">ModelAttribute</span> <span class="variable">ann</span> <span class="operator">=</span> parameter.getParameterAnnotation(ModelAttribute.class);</span><br><span class="line">    <span class="keyword">if</span> (ann != <span class="literal">null</span>) &#123; mavContainer.setBinding(name, ann.binding()); &#125;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">attribute</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">BindingResult</span> <span class="variable">bindingResult</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 判断 ModelAndViewContainer 中有没有同名参数</span></span><br><span class="line">    <span class="keyword">if</span> (mavContainer.containsAttribute(name)) &#123;</span><br><span class="line">        attribute = mavContainer.getModel().get(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 创建一个 pojo 对象实例，所有属性值为空的实例</span></span><br><span class="line">        <span class="keyword">try</span> &#123; attribute = createAttribute(name, parameter, binderFactory, webRequest); &#125;</span><br><span class="line">        <span class="keyword">catch</span> (BindException ex) &#123;</span><br><span class="line">            <span class="keyword">if</span> (isBindExceptionRequired(parameter)) &#123; <span class="keyword">throw</span> ex; &#125;</span><br><span class="line">            <span class="keyword">if</span> (parameter.getParameterType() == Optional.class) &#123; attribute = Optional.empty(); &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123; attribute = ex.getTarget(); &#125;</span><br><span class="line">            bindingResult = ex.getBindingResult();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (bindingResult == <span class="literal">null</span>) &#123; <span class="comment">// 绑定结果为空时</span></span><br><span class="line">        <span class="comment">// 创建 web 数据绑定器</span></span><br><span class="line">        <span class="type">WebDataBinder</span> <span class="variable">binder</span> <span class="operator">=</span> binderFactory.createBinder(webRequest, attribute, name);</span><br><span class="line">        <span class="keyword">if</span> (binder.getTarget() != <span class="literal">null</span>) &#123; <span class="comment">// 拿到 pojo 实例且不为 null</span></span><br><span class="line">            <span class="keyword">if</span> (!mavContainer.isBindingDisabled(name)) &#123;</span><br><span class="line">                bindRequestParameters(binder, webRequest); <span class="comment">// 将 web 请求中的数据绑定到 pojo 实例中</span></span><br><span class="line">            &#125;</span><br><span class="line">            validateIfApplicable(binder, parameter);</span><br><span class="line">            <span class="keyword">if</span> (binder.getBindingResult().hasErrors() &amp;&amp; isBindExceptionRequired(binder, parameter)) &#123;</span><br><span class="line">                <span class="comment">// 绑定发生异常可通过 getBindingResult 获取（数据校验错误就是从这里拿到的）</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BindException</span>(binder.getBindingResult());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!parameter.getParameterType().isInstance(attribute)) &#123;</span><br><span class="line">            attribute = binder.convertIfNecessary(binder.getTarget(), parameter.getParameterType(), parameter);</span><br><span class="line">        &#125;</span><br><span class="line">        bindingResult = binder.getBindingResult();</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;String, Object&gt; bindingResultModel = bindingResult.getModel();</span><br><span class="line">    mavContainer.removeAttributes(bindingResultModel);</span><br><span class="line">    mavContainer.addAllAttributes(bindingResultModel);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> attribute;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>WebDataBinder</code> ： web 数据绑定器，将请求参数的值绑定到指定的 JavaBean 中，它利用 <code>Container</code> 转换器，将请求数据转换成指定的数据类型再次封装到 JavaBean 中。</p>
<p><code>GenericConversionService</code> ：在设置每一个值的时候，找它里面的所有 <code>Converter</code> 那个可以将这个数据类型（request带来参数的字符串）转换到指定的类型。</p>
<h3 id="自定义-Converter："><a href="#自定义-Converter：" class="headerlink" title="自定义 Converter："></a>自定义 Converter：</h3><p>Converter 接口 <code>@FunctionalInterface public interface Converter&lt;S, T&gt;</code> 包含 FunctionalInterface 注解，它只能针对 form 表单提交数据有效。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebMvcConfigurer <span class="title function_">webMvcConfigurer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFormatters</span><span class="params">(FormatterRegistry registry)</span> &#123;</span><br><span class="line">                <span class="comment">// 添加自定义 Converter</span></span><br><span class="line">                registry.addConverter(<span class="keyword">new</span> <span class="title class_">Converter</span>&lt;String, Car&gt;() &#123; <span class="comment">// String 类型转 Car 类型</span></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> Car <span class="title function_">convert</span><span class="params">(String source)</span> &#123; <span class="comment">// 转换具体实现方式</span></span><br><span class="line">                        <span class="keyword">if</span> (StringUtils.hasText(source))&#123; <span class="comment">// 存在文字</span></span><br><span class="line">                            <span class="type">Car</span> <span class="variable">car</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Car</span>();</span><br><span class="line">                            car.setName(source); <span class="comment">// 自定义操作设定属性值</span></span><br><span class="line">                            <span class="keyword">return</span> car;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例如发起请求：<code>/setUser?name=userName&amp;car=myCar</code> 与 <code>/setCar?car=111</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;setUser&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">setUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> user; <span class="comment">// 结果 &#123; name: &quot;userName&quot;,car: &#123; name: &quot;myCar&quot; &#125; &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@RequestMapping(&quot;setCar&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Car <span class="title function_">setUser</span><span class="params">(<span class="meta">@RequestParam(&quot;car&quot;)</span> Car car)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> car; <span class="comment">// 结果 &#123; name&quot;: &quot;111&quot; &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="数据响应原理："><a href="#数据响应原理：" class="headerlink" title="数据响应原理："></a>数据响应原理：</h3><h4 id="1-响应-JSON："><a href="#1-响应-JSON：" class="headerlink" title="1. 响应 JSON："></a>1. 响应 JSON：</h4><ol>
<li>由上可知 <code>ServletInvocableHandlerMethod</code> 的 <code>invokeAndHandle</code> 中会拿到 Controller 的返回值，之后它还会对返回值做处理：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invokeAndHandle</span><span class="params">(ServletWebRequest webRequest, ModelAndViewContainer mavContainer, Object... providedArgs)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// 执行 Controller 方法并拿到返回值</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">returnValue</span> <span class="operator">=</span> <span class="built_in">this</span>.invokeForRequest(webRequest, mavContainer, providedArgs);</span><br><span class="line">    <span class="built_in">this</span>.setResponseStatus(webRequest);</span><br><span class="line">    <span class="keyword">if</span> (returnValue == <span class="literal">null</span>) &#123; <span class="comment">// 如果返回值为空</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.isRequestNotModified(webRequest) || <span class="built_in">this</span>.getResponseStatus() != <span class="literal">null</span> || mavContainer.isRequestHandled()) &#123;</span><br><span class="line">            <span class="built_in">this</span>.disableContentCachingIfNecessary(webRequest);</span><br><span class="line">            mavContainer.setRequestHandled(<span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">// 是否是一个字符串</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.hasText(<span class="built_in">this</span>.getResponseStatusReason())) &#123;</span><br><span class="line">        mavContainer.setRequestHandled(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 处理返回值</span></span><br><span class="line">        <span class="built_in">this</span>.returnValueHandlers.handleReturnValue(returnValue, <span class="built_in">this</span>.getReturnValueType(returnValue), mavContainer, webRequest);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception var6) &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><code>HandlerMethodReturnValueHandlerComposite</code> 中：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleReturnValue</span><span class="params">(<span class="meta">@Nullable</span> Object returnValue, MethodParameter returnType,</span></span><br><span class="line"><span class="params">                              ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// 根据返回值类型获取合适的返回值处理器(它会遍历所有的返回值处理器，拿到能够处理当前返回值的处理器)</span></span><br><span class="line">    <span class="type">HandlerMethodReturnValueHandler</span> <span class="variable">handler</span> <span class="operator">=</span> selectHandler(returnValue, returnType);</span><br><span class="line">    <span class="keyword">if</span> (handler == <span class="literal">null</span>) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;Unknown return value type: &quot;</span> + returnType.getParameterType().getName()); &#125;</span><br><span class="line">    <span class="comment">// 处理返回值</span></span><br><span class="line">    handler.handleReturnValue(returnValue, returnType, mavContainer, webRequest);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>返回值处理器接口 <code>HandlerMethodReturnValueHandler</code> ：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HandlerMethodReturnValueHandler</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 判断是否支持某类型返回值</span></span><br><span class="line">	<span class="type">boolean</span> <span class="title function_">supportsReturnType</span><span class="params">(MethodParameter returnType)</span>;</span><br><span class="line">    <span class="comment">// 2. 处理返回值</span></span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">handleReturnValue</span><span class="params">(<span class="meta">@Nullable</span> Object returnValue, MethodParameter returnType,</span></span><br><span class="line"><span class="params">			ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>各种返回值处理器支持的返回值类型：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ModelAndView</span><br><span class="line">Model</span><br><span class="line">View</span><br><span class="line">ResponseEntity </span><br><span class="line">ResponseBodyEmitter</span><br><span class="line">StreamingResponseBody</span><br><span class="line">HttpEntity</span><br><span class="line">HttpHeaders</span><br><span class="line">Callable</span><br><span class="line">DeferredResult</span><br><span class="line">ListenableFuture</span><br><span class="line">CompletionStage</span><br><span class="line">WebAsyncTask</span><br><span class="line"><span class="comment">// 方法有以下注解标注且返回值为对象类型的</span></span><br><span class="line"><span class="meta">@ModelAttribute</span></span><br><span class="line"><span class="meta">@ResponseBody</span> --&gt; RequestResponseBodyMethodProcessor <span class="comment">// 对应的处理器</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><code>RequestResponseBodyMethodProcessor</code> 处理 <code>@ResponseBody</code> 标注的方法的返回值：</li>
</ol>
<p>RequestResponseBodyMethodProcessor 在 handleReturnValue 调用 <code>writeWithMessageConverters</code> 方法使用消息转换器（MessageConverters）进行写出操作：</p>
<p>内容协商：</p>
<p>Http 协议中规定请求头中有 Accept 属性它告诉服务器，客户端能接收的响应类型是什么。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 逗号比分号优先级高，q 代表权重，没有去默认为1，*/* 表示任意类型</span></span><br><span class="line">Accept<span class="punctuation">:</span> text/html<span class="punctuation">,</span>application/xhtml+xml<span class="punctuation">,</span>application/xml;q=<span class="number">0.9</span><span class="punctuation">,</span>image/webp<span class="punctuation">,</span>image/apng<span class="punctuation">,</span>*<span class="comment">/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span></span><br></pre></td></tr></table></figure>

<p><strong>客户端能接收的类型</strong> 用 <code>MediaType</code> <strong>媒体类型</strong> 对象表示，与 <strong>服务器支持生成的类型</strong> 循环匹配筛选出能够支持类型的 <code>MediaType</code> 。若客户端无法解析服务端返回的内容，即媒体类型未匹配，那么响应 406。</p>
<p>SpringMvc 遍历容器中所有 <code>HttpMessageConverter</code> 消息转换器，找到支持相应类型的转换器：</p>
<p>主要作用：看是否支持将返回值 Class 类型的对象，转化为 <code>MediaType</code> 类型的数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HttpMessageConverter</span>&lt;T&gt; &#123;</span><br><span class="line">	<span class="type">boolean</span> <span class="title function_">canRead</span><span class="params">(Class&lt;?&gt; clazz, <span class="meta">@Nullable</span> MediaType mediaType)</span>; <span class="comment">// 是否支持读</span></span><br><span class="line">	<span class="type">boolean</span> <span class="title function_">canWrite</span><span class="params">(Class&lt;?&gt; clazz, <span class="meta">@Nullable</span> MediaType mediaType)</span>; <span class="comment">// 是否支持写</span></span><br><span class="line">	List&lt;MediaType&gt; <span class="title function_">getSupportedMediaTypes</span><span class="params">()</span>;</span><br><span class="line">	<span class="keyword">default</span> List&lt;MediaType&gt; <span class="title function_">getSupportedMediaTypes</span><span class="params">(Class&lt;?&gt; clazz)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> (canRead(clazz, <span class="literal">null</span>) || canWrite(clazz, <span class="literal">null</span>) ? getSupportedMediaTypes() : Collections.emptyList());</span><br><span class="line">	&#125;</span><br><span class="line">	T <span class="title function_">read</span><span class="params">(Class&lt;? extends T&gt; clazz, HttpInputMessage inputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotReadableException;</span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">write</span><span class="params">(T t, <span class="meta">@Nullable</span> MediaType contentType, HttpOutputMessage outputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotWritableException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>利用 <code>MappingJackson2HttpMessageConverter</code> 中 <code>write</code> 方法将对象转为 JSON （利用 Jackson）再写出去。</p>
<h4 id="2-内容协商原理："><a href="#2-内容协商原理：" class="headerlink" title="2. 内容协商原理："></a>2. 内容协商原理：</h4><ol>
<li>判断当前请求头中是否已经有确定的媒体类型 <code>MediaType</code> ，有就使用确定好的媒体类型，没有则向下执行。</li>
<li>获取客户端支持接收的内容类型（默认通过请求头 Accept 字段） <code>acceptableTypes = this.getAcceptableMediaTypes(request)</code>。<ul>
<li><strong>ContentNegotiationManager</strong> 内容协商管理器 默认使用基于请求头的策略</li>
<li><strong>HeaderContentNegotiationStrategy</strong> 确定客户端可以接收的内容类型</li>
</ul>
</li>
<li>获取服务器支持生成的媒体类型，再与客户端能接收的类型进行比对找到匹配的媒体类型。</li>
<li>遍历循环容器中所有的 <code>HttpMessageConverter</code> ,拿到 <strong>所有支持转换</strong> 当前返回值 Class 类型的 <code>HttpMessageConverter</code>。</li>
<li>客户端想要的类型和服务器支持的类型进行循环匹配。</li>
<li>最终使用匹配到的 <code>Converter</code> 进行转换。</li>
</ol>
<h4 id="3-开启浏览器参数方式内容协商功能："><a href="#3-开启浏览器参数方式内容协商功能：" class="headerlink" title="3. 开启浏览器参数方式内容协商功能："></a>3. 开启浏览器参数方式内容协商功能：</h4><ul>
<li>开启配置：</li>
</ul>
<p>开启此配置后服务器不再默认通过请求头的 Accept 字段来获取客户端支持接收的内容类型，而是通过读取请求参数中的 <strong>format</strong> 值来确定客户端接收的内容类型。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">contentnegotiation:</span></span><br><span class="line">      <span class="attr">favor-parameter:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<ul>
<li>请求时添加 <strong>format</strong> 参数指定接收的数据类型即可</li>
</ul>
<p><code>/user?format=json</code> 接收 JSON 类型数据</p>
<h3 id="自定义-HttpMessageConverter："><a href="#自定义-HttpMessageConverter：" class="headerlink" title="自定义 HttpMessageConverter："></a>自定义 HttpMessageConverter：</h3><ul>
<li>自定义 HttpMessageConverter：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> WebMvcConfigurer <span class="title function_">webMvcConfigurer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="comment">// 添加自定义 HttpMessageConverter</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">            converters.add(<span class="keyword">new</span> <span class="title class_">HttpMessageConverter</span>&lt;User&gt;() &#123; <span class="comment">// controller 方法返回值为 User 类型</span></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canRead</span><span class="params">(Class&lt;?&gt; clazz, MediaType mediaType)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canWrite</span><span class="params">(Class&lt;?&gt; clazz, MediaType mediaType)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> clazz.isAssignableFrom(User.class); <span class="comment">// 返回值类型为 User 类型</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">/** 服务器要统计所有 MessageConverter 都能写出哪些内容类型</span></span><br><span class="line"><span class="comment">                 * 自定义类型 application/x-user</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> List&lt;MediaType&gt; <span class="title function_">getSupportedMediaTypes</span><span class="params">()</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> MediaType.parseMediaTypes(<span class="string">&quot;application/x-user&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> User <span class="title function_">read</span><span class="params">(Class&lt;? extends User&gt; clazz, HttpInputMessage inputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotReadableException &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(User user, MediaType contentType, HttpOutputMessage outputMessage)</span> <span class="keyword">throws</span> IOException, HttpMessageNotWritableException &#123;</span><br><span class="line">                    <span class="comment">// 自定义内容数据</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> user.getName()+ <span class="string">&quot; -&gt; &quot;</span> +user.getAge();</span><br><span class="line">                    <span class="comment">// 将内容写出</span></span><br><span class="line">                    <span class="type">OutputStream</span> <span class="variable">body</span> <span class="operator">=</span> outputMessage.getBody();</span><br><span class="line">                    body.write(data.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当标注 @ResponseBody 的方法返回值类型为 User 且媒体类型为我们自定义的 application&#x2F;x-user 时将使用此自定义 <code>HttpMessageConverter</code> 写出响应数据。</p>
<ul>
<li>如果还想使用请求中添加 <strong>format</strong> 参数来指定客户端接收响应数据的类型，还需要在上 <code>WebMvcConfigurer</code> 中重写 <code>configureContentNegotiation</code> 方法（原来的策略全部失效）：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="comment">// 配置内容协商功能</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureContentNegotiation</span><span class="params">(ContentNegotiationConfigurer configurer)</span> &#123;</span><br><span class="line">    Map&lt;String, MediaType&gt; mediaTypes = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    mediaTypes.put(<span class="string">&quot;json&quot;</span>, MediaType.APPLICATION_JSON);</span><br><span class="line">    mediaTypes.put(<span class="string">&quot;xml&quot;</span>, MediaType.APPLICATION_XML);</span><br><span class="line">    <span class="comment">// 自定义类型（format=user 对应 application/x-user 类型）</span></span><br><span class="line">    mediaTypes.put(<span class="string">&quot;user&quot;</span>, MediaType.parseMediaType(<span class="string">&quot;application/x-user&quot;</span>));</span><br><span class="line">    <span class="comment">// 新增参数策略</span></span><br><span class="line">    <span class="type">ParameterContentNegotiationStrategy</span> <span class="variable">strategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ParameterContentNegotiationStrategy</span>(mediaTypes);</span><br><span class="line">    <span class="comment">/* 注意如果不添加其它策略则只能使用参数策略，也可继续新增基于请求头的策略 */</span></span><br><span class="line">    <span class="comment">// HeaderContentNegotiationStrategy headerContentNegotiationStrategy = new HeaderContentNegotiationStrategy();</span></span><br><span class="line">    <span class="comment">// 设置内容协商策略</span></span><br><span class="line">    configurer.strategies(Arrays.asList(strategy));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>或者使用配置方式：</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">contentnegotiation:</span></span><br><span class="line">      <span class="attr">favor-parameter:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">media-types:</span></span><br><span class="line">        &#123; <span class="attr">user:</span> <span class="string">application/x-user</span> &#125;</span><br></pre></td></tr></table></figure>

<p>这样我们只需在请求中添加 <strong>format&#x3D;user</strong> 则表示客户端需要接收的类型为 application&#x2F;x-user 类型。</p>
<h3 id="视图解析"><a href="#视图解析" class="headerlink" title="视图解析"></a>视图解析</h3><h4 id="Thymeleaf-模板："><a href="#Thymeleaf-模板：" class="headerlink" title="Thymeleaf 模板："></a>Thymeleaf 模板：</h4><blockquote>
<p>  现代化、服务端 Java 模板引擎</p>
<p>  <a target="_blank" rel="noopener" href="https://www.thymeleaf.org/">Thymeleaf 官网：https://www.thymeleaf.org/</a></p>
<p>  <a target="_blank" rel="noopener" href="https://blog.csdn.net/ljk126wy/article/details/90735989">Thymeleaf 使用与语法</a></p>
</blockquote>
<h5 id="1-引入-Starter："><a href="#1-引入-Starter：" class="headerlink" title="1. 引入 Starter："></a>1. 引入 Starter：</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入 Thymeleaf 模板引擎 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="2-Thymeleaf-使用："><a href="#2-Thymeleaf-使用：" class="headerlink" title="2. Thymeleaf 使用："></a>2. Thymeleaf 使用：</h5><ol>
<li>SpringBoot 默认帮我们配置好了 Thymeleaf：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfiguration( after = &#123;WebMvcAutoConfiguration.class, WebFluxAutoConfiguration.class&#125; )</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;ThymeleafProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;TemplateMode.class, SpringTemplateEngine.class&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;ReactiveTemplateEngineConfiguration.class, DefaultTemplateEngineConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThymeleafAutoConfiguration</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>默认在 <code>resources/templates/</code> 文件夹内的 <code>.html</code> 页面文件将会被 Thymeleaf 模板引擎解析。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties( prefix = &quot;spring.thymeleaf&quot; )</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThymeleafProperties</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;classpath:/templates/&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_SUFFIX</span> <span class="operator">=</span> <span class="string">&quot;.html&quot;</span>;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Thymeleaf 模版页面中的 html 标签上需要声明 Thymeleaf 的命名空间：</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="视图解析原理："><a href="#视图解析原理：" class="headerlink" title="视图解析原理："></a>视图解析原理：</h4><ol>
<li>SpringMvc 处理返回值时，当返回值是一个字符串时会被 <code>ViewNameMethodReturnValueHandler</code> 处理器处理：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ViewNameMethodReturnValueHandler</span> <span class="keyword">implements</span> <span class="title class_">HandlerMethodReturnValueHandler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsReturnType</span><span class="params">(MethodParameter returnType)</span> &#123;</span><br><span class="line">        Class&lt;?&gt; paramType = returnType.getParameterType();</span><br><span class="line">        <span class="comment">// 返回值是否为空或者一个字符串</span></span><br><span class="line">        <span class="keyword">return</span> Void.TYPE == paramType || CharSequence.class.isAssignableFrom(paramType);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleReturnValue</span><span class="params">(<span class="meta">@Nullable</span> Object returnValue, MethodParameter returnType, ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (returnValue <span class="keyword">instanceof</span> CharSequence) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> returnValue.toString();</span><br><span class="line">            mavContainer.setViewName(viewName); <span class="comment">// 将所有数据都存放在了 ModelAndViewContainer 中</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.isRedirectViewName(viewName)) &#123; <span class="comment">// 是否要重定向</span></span><br><span class="line">                mavContainer.setRedirectModelScenario(<span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (returnValue != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>(<span class="string">&quot;Unexpected return type: &quot;</span> + returnType.getParameterType().getName() + <span class="string">&quot; in method: &quot;</span> + returnType.getMethod());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">isRedirectViewName</span><span class="params">(String viewName)</span> &#123;</span><br><span class="line">        <span class="comment">// 判断是否需要重定向</span></span><br><span class="line">        <span class="keyword">return</span> viewName.startsWith(<span class="string">&quot;redirect:&quot;</span>) || PatternMatchUtils.simpleMatch(<span class="built_in">this</span>.redirectPatterns, viewName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Controller 方法的参数是一个 <strong>自定义类型对象</strong> 时会默认 <strong>自动将它存放在 ModelAndViewContainer</strong> 中。</li>
<li>任何目标方法执行完成以后都会返回 ModelAndView （数据与视图）。</li>
<li>当你的 ModelAndView 没有设置 viewName 时是给你使用默认的 viewName（值为当前 Controller 方法的请求路径，如 RquestMapping(“login”) 那么视图就是 login）。</li>
<li>由 <code>DispatcherServlet</code> 的 <code>processDispatchResult</code> 方法处理派发结果（处理页面该如何响应）。</li>
<li>它会执行 <code>render(mv, request, response)</code> 渲染页面操作，遍历所有 <code>ViewResolver</code> 找到对应视图解析器得到相应的 View 对象（定义了页面渲染逻辑，如重定向是 <strong>RedirectView</strong> ），最后调用 View 的 render 方法进行页面渲染工作。<ul>
<li>返回值以 <strong>forward</strong> 开头：<strong>InternalResourceView</strong> 中 request 原生转发请求</li>
<li>返回值以 <strong>redirect</strong> 开头：<strong>RedirectView</strong> 中 request 原生重定向请求</li>
<li>普通字符串：<strong>new ThymeleafView()</strong></li>
</ul>
</li>
</ol>
<h3 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h3><h4 id="HandlerInterceptor："><a href="#HandlerInterceptor：" class="headerlink" title="HandlerInterceptor："></a>HandlerInterceptor：</h4><ul>
<li>拦截器 <code>HandlerInterceptor</code> 接口：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="comment">// 预先处理(执行目标方法之前)</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// 是否放行</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 目标方法执行完成后</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, <span class="meta">@Nullable</span> ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;&#125;</span><br><span class="line">    <span class="comment">// 请求处理完成后</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, <span class="meta">@Nullable</span> Exception ex)</span> <span class="keyword">throws</span> Exception &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用拦截器："><a href="#使用拦截器：" class="headerlink" title="使用拦截器："></a>使用拦截器：</h4><ol>
<li>实现 <code>HandlerInterceptor</code> :</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">user</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (user != <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// 登录成功放行</span></span><br><span class="line">        request.setAttribute(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;请登录&quot;</span>);</span><br><span class="line">        request.getRequestDispatcher(<span class="string">&quot;/success&quot;</span>).forward(request, response);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>配置拦截器：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123; <span class="comment">// WebMvcConfigurer 中</span></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// 1. 实现添加拦截器方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>()) <span class="comment">// 2. 添加拦截器</span></span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/**&quot;</span>) <span class="comment">// 3. 拦截路径</span></span><br><span class="line">                <span class="comment">// 4. 放行路径（排除）</span></span><br><span class="line">                .excludePathPatterns(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;/login&quot;</span>,</span><br><span class="line">                        <span class="comment">// 由于 /** 拦截了包括静态资源的请求因此需要放行静态资源</span></span><br><span class="line">                        <span class="string">&quot;/css/**&quot;</span>,<span class="string">&quot;/html/**&quot;</span>,<span class="string">&quot;/images/**&quot;</span>); <span class="comment">// 或为静态资源配置访问前缀，再放行此前缀下的所有请求</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="拦截器原理："><a href="#拦截器原理：" class="headerlink" title="拦截器原理："></a>拦截器原理：</h4><ol>
<li>根据当前请求，找到 mappedHandler 为 <code>HandlerExecutionChain</code> 它拿到了可以处理请求的 Handler 和相关的拦截器。</li>
<li>之后拿到了相关的适配器（HandlerAdapter），最后使用适配器来执行目标方法。但在执行目标方法之前还有一个前置步骤 <code>applyPreHandle</code> 它会来执行我们拦截器的 <code>preHandle</code> 方法：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!mappedHandler.applyPreHandle(processedRequest, response)) &#123; <span class="keyword">return</span>; &#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><code>applyPreHandle</code> 会先 <strong>正序</strong> 挨个执行拦截器的 <code>preHandle</code> 方法，如果当前拦截器返回 true 这执行下一个。</li>
<li>如果拦截器 <code>preHandle</code> 返回 false 会执行 <code>triggerAfterCompletion</code> 方法，它会 <strong>逆序</strong> 执行 <strong>已经触发了的拦截器</strong> 的 <code>afterCompletion</code> 方法，并且 <code>applyPreHandle</code> 返回 false。</li>
<li>因此如果任何一个拦截器返回 false ，则 <code>applyPreHandle</code> 返回 false 将直接 return 不能执行目标方法。</li>
<li>如果成功执行了目标方法，之后还会 <strong>倒序</strong> 执行所有拦截器的 <code>postHandle</code> 方法：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mappedHandler.applyPostHandle(processedRequest, response, mv);</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>并且注意 <strong>前任何步骤报错</strong> 都将执行 <code>triggerAfterCompletion</code> 方法。</li>
<li>最后在页面渲完成以后，也会触发 <code>triggerAfterCompletion</code> 方法。</li>
</ol>
<h3 id="文件上传："><a href="#文件上传：" class="headerlink" title="文件上传："></a>文件上传：</h3><h4 id="文件上传：-1"><a href="#文件上传：-1" class="headerlink" title="文件上传："></a>文件上传：</h4><ol>
<li>表单设置 <code>method=&quot;post&quot;</code> 与 <code>enctype=&quot;multipart/form-data&quot;</code> ：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;/upload&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">    file: &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span> id=<span class="string">&quot;file&quot;</span>&gt; &lt;br/&gt;</span><br><span class="line">    &lt;button type=<span class="string">&quot;submit&quot;</span>&gt; 提交 &lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>接收文件：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">( <span class="meta">@RequestPart(&quot;file&quot;)</span> MultipartFile file )</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">if</span> (!file.isEmpty())&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">        <span class="type">File</span> <span class="variable">saveFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;C:\\Users&quot;</span>, UUID.randomUUID() + fileName);</span><br><span class="line">        file.transferTo(saveFile);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@RequestParam</code> 也能接收 MultipartFile 类型，一般接收基本类型和 String。</p>
<p><code>@RequestPart</code> 一般接收 multipart&#x2F;form-data 表单数据，适用于复杂的请求域像 JSON，XML。</p>
<ol start="3">
<li>相关配置（MultipartAutoConfiguration.class）：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 上传单个文件大小上限</span><br><span class="line">spring.servlet.multipart.max-file-size=10MB</span><br><span class="line"># 整个请求的大小上限</span><br><span class="line">spring.servlet.multipart.max-request-size=100MB</span><br></pre></td></tr></table></figure>

<h4 id="原理解析："><a href="#原理解析：" class="headerlink" title="原理解析："></a>原理解析：</h4><ol>
<li>SpringBoot 对文件上传的自动配置封装在了 <code>MultipartAutoConfiguration</code> 中，它自动帮我们配置了 <code>StandardServletMultipartResolver</code> 文件上传解析器。</li>
<li>在 <code>DispatcherServlet</code> 的 <code>doDispatch</code> 中获取 <code>mappedHandler</code> 处理器之前会先解析请求是否是上传文件请求（根据请求类型是否是 <code>multipart/</code> 来判断）。</li>
<li>如果是文件上传请求，文件上传解析器会将 <strong>原生请求(request)</strong> 封装为 <code>MultipartHttpServletRequest</code> 继续向下执行。</li>
<li>最终参数解析器将请求中的文件内容封装成 <code>MultipartFile</code> 。</li>
</ol>
<h3 id="错误处理："><a href="#错误处理：" class="headerlink" title="错误处理："></a>错误处理：</h3><h4 id="默认机制："><a href="#默认机制：" class="headerlink" title="默认机制："></a>默认机制：</h4><ul>
<li>默认情况下 SpringBoot 提供 <code>/error</code> 处理所有错误映射，如果是浏览器会响应一个 Whitelabel 的 <strong>HTML</strong> 视图，其它客户端会生产 <strong>JSON</strong> 响应。</li>
<li>在任何静态资源文件夹中 <code>error/</code> 目录下以 <strong>4xx</strong> 或 <strong>5xx</strong> 开头页面会在发生相应错误时被自动解析并返回。</li>
</ul>
<h4 id="自定义异常处理："><a href="#自定义异常处理：" class="headerlink" title="自定义异常处理："></a>自定义异常处理：</h4><ol>
<li><code>@ControllerAdvice</code> + <code>@ExceptionHandler</code> 处理全局异常：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span> <span class="comment">// 处理所有 controller 异常的类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    <span class="comment">// 指定方法处理哪些异常（不指定则处理所有）</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(&#123; NullPointerException.class, ArithmeticException.class &#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handlerException</span><span class="params">( Exception e )</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>; <span class="comment">// 对异常进行处理并返回结果</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>@ExceptionHandler</code> 还能在 <code>Controller</code> 中使用，处理该 Controller 中所有或者指定的异常。</p>
</li>
<li><p>优先使用 Controller 中 <code>@ExceptionHandler</code> 方法处理，且匹配错误类型范围更小的优先。</p>
</li>
</ul>
<ol start="2">
<li><code>@ResponseStatus</code> 自定义异常：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义异常，value 请求响应返回的状态码，reason 错误信息</span></span><br><span class="line"><span class="meta">@ResponseStatus(value = HttpStatus.BAD_REQUEST, reason = &quot;请求错误&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><code>HandlerExceptionResolver</code> 自定义异常解析器：</li>
</ol>
<p>因为我们自定义异常解析器的组件创建会比它默认的解析器后创建，而一般异常都被默认的解析器处理了轮不到我们自定义的解析器，因此我们需要提升自定义解析器创建的优先级。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Order(value = Ordered.HIGHEST_PRECEDENCE)</span> <span class="comment">// 设置创建该组件的优先级，数字越小优先级越高</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">// 继承 HandlerExceptionResolver 且添加到组件中</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomerExceptionResolver</span> <span class="keyword">implements</span> <span class="title class_">HandlerExceptionResolver</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">resolveException</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                                         HttpServletResponse response,</span></span><br><span class="line"><span class="params">                                         Object handler, Exception ex)</span> &#123;</span><br><span class="line">        <span class="comment">/* 解析过程 */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>(<span class="string">&quot;404&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="异常处理原理："><a href="#异常处理原理：" class="headerlink" title="异常处理原理："></a>异常处理原理：</h4><ul>
<li><code>ErrorMvcAutoConfiguration</code> 自动配置了异常处理规则，给容器中存放了一些组件 errorAttributes（ <code>DefaultErrorAttributes.class</code> ） 组件。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DefaultErrorAttributes <span class="keyword">implements</span> <span class="title class_">ErrorAttributes</span>, HandlerExceptionResolver</span><br></pre></td></tr></table></figure>

<p><code>ErrorAttributes</code> 定义了错误页面中包含的数据。</p>
<ul>
<li>basicErrorController( <code>BasicErrorController</code> ) 组件，默认处理 <code>/error</code> 请求。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.error.path 没有配置值时默认使用 error.path 同理默认 /error （springEl 表达式）</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;$&#123;server.error.path:$&#123;error.path:/error&#125;&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BasicErrorController</span> <span class="keyword">extends</span> <span class="title class_">AbstractErrorController</span></span><br></pre></td></tr></table></figure>

<p>其中返回 HTML 页面的请求方法会返回 <code>ModelAndView(&quot;error&quot;, model)</code> ，通过 <code>BeanNameViewResolver</code> 视图解析器，按照 <strong>视图名作为组件的 ID</strong> 去容器中寻找 <strong>ID 为 error 的 View 组件</strong> 。（还有一个返回 JSON 的请求方法）</p>
<ul>
<li>conventionErrorViewResolver（ <code>DefaultErrorViewResolver</code> ）组件，发生错误它会以 Http 状态码 作为视图名（404、4XX、5XX）。</li>
</ul>
<h4 id="异常处理流程："><a href="#异常处理流程：" class="headerlink" title="异常处理流程："></a>异常处理流程：</h4><ol>
<li><p>doDispatch 中执行目标方法期间发生任何异常都被 catch 捕获并将异常对象保存到 <code>Object dispatchException</code> 中。</p>
</li>
<li><p>在执行 processDispatchResult 视图解析时将处理异常，由 <code>processHandlerException</code> 方法处理 handler 发生的异常并返回 ModelAndView。它会遍历所有的 <code>HandlerExceptionResolver</code> 处理器异常解析器看谁能够处理当前异常。</p>
</li>
<li><p>默认是没有能够处理异常的解析器其中 <code>DefaultErrorAttributes</code> 只会将错误信息保存到请求域中，其它的解析器只在特定的情况发挥作用（如有 @ExceptionHandler 注解等）。</p>
</li>
<li><p>如果没有任何解析器能够处理当前异常最终将发送 <code>/error</code> 请求，并被 <code>BasicErrorController</code> 中的方法处理。它将遍历所有的 ErrorViewResolver 错误视图解析器其中 <code>DefaultErrorViewResolver</code> 将返回错误页面视图。</p>
</li>
</ol>
<h3 id="web-原生组件："><a href="#web-原生组件：" class="headerlink" title="web 原生组件："></a>web 原生组件：</h3><p><strong>注意原生组件不会触发 SpringBoot 的拦截器等功能。</strong></p>
<h4 id="ServletComponentScan："><a href="#ServletComponentScan：" class="headerlink" title="@ServletComponentScan："></a>@ServletComponentScan：</h4><ol>
<li>在主类中使用 <code>@ServletComponentScan</code> 指定 servlet、Filter、Listener 组件存放的包位置：</li>
</ol>
<p>默认将扫描并注入此注解所在包以及所有子类包中含有 <code>@WebServlet</code> 、 <code>@WebFilter</code> 、 <code>@WebListener</code> 注解的原生组件，basePackages 属性指定扫描的包位置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 扫描并自动注入元素 servlet 组件</span></span><br><span class="line"><span class="meta">@ServletComponentScan(basePackages = &quot;top.ruoxijun.servlet&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApplication</span> &#123;...</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 <code>@ServletComponentScan</code> 注解能扫描的包内创建原生 servlet 即可：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(urlPatterns = &quot;/my&quot;)</span> <span class="comment">// 地址</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        resp.getWriter().write(<span class="string">&quot;this is MyServlet.class&quot;</span>); <span class="comment">// get 响应</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>同理 Filter ：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /* 是 java 中表示所有，spring 使用 /** 表示</span></span><br><span class="line"><span class="meta">@WebFilter(urlPatterns = &quot;/css/*&quot;)</span> <span class="comment">// 拦截的路径</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException &#123;&#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;&#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123; Filter.<span class="built_in">super</span>.destroy(); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>Listener：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebListener</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyListener</span> <span class="keyword">implements</span> <span class="title class_">ServletContextListener</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// 项目初始化</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> &#123;&#125;</span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// 项目销毁</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="xxxRegistrationBean："><a href="#xxxRegistrationBean：" class="headerlink" title="xxxRegistrationBean："></a>xxxRegistrationBean：</h4><p>推荐使用在配置类中向 SpringBoot 注入 <code>ServletRegistrationBean</code> 、 <code>FilterRegistrationBean</code> 、 <code>ServletListenerRegistrationBean</code> 类型组件的方式来分别添加 servlet、Filter、Listener：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不建议使用 proxyBeanMethods = false 属性值</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyRegistrationBean</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletRegistrationBean <span class="title function_">myServlet</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">MyServlet</span> <span class="variable">myServlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyServlet</span>(); <span class="comment">// 自定义 servlet 对象</span></span><br><span class="line">        <span class="comment">// 注册 servlet 并设置访问路径</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(myServlet, <span class="string">&quot;/my&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean <span class="title function_">myFilter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">MyFilter</span> <span class="variable">myFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyFilter</span>(); <span class="comment">// 自定义 filter 对象</span></span><br><span class="line">        <span class="comment">// 注册 filter 并拦截 ServletRegistrationBean 中 servlet 的请求</span></span><br><span class="line">        <span class="comment">// return new FilterRegistrationBean(myFilter, myServlet());</span></span><br><span class="line">        FilterRegistrationBean&lt;MyFilter&gt; filterRegistrationBean =</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>&lt;&gt;(myFilter);</span><br><span class="line">        <span class="comment">// 指定拦截请求</span></span><br><span class="line">        filterRegistrationBean.setUrlPatterns(Arrays.asList(<span class="string">&quot;/css/*&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> filterRegistrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletListenerRegistrationBean <span class="title function_">myListener</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 注册自定义监听器</span></span><br><span class="line">        <span class="type">MyListener</span> <span class="variable">myListener</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyListener</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServletListenerRegistrationBean</span>(myListener);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="DispatcherServlet-实现原理"><a href="#DispatcherServlet-实现原理" class="headerlink" title="DispatcherServlet 实现原理:"></a>DispatcherServlet 实现原理:</h4><ol>
<li>在 <code>DispatcherServletAutoConfiguration</code> 中给容器配置并注入了 <code>dispatcherServlet</code> 组件，且属性绑定在 <code>WebMvcProperties</code> 中对应的配置项为 <code>spring.mvc</code>。</li>
<li>其中另一个配置类中给容器配置注入了 <code>DispatcherServletRegistrationBean</code> 组件，它继承至 <code>ServletRegistrationBean&lt;DispatcherServlet&gt;</code> ，且配置器映射路径为 <code>/</code> (对应配置： <code>spring.mvc.servlet.path</code> )。</li>
</ol>
<ul>
<li>context-path 配置项目上下文访问的前缀，path 配置的是 dispatcherServlet 拦截的路径。</li>
</ul>
<p>多个 servlet 处理同一层路径采用精确优先原则（如有 <code>/my/</code> 与 <code>/my/2</code> 两个 servlet ,&#x2F;my&#x2F;1将进入第1个）。</p>
<p>由于 SpringBoot 的 web 都基于 dispatcherServlet 的 <code>/</code> 实现,因此我们自定义注入的原生 web 组件是直接执行，不会通过 SpringBoot 的相关功能（如拦截器）。</p>
<h3 id="嵌入式-Servlet-容器："><a href="#嵌入式-Servlet-容器：" class="headerlink" title="嵌入式 Servlet 容器："></a>嵌入式 Servlet 容器：</h3><h4 id="原理："><a href="#原理：" class="headerlink" title="原理："></a>原理：</h4><ol>
<li>在 <code>spring-boot-starter-web</code> 包中默认引入 Tomcat 的包。</li>
<li>配置类 <code>ServletWebServerFactoryAutoConfiguration</code> 它导入了 <code>ServletWebServerFactoryConfiguration</code> 组件其中它会根据添加动态判断系统导入了那个 web 服务器的包，注入相应的服务器工厂组件（ <code>TomcatServletWebServerFactory</code> 、 <code>JettyServletWebServerFactory</code> 、 <code>UndertowServletWebServerFactory</code> ）。</li>
<li><code>ServletWebServerApplicationContext</code> 它会在容器启动时寻找 <code>ServletWebServerFactory</code> （servlet web 服务器工厂），利用服务器工厂创建除服务器并启动。</li>
</ol>
<h4 id="切换或去除嵌入式服务器："><a href="#切换或去除嵌入式服务器：" class="headerlink" title="切换或去除嵌入式服务器："></a>切换或去除嵌入式服务器：</h4><ol>
<li>在 pom.xml 中引入 web 包时排除 Tomcat 依赖的包：</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>引入你需要的服务器包，SpringBoot 已配置好版本号不需要填写版本号直接引入即可。</li>
</ol>
<h3 id="数据校验"><a href="#数据校验" class="headerlink" title="数据校验"></a>数据校验</h3><ul>
<li>添加依赖：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- SpringBoot JSR303数据校验 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-validation --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Validated</span>  <span class="comment">// 数据校验</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="meta">@Email(message=&quot;邮箱格式错误&quot;)</span> <span class="comment">// name 必须是邮箱格式</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>常用注解：</li>
</ul>
<table>
<thead>
<tr>
<th align="center">注解</th>
<th align="center">验证的数据类型</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">@AssertFalse</td>
<td align="center">Boolean,boolean</td>
<td align="center">值必须是false</td>
</tr>
<tr>
<td align="center">@AssertTrue</td>
<td align="center">Boolean,boolean</td>
<td align="center">值必须是true</td>
</tr>
<tr>
<td align="center">@NotNull</td>
<td align="center">任意类型</td>
<td align="center">值不能是null</td>
</tr>
<tr>
<td align="center">@Null</td>
<td align="center">任意类型</td>
<td align="center">值必须是null</td>
</tr>
<tr>
<td align="center">@Min</td>
<td align="center">BigDecimal、BigInteger、byte、short、int、long、double 以及任何Number或CharSequence子类型</td>
<td align="center">大于等于@Min指定的值</td>
</tr>
<tr>
<td align="center">@Max</td>
<td align="center">同上</td>
<td align="center">小于等于@Max指定的值</td>
</tr>
<tr>
<td align="center">@DecimalMin</td>
<td align="center">同上</td>
<td align="center">大于等于@DecimalMin指定的值（超高精度）</td>
</tr>
<tr>
<td align="center">@DecimalMax</td>
<td align="center">同上</td>
<td align="center">小于等于@DecimalMax指定的值（超高精度）</td>
</tr>
<tr>
<td align="center">@Digits</td>
<td align="center">同上</td>
<td align="center">限制整数位数和小数位数上限</td>
</tr>
<tr>
<td align="center">@Size</td>
<td align="center">字符串、Collection、Map、数组等</td>
<td align="center">长度在指定区间之内，如字符串长度、集合大小等</td>
</tr>
<tr>
<td align="center">@Past</td>
<td align="center">如 java.util.Date, java.util.Calendar 等日期类型</td>
<td align="center">值必须比当前时间早</td>
</tr>
<tr>
<td align="center">@Future</td>
<td align="center">同上</td>
<td align="center">值必须比当前时间晚</td>
</tr>
<tr>
<td align="center">@NotBlank</td>
<td align="center">CharSequence及其子类</td>
<td align="center">值不为空，在比较时会去除字符串的首位空格</td>
</tr>
<tr>
<td align="center">@Length</td>
<td align="center">CharSequence及其子类</td>
<td align="center">字符串长度在指定区间内</td>
</tr>
<tr>
<td align="center">@NotEmpty</td>
<td align="center">CharSequence及其子类、Collection、Map、数组</td>
<td align="center">值不为null且长度不为空（字符串长度不为0，集合大小不为0）</td>
</tr>
<tr>
<td align="center">@Range</td>
<td align="center">BigDecimal、BigInteger、CharSequence、byte、short、int、long 以及原子类型和包装类型</td>
<td align="center">值在指定区间内</td>
</tr>
<tr>
<td align="center">@Email</td>
<td align="center">CharSequence及其子类</td>
<td align="center">值必须是邮件格式</td>
</tr>
<tr>
<td align="center">@Pattern</td>
<td align="center">CharSequence及其子类</td>
<td align="center">值需要与指定的正则表达式匹配</td>
</tr>
<tr>
<td align="center">@Valid</td>
<td align="center">任何非原子类型</td>
<td align="center">用于验证对象属性</td>
</tr>
</tbody></table>
<h3 id="Swagger"><a href="#Swagger" class="headerlink" title="Swagger"></a>Swagger</h3><blockquote>
<p>  <a target="_blank" rel="noopener" href="https://swagger.io/">Swagger官网：https://swagger.io/</a></p>
<ol>
<li>RestFul API 文档在线生成工具</li>
<li>可直接运行，支持在线测试</li>
</ol>
</blockquote>
<h4 id="1-swagger-2-版："><a href="#1-swagger-2-版：" class="headerlink" title="1. swagger 2 版："></a>1. swagger 2 版：</h4><ul>
<li>pom.xml依赖：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- swagger2 API 文档工具 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger2 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-swagger-ui --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Swagger2Config配置类：</li>
</ul>
<p><strong>请产考下方swagger3 配置</strong> ，swagger2 启动依赖为 <code>@EnableSwagger2</code> ,文档类型为<code>DocumentationType.SWAGGER_2</code> 其它使用无太大变化。</p>
<p>浏览器访问地址为： <strong>项目地址&#x2F;swagger-ui.html</strong> </p>
<h4 id="2-swagger-3-版："><a href="#2-swagger-3-版：" class="headerlink" title="2. swagger 3 版："></a>2. swagger 3 版：</h4><ul>
<li>swagger 3 依赖：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/io.springfox/springfox-boot-starter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Swagger3Config配置类：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//@EnableSwagger2 // 开启swagger2</span></span><br><span class="line"><span class="meta">@EnableOpenApi</span> <span class="comment">// 开启swagger3</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">()</span>&#123; <span class="comment">// 配置 Docket bean实例</span></span><br><span class="line">       <span class="comment">// return new Docket(DocumentationType.SWAGGER_2) // swagger2</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.OAS_30) <span class="comment">// swagger3</span></span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .enable(<span class="literal">true</span>) <span class="comment">// 是否开启 swagger</span></span><br><span class="line">                .groupName(<span class="string">&quot;分组1&quot;</span>)</span><br><span class="line">                .select()</span><br><span class="line">                <span class="comment">/** RequestHandlerSelectors 指定扫描方式的类</span></span><br><span class="line"><span class="comment">                 * basePackage：指定扫描需要生成api的包</span></span><br><span class="line"><span class="comment">                 * withClassAnnotation：扫描类上有指定注解的类(如GetMapping.class)</span></span><br><span class="line"><span class="comment">                 * withMethodAnnotation：扫描方法上有指定注解的方法</span></span><br><span class="line"><span class="comment">                 * any：全部扫描</span></span><br><span class="line"><span class="comment">                 * none：不扫描</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;ruoxijun.cn&quot;</span>))</span><br><span class="line">                .paths(PathSelectors.ant(<span class="string">&quot;/find**&quot;</span>)) <span class="comment">// 请求过滤</span></span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 配置 swagger 网页的一些显示信息</span></span><br><span class="line">    <span class="keyword">private</span> ApiInfo <span class="title function_">apiInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Contact</span> <span class="variable">contact</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Contact</span>( <span class="comment">// 作者信息</span></span><br><span class="line">                <span class="string">&quot;ruoxijun&quot;</span>,</span><br><span class="line">                <span class="string">&quot;http://ruoxijun.cn/&quot;</span>,</span><br><span class="line">                <span class="string">&quot;1460662245@qq.com&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfo</span>(</span><br><span class="line">                <span class="string">&quot;项目 Api 标题&quot;</span>,</span><br><span class="line">                <span class="string">&quot;项目 Api 描述&quot;</span>,</span><br><span class="line">                <span class="string">&quot;1.0&quot;</span>,</span><br><span class="line">                <span class="string">&quot;http://ruoxijun.cn/&quot;</span>,</span><br><span class="line">                contact,</span><br><span class="line">                <span class="string">&quot;Apache 2.0&quot;</span>,</span><br><span class="line">                <span class="string">&quot;http://www.apache.org/licenses/LICENSE-2.0&quot;</span>,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ArrayList</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 需要有多个分组时就配置多个 docketBean 即可</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">docket2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .groupName(<span class="string">&quot;分组2&quot;</span>); <span class="comment">// 分组名（其它配置暂不写了）</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>浏览器访问地址为： <strong>项目地址&#x2F;swagger-ui&#x2F;index.html</strong></p>
<h4 id="3-常用注解："><a href="#3-常用注解：" class="headerlink" title="3.常用注解："></a>3.常用注解：</h4><ol>
<li>conllection 类常用注解：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api(tags = &quot;conllection 类说明&quot;)</span> <span class="comment">// conllection 类描述</span></span><br><span class="line"><span class="meta">@ApiOperation(value = &quot;请求方法作用&quot;,notes = &quot;请求方法备注说明&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiImplicitParams(&#123; // 方法参数集，required 表示参数是否必须</span></span><br><span class="line"><span class="meta">    @ApiImplicitParam(name = &quot;参数名&quot;,value = &quot;参数描述&quot;,required = true),</span></span><br><span class="line"><span class="meta">    @ApiImplicitParam(name = &quot;v&quot;,value = &quot;value值&quot;,required = true)</span></span><br><span class="line"><span class="meta">&#125;)</span> <span class="comment">// 参数较少时也可在方法参数旁添加：@ApiParam(&quot;参数描述&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ApiResponses(&#123; // 方法响应 code 描述，response 抛出的异常类</span></span><br><span class="line"><span class="meta">    @ApiResponse(code = 200,message = &quot;返回数据成功&quot;),</span></span><br><span class="line"><span class="meta">    @ApiResponse(code = 400,message = &quot;返回数据失败&quot;,response = ParamsException.class)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>实体类常用注解：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiModel(&quot;用户实体类&quot;)</span> <span class="comment">// 类描述</span></span><br><span class="line"><span class="meta">@ApiModelProperty(&quot;用户id&quot;)</span> <span class="comment">// 成员变量描述</span></span><br></pre></td></tr></table></figure>

<h3 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CorsConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> &#123;</span><br><span class="line">      <span class="comment">// 设置允许跨域的路径</span></span><br><span class="line">        registry.addMapping(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                <span class="comment">// 设置允许跨域请求的域名</span></span><br><span class="line">                .allowedOriginPatterns(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                <span class="comment">// 是否允许cookie</span></span><br><span class="line">                .allowCredentials(<span class="literal">true</span>)</span><br><span class="line">                <span class="comment">// 设置允许的请求方式</span></span><br><span class="line">                .allowedMethods(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;DELETE&quot;</span>, <span class="string">&quot;PUT&quot;</span>)</span><br><span class="line">                <span class="comment">// 设置允许的header属性</span></span><br><span class="line">                .allowedHeaders(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                <span class="comment">// 跨域允许时间</span></span><br><span class="line">                .maxAge(<span class="number">3600</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="数据库开发"><a href="#数据库开发" class="headerlink" title="数据库开发"></a>数据库开发</h2><h3 id="JDBC："><a href="#JDBC：" class="headerlink" title="JDBC："></a>JDBC：</h3><h4 id="1-添加依赖："><a href="#1-添加依赖：" class="headerlink" title="1. 添加依赖："></a>1. 添加依赖：</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入jdbc --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mysql 驱动 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;version&gt; 8.0.20 &lt;/version&gt; 不提倡直接修改版本 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>在 spring-boot-starter-jdbc 中引入了 <strong>HikariDataSource</strong> 数据源（数据库连接池）、jdbc、spring 事务包，因此我们需要操作什么数据库导入相应驱动即可。</li>
<li>SpringBoot 默认数据库驱动版本一般与本机数据库版本不一致，建议修改版本配置与本机一致：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>8.0.20<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-数据库配置："><a href="#2-数据库配置：" class="headerlink" title="2. 数据库配置："></a>2. 数据库配置：</h4><h5 id="自动配置分析："><a href="#自动配置分析：" class="headerlink" title="自动配置分析："></a>自动配置分析：</h5><ol>
<li><code>DataSourceAutoConfiguration</code> 数据源自动配置</li>
</ol>
<ul>
<li>数据源相关属性都与 <code>DataSourceProperties</code> 绑定，对应配置 <code>spring.datasource</code> 的相关属性。</li>
<li>数据库连接池默认的配置在我们没有配置 <code>DataSource</code> 时才会自动配置，且默认配置使用 <code>HikariDataSource</code> 连接池。</li>
</ul>
<ol start="2">
<li><code>DataSourceTransactionManagerAutoConfiguration</code> 事务管理器自动配置</li>
</ol>
<h5 id="数据库相关配置："><a href="#数据库相关配置：" class="headerlink" title="数据库相关配置："></a>数据库相关配置：</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/ssm_crud?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">88888888</span></span><br><span class="line"><span class="comment">#    type: com.zaxxer.hikari.HikariDataSource 配置数据源（默认 hikari）</span></span><br></pre></td></tr></table></figure>

<h4 id="3-测试使用："><a href="#3-测试使用：" class="headerlink" title="3. 测试使用："></a>3. 测试使用：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span> <span class="comment">// lombok</span></span><br><span class="line"><span class="meta">@SpringBootTest</span> <span class="comment">// spring-boot-starter-test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringBoot01Test</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JdbcTemplate jdbcTemplate;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dataSourceTest</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; maps = jdbcTemplate.queryForList(<span class="string">&quot;select * from book&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;查询结果 &#123;&#125; &quot;</span>, maps);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Druid："><a href="#Druid：" class="headerlink" title="Druid："></a>Druid：</h3><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/alibaba/druid">项目官方地址：https://github.com/alibaba/druid</a></p>
<p>官方介绍：Druid 是 Java 语言中最好的数据库连接池，Druid 能够提供强大的监控和扩展功能。</p>
</blockquote>
<h4 id="1-使用-druid："><a href="#1-使用-druid：" class="headerlink" title="1. 使用 druid："></a>1. 使用 druid：</h4><h5 id="1-引入依赖："><a href="#1-引入依赖：" class="headerlink" title="1. 引入依赖："></a>1. 引入依赖：</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 如需使用 druid 数据监控时需要用到 log4j --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/log4j/log4j --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="2-配置-druid："><a href="#2-配置-druid：" class="headerlink" title="2. 配置 druid："></a>2. 配置 druid：</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/springboot-vue-manage?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">88888888</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">filters:</span> <span class="string">stat,wall</span> <span class="comment"># stat：SQL 监控，wall：SQL 防火墙</span></span><br></pre></td></tr></table></figure>

<ol>
<li>要使用 druid 数据源，由前可知需要注入 druid 的 <code>DataSource</code> 来使默认的数据源失效（也支持配置文件中 <code>spring.dataSource.type</code> 属性配置数据源）。</li>
<li>想要开启 druid 监控与统计数据的页面需要配置 <code>StatViewServlet</code> 。</li>
<li>页面开启后 <code>DruidDataSource</code> 中配置 <code>filters</code> 属性开启各类监控，值 stat 开启 SQL 监控，值 wall 开启 SQL 防火墙。</li>
<li>配置 <code>WebStatFilter</code> 可开启 web 监控，并设置统计和需要排除的请求。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DruidConfiguration</span> &#123;</span><br><span class="line">    <span class="comment">// 配置 druid 数据源，并将此数据源属性与配置绑定</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 添加 StatViewServlet 开启数据统计页面</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletRegistrationBean <span class="title function_">statViewServlet</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">StatViewServlet</span> <span class="variable">viewServlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StatViewServlet</span>();</span><br><span class="line">        ServletRegistrationBean&lt;StatViewServlet&gt; registrationBean =</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>&lt;&gt;(viewServlet, <span class="string">&quot;/druid/*&quot;</span>);</span><br><span class="line">        <span class="comment">// 添加初始化参数并设置监控登录页面的账户</span></span><br><span class="line">        registrationBean.addInitParameter(<span class="string">&quot;loginUsername&quot;</span>, <span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        registrationBean.addInitParameter(<span class="string">&quot;loginPassword&quot;</span>, <span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 开启 web 监控</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean <span class="title function_">webStatFilter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">WebStatFilter</span> <span class="variable">webStatFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebStatFilter</span>();</span><br><span class="line">        FilterRegistrationBean&lt;WebStatFilter&gt; registrationBean</span><br><span class="line">                = <span class="keyword">new</span> <span class="title class_">FilterRegistrationBean</span>&lt;&gt;(webStatFilter);</span><br><span class="line">        <span class="comment">// 设置连接路径</span></span><br><span class="line">        registrationBean.setUrlPatterns(Arrays.asList(<span class="string">&quot;/*&quot;</span>));</span><br><span class="line">        <span class="comment">// 添加初始化参数，exclusions 设置排除的请求，不加如统计</span></span><br><span class="line">        registrationBean.addInitParameter(<span class="string">&quot;exclusions&quot;</span>, <span class="string">&quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在浏览器中访问 <strong>项目地址&#x2F;druid 或 项目地址&#x2F;druid&#x2F;login.html</strong> 即可查看监控页面。</p>
<h4 id="2-druid-starter"><a href="#2-druid-starter" class="headerlink" title="2. druid starter:"></a>2. druid starter:</h4><h5 id="1-引入-druid-的-starter："><a href="#1-引入-druid-的-starter：" class="headerlink" title="1. 引入 druid 的 starter："></a>1. 引入 druid 的 starter：</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https:<span class="comment">//mvnrepository.com/artifact/com.alibaba/druid-spring-boot-starter --&gt;</span></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.2</span><span class="number">.14</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>除了引入 druid 包手动配置以外，druid 提供了 druid-spring-boot-starter 它引入了 druid、slf4j、以及一个自动配置 druid 的包，其中设置了大量默认配置项，也可以在配置文件中自定义配置值。</p>
<h5 id="2-druid-starter-配置："><a href="#2-druid-starter-配置：" class="headerlink" title="2. druid starter 配置："></a>2. druid starter 配置：</h5><p><a target="_blank" rel="noopener" href="https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter">druid&#x2F;druid-spring-boot-starter 使用方法与详细配置</a></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/springboot-vue-manage?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">88888888</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">stat-view-servlet:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启监控页面</span></span><br><span class="line">        <span class="attr">login-username:</span> <span class="string">admin</span> <span class="comment"># 登录监控页面账号</span></span><br><span class="line">        <span class="attr">login-password:</span> <span class="string">admin</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">web-stat-filter:</span> <span class="comment"># web 监控</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">url-pattern:</span>  <span class="string">/*</span></span><br><span class="line">        <span class="attr">exclusions:</span> <span class="string">&#x27;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&#x27;</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">filters:</span> <span class="string">stat,</span> <span class="string">wall</span> <span class="comment"># stat：SQL 监控，wall：SQL 防火墙，可单独详细配置</span></span><br><span class="line">      <span class="attr">aop-patterns:</span> <span class="string">top.ruoxijun.bean.*</span> <span class="comment"># Spring 监控 AOP 切入点</span></span><br></pre></td></tr></table></figure>

<h3 id="Mybatis："><a href="#Mybatis：" class="headerlink" title="Mybatis："></a>Mybatis：</h3><h4 id="1-引入依赖：-1"><a href="#1-引入依赖：-1" class="headerlink" title="1. 引入依赖："></a>1. 引入依赖：</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 数据库驱动 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Mybatis --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis.spring.boot/mybatis-spring-boot-starter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 添加pagehelper分页插件集成依赖 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.github.pagehelper/pagehelper-spring-boot-starter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>mybatis-spring-boot-starter 中已经引入 jdbc starter 场景。</li>
</ul>
<h4 id="2-添加配置："><a href="#2-添加配置：" class="headerlink" title="2. 添加配置："></a>2. 添加配置：</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/test?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">88888888</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="comment"># 指定原生 mybatis 总配置文件位置（ classpath: 表示 resources 文件夹下 ）</span></span><br><span class="line">  <span class="comment"># config-location: classpath:mybatis/mybatis-config.xml</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span> <span class="comment"># mapper.xml 位置</span></span><br><span class="line">  <span class="comment"># 此配置项中包含所有全局配置，且不能与 config-location 配置同时存在</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span> <span class="comment"># 驼峰命名与下划线匹配</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">top.ruoxijun.entity</span> <span class="comment"># 为此包下的基类自动取别名</span></span><br><span class="line"></span><br><span class="line"><span class="attr">pagehelper:</span> <span class="comment"># 分页插件配置</span></span><br><span class="line">  <span class="attr">helper-dialect:</span> <span class="string">mysql</span> <span class="comment"># 使用mysql</span></span><br></pre></td></tr></table></figure>

<h4 id="3-基础使用："><a href="#3-基础使用：" class="headerlink" title="3. 基础使用："></a>3. 基础使用：</h4><ol>
<li>创建 mapper 接口：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span> <span class="comment">// 声明此类是 mybatis 的 mapper 类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123; List&lt;User&gt; <span class="title function_">findAllUser</span><span class="params">()</span>; &#125;</span><br></pre></td></tr></table></figure>

<p>每一个 mapper 类都要加一个 <code>@Mapper</code> 注解表明它是一个 mapper 接口，也可以选择在启动类中利用 <code>@MapperScan(&quot;top.ruoxijun.mapper&quot;)</code> 直接扫描整个 mapper 文件夹。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;top.ruoxijun.mapper&quot;)</span> <span class="comment">// 扫描mapper文件夹中的所有mapper接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123; SpringApplication.run(MainApplication.class,args); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用扫描可能出现在使用 <code>@Autowired</code> 注解自动装配 mapper 对象时在 idea 编辑器中报红显示找不到对象，但是放心运行时是没有问题的。可以不理也可用以下方法解决：</p>
<ul>
<li><p>使用 <code>@Resource</code> 注解装配 mapper 对象。</p>
</li>
<li><p>在 mapper 接口上使用 <code>@Repository </code> 标识为 bean 。</p>
</li>
<li><p>关闭或修改IDE的代码检查</p>
</li>
</ul>
<ol start="2">
<li>在 <em>resources</em> 文件夹下新建 mapper-locations 配置中的文件夹，然后建立 mapper 接口的对应 mapper.xml 即可。</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;对应的 Mapper 文件位置&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Mybatis-Plus："><a href="#Mybatis-Plus：" class="headerlink" title="Mybatis Plus："></a>Mybatis Plus：</h3><h4 id="1-引入依赖：-2"><a href="#1-引入依赖：-2" class="headerlink" title="1. 引入依赖："></a>1. 引入依赖：</h4><p><a target="_blank" rel="noopener" href="https://baomidou.com/">MyBatis-Plus 官网地址 (baomidou.com)</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.baomidou/mybatis-plus-boot-starter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>它已经引入了 mybatis 与 jdbc 等场景。</li>
<li>配置与 <code>MybatisPlusProperties</code> 绑定（ <code>mybatis-plus</code> ）。</li>
<li>配置 mapper.xml 文件位置属性 <code>mapperLocations</code> （ <code>mybatis-plus.mapper-locations</code> ） 默认值 <code>classpath*:/mapper/**/*.xml</code> 表示任意工程路径下所有 mapper 文件夹的下 xml 都是 mapper.xml （即不仅是当前项目 classpath 还包括 jar 包该路径下）。</li>
</ul>
<h4 id="2-简单实例："><a href="#2-简单实例：" class="headerlink" title="2. 简单实例："></a>2. 简单实例：</h4><ol>
<li>在 <code>MainApplication</code> 类上使用 <code>@MapperScan(&quot;top.ruoxijun.mapper&quot;)</code> 指定扫描的 mapper 接口包（也可使用 @Mapper 注解方式）。</li>
<li>编写 mapper 接口并继承 <code>BaseMapper&lt;User&gt;</code> 泛型是你要操作的表对应的基类：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>在 <code>BaseMapper</code> 中已经为我们声明了一些常用的数据操作方法，无需编写 mapper.xml 文件，即可获得 crud 功能（当它满足不了某些需求时可新建方法与 xml 进行自定义）。</p>
</li>
<li><p>默认基类的属性在表中必须有对应字段否则报错，如果属性无对应字段可在该属性上标注 <code>@TableField(exist = false)</code> 表示该属性在表中不存在。</p>
</li>
</ul>
<ol start="3">
<li>实现 Service 业务类：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 继承 IService 接口，泛型为要操作的基类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span> <span class="comment">// 1. 标注 @Service 实现 service 接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span></span><br><span class="line">    <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="comment">// 2. 继承 ServiceImpl 泛型分别为操作的 mapper 与基类</span></span><br><span class="line">    <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123; &#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>实现 Controller 请求：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(&#123;&quot;user&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">user</span><span class="params">( <span class="meta">@RequestParam(value = &quot;pN&quot;, defaultValue = &quot;1&quot;)</span> Integer pageNum )</span> &#123;</span><br><span class="line">        HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        List&lt;User&gt; users = userService.list(); <span class="comment">// 查询表中所有数据</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 分页查询</span></span><br><span class="line">        Page&lt;User&gt; userPage = <span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(pageNum, <span class="number">2</span>);</span><br><span class="line">        Page&lt;User&gt; page = userService.page(userPage);</span><br><span class="line">        </span><br><span class="line">        map.put(<span class="string">&quot;users&quot;</span>, users);</span><br><span class="line">        map.put(<span class="string">&quot;page&quot;</span>, page);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>分页查询还需要使用分页插件（其它插件使用方式同理）：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        <span class="comment">// 分页拦截器，已有默认属性可自定义分页属性</span></span><br><span class="line">        <span class="type">PaginationInnerInterceptor</span> <span class="variable">paginationInnerInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>();</span><br><span class="line">        interceptor.addInnerInterceptor(paginationInnerInterceptor);</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Redis："><a href="#Redis：" class="headerlink" title="Redis："></a>Redis：</h3><ol>
<li>引入 Redis 场景：</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 需要 jedis 操作 Redis 时引入 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>默认引入了 <strong>Lettuce</strong> 操作 Redis，使用 <strong>jedis</strong> 需要我们手动引入并且在 <code>client-type</code> 配置项中申明想使用的客户端。</li>
</ul>
<ol start="2">
<li>Redis 配置：</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">data:</span> <span class="comment"># springboot 3.x 开始需要 data 配置项</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.166</span> <span class="comment"># 服务器地址</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">6379</span> <span class="comment"># 端口</span></span><br><span class="line">      <span class="attr">database:</span> <span class="number">0</span> <span class="comment"># 数据库索引</span></span><br><span class="line">      <span class="attr">username:</span> <span class="comment"># 用户名（没有可以去除）</span></span><br><span class="line">      <span class="attr">password:</span> <span class="number">123456</span> <span class="comment"># 密码</span></span><br><span class="line">      <span class="attr">connect-timeout:</span> <span class="string">10s</span> <span class="comment"># 连接超时时间</span></span><br><span class="line">      <span class="comment"># client-type: jedis # 切换操作 Redis 的客户端</span></span><br><span class="line">      <span class="attr">lettuce:</span> <span class="comment"># redis 客户端（默认 lettuce，还有 jedis）</span></span><br><span class="line">      <span class="attr">pool:</span> <span class="comment"># 连接池配置</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">8</span> <span class="comment"># 最大连接数（负数表示没有限制）</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="string">200s</span> <span class="comment"># 最大阻塞等待时间（负数表示没有限制，默认 -1）</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">8</span> <span class="comment"># 最大空闲连接</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span> <span class="comment"># 最小空闲连接</span></span><br></pre></td></tr></table></figure>

<h3 id="事务控制"><a href="#事务控制" class="headerlink" title="事务控制"></a>事务控制</h3><ul>
<li>SpringBoot 对事务提供了实现并自动配置我们只需在需要添加事务的方法上添加如下注释即可：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRED)</span></span><br></pre></td></tr></table></figure>

<h2 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h2><h3 id="简介与使用："><a href="#简介与使用：" class="headerlink" title="简介与使用："></a>简介与使用：</h3><h4 id="1-引入依赖：-3"><a href="#1-引入依赖：-3" class="headerlink" title="1. 引入依赖："></a>1. 引入依赖：</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-Junit5："><a href="#2-Junit5：" class="headerlink" title="2. Junit5："></a>2. Junit5：</h4><p>SpringBoot 2.2.0 版本开始引入 JUnit5 作为单元测试默认库，由三个不同子项目的几个不同模块组成<br><code>JUnit 5 = JUnit Platform + JUnit Jupiter + JUnit Vintage</code> 。</p>
<p><strong>JUnit Platform</strong>: Junit Platform 是在 JVM 上启动测试框架的基础，不仅支持 Junit 自制的测试引擎，其他测试引擎也都可以接入。</p>
<p><strong>JUnit Jupiter</strong>: JUnit Jupiter 提供了 JUnit5 的新的编程模型，是 JUnit5 新特性的核心。内部包含了一个<strong>测试引擎</strong>，用于在 Junit Platform 上运行。</p>
<p><strong>JUnit Vintage</strong>: 由于 JUint 已经发展多年，为了照顾老的项目，JUnit Vintage 提供了兼容JUnit4.x,Junit3.x 的测试引擎。</p>
<ul>
<li>SpringBoot2.4 以上版本移除了默认对 <strong>JUnit Vintage</strong> 的依赖，如果需要兼容 junit4 需要自行引入：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 测试兼容 Junit4 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hamcrest<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hamcrest-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-使用方式："><a href="#3-使用方式：" class="headerlink" title="3. 使用方式："></a>3. 使用方式：</h4><ol>
<li>分别使用 <code>@SpringBootTest</code> 与 <code>@Test</code> （org.junit.<strong>jupiter</strong>.api.Test）注解标记测试类与测试方法：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringBootTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>被 <code>@SpringBootTest</code> 标记的类支持  <code>@Autowired</code> 、 <code>@Transactional</code> （标注的测试方法，测试完成后自动回滚） 等 SpringBoot 注解。</li>
</ol>
<h3 id="Junit5-常用注解："><a href="#Junit5-常用注解：" class="headerlink" title="Junit5 常用注解："></a>Junit5 常用注解：</h3><p><a target="_blank" rel="noopener" href="https://junit.org/junit5/docs/current/user-guide/#writing-tests-annotations">JUnit 5 官方文档 - 常用注解</a></p>
<ul>
<li><strong>@ParameterizedTest</strong> : 表示方法是参数化测试</li>
<li><strong>@RepeatedTest</strong> : 表示方法可重复执行</li>
<li><strong>@DisplayName</strong> : 为测试类或者测试方法设置展示名称</li>
<li><strong>@BeforeEach</strong> : 表示方法在每个单元测试之前执行， <code>@AfterEach</code> （之后）同理</li>
<li><strong>@BeforeAll</strong> : 表示 <strong>静态方法</strong> 在所有单元测试之前执行， <code>@AfterAll</code> 同理</li>
<li><strong>@Tag</strong> : 表示单元测试类别，类似于 JUnit4 中的 <code>@Categories</code></li>
<li><strong>@Disabled</strong> : 表示测试类或测试方法不执行，类似于 JUnit4 中的 <code>@Ignore</code></li>
<li><strong>@Timeout</strong> : 表示测试方法运行如果超过了指定时间将会返回错误</li>
<li><strong>@ExtendWith</strong> : 为测试类或测试方法提供扩展类引用</li>
</ul>
<h3 id="断言机制："><a href="#断言机制：" class="headerlink" title="断言机制："></a>断言机制：</h3><h4 id="1-简单断言："><a href="#1-简单断言：" class="headerlink" title="1. 简单断言："></a>1. 简单断言：</h4><ul>
<li>测试方法中前面的断言失败则后面的代码不会执行。</li>
<li>断言方法一般都是 <code>Assertions</code> 中的静态方法，简单使用方式：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.junit.jupiter.api.Assertions.assertEquals; <span class="comment">// 直接导入静态方法</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">simple</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 是否相等，参1 期望值、参2 实际值、参3（可选）错误信息</span></span><br><span class="line">    assertEquals(<span class="number">1</span>, <span class="number">1</span>, <span class="string">&quot;值不相等&quot;</span>);</span><br><span class="line">    <span class="comment">// 是否是同一个对象</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    assertSame(o, o);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>常用简单断言：</li>
</ul>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>assertEquals</td>
<td>两个对象值或两个原始类型值是否相等</td>
</tr>
<tr>
<td>assertNotEquals</td>
<td>两个对象或两个原始类型是否不相等</td>
</tr>
<tr>
<td>assertSame</td>
<td>两个对象引用是否指向同一个对象</td>
</tr>
<tr>
<td>assertNotSame</td>
<td>两个对象引用是否指向不同的对象</td>
</tr>
<tr>
<td>assertTrue</td>
<td>给定的布尔值是否为 true</td>
</tr>
<tr>
<td>assertFalse</td>
<td>给定的布尔值是否为 false</td>
</tr>
<tr>
<td>assertNull</td>
<td>给定的对象引用是否为 null</td>
</tr>
<tr>
<td>assertNotNull</td>
<td>给定的对象引用是否不为 null</td>
</tr>
<tr>
<td>assertArrayEquals</td>
<td>两个对象或原始类型的数组是否相等</td>
</tr>
</tbody></table>
<h4 id="2-组合断言："><a href="#2-组合断言：" class="headerlink" title="2. 组合断言："></a>2. 组合断言：</h4><ul>
<li>有需要多个断言全部满足条件时可使用 <code>assertAll</code> ：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">assertAllTest</span><span class="params">()</span>&#123;</span><br><span class="line">    assertAll(<span class="string">&quot;组合断言&quot;</span>, <span class="comment">// 参1（可选）为该组合断言取名字</span></span><br><span class="line">            ()-&gt; assertTrue(<span class="literal">true</span>),</span><br><span class="line">            ()-&gt; assertNotEquals(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-异常断言："><a href="#3-异常断言：" class="headerlink" title="3. 异常断言："></a>3. 异常断言：</h4><ul>
<li>业务逻辑在某情况下一定出现异常时使用 <code>assertThrows</code> ：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">assertThrowsTest</span><span class="params">()</span>&#123;</span><br><span class="line">    assertThrows(ArithmeticException.class, <span class="comment">// 预期错误类型</span></span><br><span class="line">            ()-&gt; &#123; <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span> / <span class="number">0</span>; &#125;,</span><br><span class="line">            <span class="string">&quot;异常成功触发&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-超时断言："><a href="#4-超时断言：" class="headerlink" title="4. 超时断言："></a>4. 超时断言：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">timeoutTest</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//如果测试方法时间超过1s将会异常</span></span><br><span class="line">    Assertions.assertTimeout(Duration.ofMillis(<span class="number">1000</span>), () -&gt; Thread.sleep(<span class="number">500</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-快速失败："><a href="#5-快速失败：" class="headerlink" title="5. 快速失败："></a>5. 快速失败：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shouldFail</span><span class="params">()</span> &#123;</span><br><span class="line">    fail(<span class="string">&quot;This should fail&quot;</span>); <span class="comment">// 直接失败</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="前置条件："><a href="#前置条件：" class="headerlink" title="前置条件："></a>前置条件：</h3><p>assumptions（假设）当不满足某前置条件时测试将不会继续执行但不会报错：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">assumeTest</span><span class="params">()</span>&#123;</span><br><span class="line">    assumeTrue(<span class="literal">true</span>, <span class="string">&quot;不是 true&quot;</span>);</span><br><span class="line">    assumingThat(<span class="literal">true</span>, <span class="comment">// 条件满足时执行 Executable 接口</span></span><br><span class="line">        ()-&gt; System.out.println(<span class="string">&quot;是 true&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="嵌套测试："><a href="#嵌套测试：" class="headerlink" title="嵌套测试："></a>嵌套测试：</h3><p>在 Java 内部类上标注 <code>@Nested</code> 注解可实现嵌套测试（可无限嵌套），且内部单元测试会激活外部的 <code>@BeforeEach</code> 等（BeforeAll、After…）方法（反之不行）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">JunitTest</span> &#123;</span><br><span class="line">    <span class="meta">@Nested</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">NestedTest</span>&#123;</span><br><span class="line">        <span class="comment">// 测试方法或更多内部类嵌套...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 测试方法...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="参数化测试："><a href="#参数化测试：" class="headerlink" title="参数化测试："></a>参数化测试：</h3><ul>
<li><p><code>@ValueSource</code> : 为参数化测试指定入参来源，支持八大基础类以及 String 类型, Class 类型</p>
</li>
<li><p><code>@NullSource</code> : 表示为参数化测试提供一个 null 的入参</p>
</li>
<li><p><code>@EnumSource</code> : 表示为参数化测试提供一个枚举入参</p>
</li>
<li><p><code>@CsvFileSource</code> ：表示读取指定 CSV 文件内容作为参数化测试入参</p>
</li>
<li><p><code>@MethodSource</code> ：表示读取指定方法的返回值作为参数化测试入参(注意方法返回需要是一个流)</p>
</li>
</ul>
<p>使用 <code>@ParameterizedTest</code> 注解标注方法表示这是一个参数化测试的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@ValueSource(strings = &#123;&quot;1&quot;, &quot;2&quot;&#125;)</span> <span class="comment">// 将值依次传入测试方法中测试</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">valueSourceTest</span><span class="params">(String s)</span>&#123;</span><br><span class="line">    assertNotNull(s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@ParameterizedTest</span></span><br><span class="line"><span class="meta">@MethodSource(&quot;method&quot;)</span> <span class="comment">// 1. 指定方法名</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWithExplicitLocalMethodSource</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    assertNotNull(s);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 2. 方法必须是 static 且返回流</span></span><br><span class="line"><span class="keyword">static</span> Stream&lt;String&gt; <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Stream.of(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="指标监控"><a href="#指标监控" class="headerlink" title="指标监控"></a>指标监控</h2><h3 id="SpringBoot-Actuator"><a href="#SpringBoot-Actuator" class="headerlink" title="SpringBoot Actuator:"></a>SpringBoot Actuator:</h3><ol>
<li>依赖导入：</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>访问路径：</li>
</ol>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/actuator/">localhost:8080&#x2F;actuator&#x2F;</a> 在此路径下还可以访问更详细的监控端点 <code>/actuator/**</code> ，默认 JMX 暴露所有端点而 web（http） 只默认暴露 <strong>health</strong> (&#x2F;actuator&#x2F;health) 和 <strong>info</strong> 端点。</p>
<ol start="3">
<li>配置：</li>
</ol>
<p>常用监控端点（Endpoint）：Health 监控状况、Metrics 运行时指标、Loggers 日志记录。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="comment"># 配置所有端点的默认行为</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">enabled-by-default:</span> <span class="literal">false</span> <span class="comment"># 关闭所有监控端点</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span> <span class="comment"># 以 web 方式暴露所有监控端点</span></span><br><span class="line">  <span class="comment"># 配置具体端点</span></span><br><span class="line">  <span class="attr">endpoint:</span></span><br><span class="line">    <span class="attr">health:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启 health 监控端点</span></span><br><span class="line">      <span class="attr">show-details:</span> <span class="string">always</span> <span class="comment"># 开启 health 端点的详细信息显示</span></span><br><span class="line">    <span class="attr">metrics:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment"># 开启 metrics 端点</span></span><br><span class="line">    <span class="attr">loggers:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>定制 Endpoint （Health、Metrics、Info、Endpoint 等）信息略。</li>
<li>可视化：<a target="_blank" rel="noopener" href="https://github.com/codecentric/spring-boot-admin">spring-boot-admin：https://github.com/codecentric/spring-boot-admin</a></li>
</ol>
<h2 id="启动过程"><a href="#启动过程" class="headerlink" title="启动过程"></a>启动过程</h2><h3 id="启动原理："><a href="#启动原理：" class="headerlink" title="启动原理："></a>启动原理：</h3><ol>
<li>在主程序中 <code>SpringApplication.run(MainApplication.class, args)</code> 方法创建了一个 <code>SpringApplication</code> 对象：</li>
</ol>
<ul>
<li><p>保存信息，判断当前应用类型。</p>
</li>
<li><p>找到所有的 bootstrapRegistryInitializers 初始启动引导器（在 spring.factories 找）。</p>
</li>
<li><p>找到所有的 ApplicationContextInitializer 初始化器（在 spring.factories 找）。</p>
</li>
<li><p>找到所有的 ApplicationListener 应用监听器（在 spring.factories 找）。</p>
</li>
</ul>
<ol start="2">
<li>执行 <code>SpringApplication</code> 对象的 <code>run</code> 方法：</li>
</ol>
<ul>
<li>记录应用启动时间，创建引导上下文（DefaultBootstrapContext），它会挨个执行之前获取的 <strong>初始启动引导器</strong> 的 initialize 方法完成引导启动器上下文环境设置。</li>
<li>让当前应用进入 headless（java.awt.headless） 模式。</li>
<li>获取所有 SpringApplicationRunListeners 运行监听器（在 spring.factories 找），遍历所有的运行监听器并调用它的 <code>starting</code> 方法（监听器执行 <strong>应用开始启动</strong> 事件）。</li>
<li>保存命令行参数 ApplicationArguments 。</li>
<li>准备环境 ConfigurableEnvironment：<ul>
<li>当前上下文有环境信息就获取否则就新创建一个基础环境信息。</li>
<li>配置环境信息对象，读取所有配置源的配置属性值，绑定环境信息。</li>
<li>遍历所有的运行监听器并调用它的 <code>environmentPrepared</code> 方法（监听器执行 <strong>环境准备完成</strong> 事件）。</li>
</ul>
</li>
<li>创建 IOC 容器 <code>createApplicationContext()</code> (根据项目类型创建容器)。</li>
<li>prepareContext 准备 IOC 容器基本信息：<ul>
<li>applyInitializers 应用初始化器，遍历所有 <strong>初始化器</strong> 对 IOC 容器进行初始化。</li>
<li>遍历所有的运行监听器并调用它的 <code>contextPrepared</code> 方法（监听器执行 <strong>IOC 容器准备完成</strong> 事件）。</li>
<li>遍历所有的运行监听器并调用它的 <code>contextLoaded</code> 方法（监听器执行 <strong>IOC 容器已加载</strong> 事件）。</li>
</ul>
</li>
<li>refreshContext 刷新容器，在容器中创建所有需要创建的组件。</li>
<li>afterRefresh 执行容器刷新后处理。</li>
<li>遍历所有的运行监听器并调用它的 <code>started</code> 方法（监听器执行 <strong>IOC 容器已启动</strong> 事件）。</li>
<li>callRunners 调用所有的 runners：<ul>
<li>获取容器中的 ApplicationRunner 与 CommandLineRunner 并且按照 <code>@Order</code> 进行排序。</li>
<li>遍历所有 runners 执行 run 方法。</li>
</ul>
</li>
<li>如果以上有异常发生将调用运行监听器的 failed 方法（监听器执行 <strong>项目启动失败</strong> 事件）。</li>
<li>无异常将调用运行监听器的 ready 方法（实际执行 running 方法，监听器执行 <strong>项目已完全启动</strong> 事件），其中如果发生异常依然执行 failed 方法。</li>
<li>最后返回整个 IOC 容器。</li>
</ul>
<h3 id="自定义监听组件："><a href="#自定义监听组件：" class="headerlink" title="自定义监听组件："></a>自定义监听组件：</h3><ol>
<li>需要在 resources 中 <code>META-INF/spring.factories</code> 内配置的组件：</li>
</ol>
<ul>
<li><p>ApplicationContextInitializer</p>
</li>
<li><p>ApplicationListener</p>
</li>
<li><p>SpringApplicationRunListener</p>
</li>
</ul>
<ol start="2">
<li>直接可通过 Spring 注入容器中的组件（如添加 <code>@Component</code> 注解等方式）：</li>
</ol>
<ul>
<li><p>ApplicationRunner</p>
</li>
<li><p>CommandLineRunner</p>
</li>
</ul>
<h2 id="整合-Jsp"><a href="#整合-Jsp" class="headerlink" title="整合 Jsp"></a>整合 Jsp</h2><blockquote>
<p>  产考文献：<a target="_blank" rel="noopener" href="https://blog.csdn.net/fmwind/article/details/81144905">Spring Boot 中使用之 JSP 篇</a></p>
<p>  其它问题：<a target="_blank" rel="noopener" href="https://blog.csdn.net/jxchallenger/article/details/86760245?utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1.no_search_link&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~default-1.no_search_link">spring boot 设置启动时初始化 DispatcherServlet 出错</a></p>
</blockquote>
<h3 id="1-所需依赖："><a href="#1-所需依赖：" class="headerlink" title="1. 所需依赖："></a>1. 所需依赖：</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- SpringBoot 内置tomcat对jsp的解析包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.embed<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat-embed-jasper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- servlet 依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- jsp 依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet.jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- jsp对jstl语法的依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-application-配置："><a href="#2-application-配置：" class="headerlink" title="2. application 配置："></a>2. application 配置：</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.mvc.view.prefix</span>: <span class="string">/WEB-INF/jsp/ # jsp存放文件夹(注意不包含webapp文件夹)</span></span><br><span class="line"><span class="attr">spring.mvc.view.suffix</span>: <span class="string">.jsp # 视图文件后缀</span></span><br></pre></td></tr></table></figure>

<p>这是 properties 文件配置 yml 配置文件同理转化即可。</p>
<h3 id="3-idea-设置和问题："><a href="#3-idea-设置和问题：" class="headerlink" title="3. idea 设置和问题："></a>3. idea 设置和问题：</h3><h4 id="1-资源过滤问题："><a href="#1-资源过滤问题：" class="headerlink" title="1. 资源过滤问题："></a>1. 资源过滤问题：</h4><p>如果遇到 jsp 文件不在编译后的项目中可在 <code>pom.xml</code> 的 <code>build</code> 标签中添加如下资源过滤配置。（可以根据需要更改配置）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 一些项目中包含xml配置文件或资源文件可能在</span></span><br><span class="line"><span class="comment">打包时不能成功，需要在project中添加下配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.*<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 将webapp中的页面编译到META-INF/resources中 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/webapp<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">targetPath</span>&gt;</span>META-INF/resources<span class="tag">&lt;/<span class="name">targetPath</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.*<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-将webapp在idea中设置为web资源文件夹："><a href="#2-将webapp在idea中设置为web资源文件夹：" class="headerlink" title="2. 将webapp在idea中设置为web资源文件夹："></a>2. 将webapp在idea中设置为web资源文件夹：</h4><p><img src="/images/java/springboot/boot+jsp.png" alt="SpringBoot整合jsp"></p>
<h4 id="3-项目找不到-jsp-文件："><a href="#3-项目找不到-jsp-文件：" class="headerlink" title="3. 项目找不到 jsp 文件："></a>3. 项目找不到 jsp 文件：</h4><p><img src="/images/java/springboot/boot+jsp2.png" alt="SpringBoot整合jsp"></p>
<p>视图前缀配置中有人容易加上 <code>webapp</code> 文件夹前缀，也是造成jsp页面访问不到的原因。</p>
<h2 id="SpringBoot-任务"><a href="#SpringBoot-任务" class="headerlink" title="SpringBoot 任务"></a>SpringBoot 任务</h2><h3 id="异步任务"><a href="#异步任务" class="headerlink" title="异步任务"></a>异步任务</h3><ol>
<li>在主程序类上使用 <code>@EnableAsync</code> 注解开启异步任务。</li>
<li>在需要异步执行的业务方法上添加 <code>@Async</code> 注解。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestService</span> &#123;</span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">asyncTest</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>该方法执行时自动异步执行，不会阻碍下方的代码执行。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;asyncTest&quot;, method = RequestMethod.GET)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">asyncTest</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    testService.asyncTest();</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;asyncTest&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="邮件任务"><a href="#邮件任务" class="headerlink" title="邮件任务"></a>邮件任务</h3><ol>
<li>导入依赖：</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>以 QQ 邮箱为例，在账户中开启 <strong>POP3&#x2F;SMTP</strong> 服务并获取 <strong>授权码</strong> 。</li>
<li>邮箱配置：</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mail:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">smtp.163.com</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">25</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">mail</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">password</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">smtp</span></span><br><span class="line">    <span class="attr">default-encoding:</span> <span class="string">UTF-8</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">mail:</span></span><br><span class="line">        <span class="attr">smtp:</span></span><br><span class="line">          <span class="attr">auth:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">starttls:</span></span><br><span class="line">            <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">            <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">ssl:</span></span><br><span class="line">            <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">socketFactory:</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">25</span></span><br><span class="line">            <span class="attr">class:</span> <span class="string">javax.net.ssl.SSLSocketFactory</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>发送邮件：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;spring.mail.username&#125;&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String from;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">JavaMailSenderImpl mailSender;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;sendMail&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">sendMail</span><span class="params">(<span class="meta">@RequestParam</span> String msg)</span>&#123;</span><br><span class="line">    <span class="type">SimpleMailMessage</span> <span class="variable">sendMail</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleMailMessage</span>(); <span class="comment">// 简单的邮件协议</span></span><br><span class="line">    sendMail.setFrom(from); <span class="comment">// 发件人</span></span><br><span class="line">    sendMail.setTo(<span class="string">&quot;2994160002@qq.com&quot;</span>); <span class="comment">// 收件人</span></span><br><span class="line">    sendMail.setSubject(<span class="string">&quot;邮件主题&quot;</span>);</span><br><span class="line">    sendMail.setText(<span class="string">&quot;邮件内容&quot;</span>);</span><br><span class="line">    mailSender.send(sendMail);</span><br><span class="line">    <span class="keyword">return</span> msg + <span class="string">&quot; - 发送成功&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>复杂邮件：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MimeMessage</span> <span class="variable">mimeMessage</span> <span class="operator">=</span> mailSender.createMimeMessage(); <span class="comment">// 创建邮件</span></span><br><span class="line"><span class="comment">// 使用邮件助手设置邮件</span></span><br><span class="line"><span class="type">MimeMessageHelper</span> <span class="variable">helper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MimeMessageHelper</span>(mimeMessage, <span class="literal">true</span>);</span><br><span class="line">helper.setFrom(from);</span><br><span class="line">helper.setTo(<span class="string">&quot;2994160002@qq.com&quot;</span>);</span><br><span class="line">helper.setSubject(<span class="string">&quot;邮件主题&quot;</span>);</span><br><span class="line">helper.setText(<span class="string">&quot;&lt;h1&gt;开启 HTML 解析&lt;/h1&gt;&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">helper.addAttachment(<span class="string">&quot;附件名称&quot;</span>, <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:\\桌面文件\\IDEA-java主题配色.jar&quot;</span>));</span><br><span class="line">mailSender.send(mimeMessage); <span class="comment">// 发送邮件</span></span><br></pre></td></tr></table></figure>

<h3 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h3><ol>
<li>在主程序类上使用 <code>@EnableScheduling</code> 注解标注开启定时任务功能。</li>
<li>在需要开启定时任务的业务方法上使用 <code>@Scheduled</code> 注解标注，并使用 <strong>cron</strong> 表达式指定执行时间。</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://cron.qqe2.com/">在线Cron表达式生成器 (qqe2.com)</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// cron： 秒 分 时 日 月 星期</span></span><br><span class="line"><span class="meta">@Scheduled(cron = &quot;0/5 * * * * *&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">schedulingTest</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">SimpleDateFormat</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);</span><br><span class="line">    System.out.println(date.format(<span class="keyword">new</span> <span class="title class_">Date</span>()) + <span class="string">&quot; 每五秒执行&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h3><h4 id="添加依赖："><a href="#添加依赖：" class="headerlink" title="添加依赖："></a>添加依赖：</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Server（服务端）："><a href="#Server（服务端）：" class="headerlink" title="Server（服务端）："></a>Server（服务端）：</h4><ol>
<li>配置类中注入 <code>ServerEndpointExporter</code> 启用 websocket 支持：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServerEndpointExporter <span class="title function_">serverEndpointExporter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServerEndpointExporter</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>编写 websocket 服务端：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@ServerEndpoint(&quot;/websocket/&#123;id&#125;&quot;)</span> <span class="comment">// 定义 websocket 访问地址(地址前必须有 &#x27;/&#x27;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketServer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Session&gt; sessionMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onOpen</span><span class="params">(<span class="meta">@PathParam(&quot;id&quot;)</span> String id, Session session)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;onOpen: &#123;&#125; , 当前连接数: &#123;&#125;&quot;</span>, id, sessionMap.size());</span><br><span class="line">        sessionMap.put(id, session);</span><br><span class="line">        sendMsgAll(<span class="string">&quot;欢迎: &quot;</span>+ id +<span class="string">&quot;, 当前人数: &quot;</span>+ sessionMap.size());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">OnMessage</span><span class="params">(<span class="meta">@PathParam(&quot;id&quot;)</span> String id, String message)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;OnMessage: &#123;&#125; -&gt; &#123;&#125;&quot;</span>, id, message);</span><br><span class="line">        sendMsgAllNotMe(id, id+ <span class="string">&quot;：&quot;</span>+ message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">OnClose</span><span class="params">(<span class="meta">@PathParam(&quot;id&quot;)</span> String id)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;OnClose: &#123;&#125; , 当前连接数: &#123;&#125;&quot;</span>, id, sessionMap.size());</span><br><span class="line">        sessionMap.remove(id);</span><br><span class="line">        sendMsgAll(<span class="string">&quot;退出: &quot;</span>+ id +<span class="string">&quot;, 当前人数: &quot;</span>+ sessionMap.size());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnError</span> <span class="comment">// Throwable 参数必须有否则报错</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">OnError</span><span class="params">(<span class="meta">@PathParam(&quot;id&quot;)</span> String id, Throwable error)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;OnError: &#123;&#125; , 当前连接数: &#123;&#125;&quot;</span>, id, sessionMap.size());</span><br><span class="line">        <span class="keyword">if</span> (sessionMap.containsKey(id))&#123;</span><br><span class="line">            sessionMap.remove(id);</span><br><span class="line">        &#125;</span><br><span class="line">        sendMsgAll(<span class="string">&quot;出错: &quot;</span>+ id +<span class="string">&quot;, 当前人数: &quot;</span>+ sessionMap.size());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendMsg</span><span class="params">(String id, String message)</span>&#123;</span><br><span class="line">        <span class="type">Session</span> <span class="variable">session</span> <span class="operator">=</span> sessionMap.get(id);</span><br><span class="line">        session.getAsyncRemote().sendText(message);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendMsgAll</span><span class="params">(String message)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Session session : sessionMap.values())&#123;</span><br><span class="line">            session.getAsyncRemote().sendText(message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendMsgAllNotMe</span><span class="params">(String id, String message)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (String i : sessionMap.keySet())&#123;</span><br><span class="line">            <span class="keyword">if</span> (!i.equals(id))&#123;</span><br><span class="line">                <span class="type">Session</span> <span class="variable">session</span> <span class="operator">=</span> sessionMap.get(i);</span><br><span class="line">                session.getAsyncRemote().sendText(message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Client（客户端）："><a href="#Client（客户端）：" class="headerlink" title="Client（客户端）："></a>Client（客户端）：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ClientEndpoint</span> <span class="comment">// 定义客户端</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CqClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Session s;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;client.uri&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String uri;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 连接</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">connect</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s == <span class="literal">null</span> || !s.isOpen())&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                s =  ContainerProvider.getWebSocketContainer()</span><br><span class="line">                        .connectToServer(<span class="built_in">this</span>, <span class="keyword">new</span> <span class="title class_">URI</span>(<span class="built_in">this</span>.uri));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">OnOpen</span><span class="params">(Session session)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;OnOpen 连接成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">OnMessage</span><span class="params">(String message)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;接收消息 ---&gt; &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">OnClose</span><span class="params">(Session session)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;OnClose 连接关闭&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@OnError</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">OnError</span><span class="params">(Session session, Throwable throwable)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;OnError 连接出错&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendMsg</span><span class="params">(String msg)</span> <span class="keyword">throws</span> JsonProcessingException &#123;</span><br><span class="line">        s.getAsyncRemote().sendText(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h2><ul>
<li>基本使用：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(MyClass.class);</span><br><span class="line"></span><br><span class="line">logger.debug(<span class="string">&quot;This is a debug message&quot;</span>);</span><br><span class="line">logger.info(<span class="string">&quot;This is an info message&quot;</span>);</span><br><span class="line">logger.warn(<span class="string">&quot;This is a warning message&quot;</span>);</span><br><span class="line">logger.error(<span class="string">&quot;This is an error message&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用占位符 &#123;&#125;</span></span><br><span class="line">logger.debug(<span class="string">&quot;User &#123;&#125; logged in successfully&quot;</span>, username);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调试时条件</span></span><br><span class="line"><span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">expensiveDebugInfo</span> <span class="operator">=</span> generateExpensiveDebugInfo();</span><br><span class="line">    logger.debug(<span class="string">&quot;Expensive debug info: &#123;&#125;&quot;</span>, expensiveDebugInfo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 建议错误日志打印方式</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// Some code that may throw an exception</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    logger.error(<span class="string">&quot;An error occurred: &#123;&#125;&quot;</span>, e.getMessage(), e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>在 Spring Boot 项目中只需将 <code>logback-spring.xml</code> 文件放置在 <code>src/main/resources</code> 目录下，Spring Boot 就会在启动时自动加载并应用这个日志配置：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 引入 Spring Boot 提供的默认配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">resource</span>=<span class="string">&quot;org/springframework/boot/logging/logback/base.xml&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 定义变量 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 日志文件的存储位置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;LOG_HOME&quot;</span> <span class="attr">value</span>=<span class="string">&quot;./logs&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 应用程序名称 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;APP_NAME&quot;</span> <span class="attr">value</span>=<span class="string">&quot;application&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 日志文件的最大历史记录数，单个日志文件的最大大小 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;MAX_HISTORY&quot;</span> <span class="attr">value</span>=<span class="string">&quot;30&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;MAX_FILE_SIZE&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10MB&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 控制台和文件的日志输出格式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE_PATTERN&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;FILE_PATTERN&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 控制台日志配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;Console&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;CONSOLE_PATTERN&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 文件日志配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;RollingFile&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 文件名与日志格式 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;LOG_HOME&#125;/$&#123;APP_NAME&#125;-0-current.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>$&#123;FILE_PATTERN&#125;<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 日志滚动策略 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 日志文件名、单个日志文件最大大小 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;LOG_HOME&#125;/$&#123;APP_NAME&#125;-%d&#123;yyyy-MM-dd&#125;.%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>$&#123;MAX_FILE_SIZE&#125;<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 文件保存最多个数，超过时会删除之前的文件 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>$&#123;MAX_HISTORY&#125;<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- root 处理所有的日志事件，level=&quot;INFO&quot; 日志级别 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;Console&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;RollingFile&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 为特定的包或类配置单独的日志事件（可定义多个），</span></span><br><span class="line"><span class="comment">        additivity=&quot;false&quot; 不会将日志传递给其祖先 Logger --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.example&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;Console&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;RollingFile&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">ruoxijun</div><div class="post-copyright__author_desc">若惜君</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://ruoxijun.top/2020/08/29/java/springboot/SpringBoot/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://ruoxijun.top/2020/08/29/java/springboot/SpringBoot/')">SpringBoot</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://ruoxijun.top/2020/08/29/java/springboot/SpringBoot/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=SpringBoot&amp;url=http://ruoxijun.top/2020/08/29/java/springboot/SpringBoot/&amp;pic=https://www.ruoxijun.top/getRandomImageR2?_r_=99c9522a-1d3c-dfe0-72d7-dd2ed0d12255" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/springboot/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>springboot<span class="tagsPageCount">2</span></a><a class="post-meta__box__tags" href="/tags/swagger/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>swagger<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/druid/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>druid<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://www.ruoxijun.top/getRandomImageR2?_r_=50921c90-c577-0c73-1e9f-153cc3a425ca" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/08/22/java/ssm/springMVC/date/"><img class="prev-cover" src="https://www.ruoxijun.top/getRandomImageR2?_r_=9dccbf47-5985-1d56-96ae-c14685b9fc23" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">SpringMVC数据处理</div></div></a></div><div class="next-post pull-right"><a href="/2020/10/06/java/ssm/ssm/"><img class="next-cover" src="https://www.ruoxijun.top/getRandomImageR2?_r_=e7bea1ef-64e1-0429-2f46-9140e56fc2a4" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">ssm 整合</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2023/04/29/java/springboot/SpringSecurity/" title="SpringSecurity"><img class="cover" src="https://www.ruoxijun.top/getRandomImageR2?_r_=50921c90-c577-0c73-1e9f-153cc3a425ca" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-history fa-fw"></i> 2024-09-14</div><div class="title">SpringSecurity</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> Comment</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-switch"><span class="first-comment">Twikoo</span><span id="switch-btn"></span><span class="second-comment">Waline</span></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div><div><div id="waline-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><span>最是人间留不住，<br/>朱颜辞镜花辞树。<span></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">ruoxijun</h1><div class="author-info__desc">若惜君</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://ruoxijun.top/" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot"><span class="toc-number">1.</span> <span class="toc-text">SpringBoot</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.1.</span> <span class="toc-text">微服务简介</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.2.</span> <span class="toc-text">创建项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AE%98%E7%BD%91%E5%88%9B%E5%BB%BA%EF%BC%9A"><span class="toc-number">1.2.1.</span> <span class="toc-text">1. 官网创建：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%89%8B%E5%8A%A8%E5%88%9B%E5%BB%BA%EF%BC%9A"><span class="toc-number">1.2.2.</span> <span class="toc-text">2. 手动创建：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-IDEA-%E5%88%9B%E5%BB%BA%EF%BC%9A"><span class="toc-number">1.2.3.</span> <span class="toc-text">3. IDEA 创建：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.</span> <span class="toc-text">自动配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86%EF%BC%9A"><span class="toc-number">1.3.1.</span> <span class="toc-text">依赖管理：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9D%E6%8E%A2%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">1.3.2.</span> <span class="toc-text">初探自动配置：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%8A%9F%E8%83%BD%EF%BC%9A"><span class="toc-number">1.3.3.</span> <span class="toc-text">容器功能：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Configuration%EF%BC%9A"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">1. @Configuration：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">1.3.3.1.1.</span> <span class="toc-text">使用:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Full-%E6%A8%A1%E5%BC%8F%EF%BC%9A"><span class="toc-number">1.3.3.1.2.</span> <span class="toc-text">Full 模式：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Lite-%E6%A8%A1%E5%BC%8F%EF%BC%9A"><span class="toc-number">1.3.3.1.3.</span> <span class="toc-text">Lite 模式：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Import%EF%BC%9A"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">2. @Import：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-Conditional%EF%BC%9A"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">3. @Conditional：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-ImportResource%EF%BC%9A"><span class="toc-number">1.3.3.4.</span> <span class="toc-text">4. @ImportResource：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E9%85%8D%E7%BD%AE%E7%BB%91%E5%AE%9A%EF%BC%9A"><span class="toc-number">1.3.3.5.</span> <span class="toc-text">5. 配置绑定：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%8E%9F%E7%94%9F-java-%E6%96%B9%E6%B3%95%EF%BC%9A"><span class="toc-number">1.3.3.5.1.</span> <span class="toc-text">1. 原生 java 方法：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E7%B1%BB%E5%B7%B2%E6%98%AF%E7%BB%84%E4%BB%B6%EF%BC%9A"><span class="toc-number">1.3.3.5.2.</span> <span class="toc-text">2. 类已是组件：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%9C%A8%E9%85%8D%E7%BD%AE%E7%B1%BB%E4%B8%8A%E5%BC%80%E5%90%AF%EF%BC%9A"><span class="toc-number">1.3.3.5.3.</span> <span class="toc-text">3. 在配置类上开启：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-number">1.3.4.</span> <span class="toc-text">自动配置原理：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-SpringBootConfiguration%EF%BC%9A"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">1. @SpringBootConfiguration：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-EnableAutoConfiguration%EF%BC%9A"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">2. @EnableAutoConfiguration：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">1.3.4.3.</span> <span class="toc-text">3. 修改默认配置：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="toc-number">1.3.4.4.</span> <span class="toc-text">4. 总结：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.4.</span> <span class="toc-text">配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">1.4.1.</span> <span class="toc-text">常用配置：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#yml-%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F%EF%BC%9A"><span class="toc-number">1.4.2.</span> <span class="toc-text">yml 配置方式：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E5%9B%BE%E6%A0%87%EF%BC%9A"><span class="toc-number">1.4.3.</span> <span class="toc-text">启动图标：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%83%AD%E9%83%A8%E7%BD%B2%EF%BC%9A"><span class="toc-number">1.4.4.</span> <span class="toc-text">热部署：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-pom-xml-%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">1.4.4.1.</span> <span class="toc-text">1. pom.xml 配置：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%B8%BB%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">1.4.4.2.</span> <span class="toc-text">2. 主配置文件配置：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%8C%85%EF%BC%9A"><span class="toc-number">1.4.5.</span> <span class="toc-text">打包：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#jar-%E5%8C%85%EF%BC%9A"><span class="toc-number">1.4.5.1.</span> <span class="toc-text">jar 包：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#war-%E5%8C%85%EF%BC%9A"><span class="toc-number">1.4.5.2.</span> <span class="toc-text">war 包：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Profile%EF%BC%9A"><span class="toc-number">1.4.6.</span> <span class="toc-text">Profile：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">1.4.6.1.</span> <span class="toc-text">环境配置：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-starter"><span class="toc-number">1.4.7.</span> <span class="toc-text">自定义 starter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-%E5%BC%80%E5%8F%91"><span class="toc-number">1.5.</span> <span class="toc-text">web 开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%EF%BC%9A"><span class="toc-number">1.5.1.</span> <span class="toc-text">静态资源：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E4%BD%BF%E7%94%A8%EF%BC%9A"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">静态资源使用：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%A4%84%E7%90%86%E8%A7%84%E5%88%99%EF%BC%9A"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">自定义静态资源处理规则：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">静态资源配置原理：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-WebMvcAutoConfiguration"><span class="toc-number">1.5.1.3.1.</span> <span class="toc-text">1. WebMvcAutoConfiguration:</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-WebMvcAutoConfigurationAdapter%EF%BC%9A"><span class="toc-number">1.5.1.3.2.</span> <span class="toc-text">2. WebMvcAutoConfigurationAdapter：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%A4%84%E7%90%86%E8%A7%84%E5%88%99%EF%BC%9A"><span class="toc-number">1.5.1.3.3.</span> <span class="toc-text">3. 静态资源处理规则：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E6%AC%A2%E8%BF%8E%E9%A1%B5%E5%A4%84%E7%90%86%E8%A7%84%E5%88%99%EF%BC%9A"><span class="toc-number">1.5.1.3.4.</span> <span class="toc-text">4. 欢迎页处理规则：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-favicon-ico%EF%BC%9A"><span class="toc-number">1.5.1.3.5.</span> <span class="toc-text">5. favicon.ico：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E5%8D%95%E4%B8%8E-RestFul%EF%BC%9A"><span class="toc-number">1.5.2.</span> <span class="toc-text">表单与 RestFul：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%BC%80%E5%90%AF%E6%96%B9%E5%BC%8F%EF%BC%9A"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">1. 开启方式：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90%EF%BC%9A"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">2. 原理解析：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E8%87%AA%E5%AE%9A%E4%B9%89-HiddenHttpMethodFilter%EF%BC%9A"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">3. 自定义 HiddenHttpMethodFilter：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E6%98%A0%E5%B0%84%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-number">1.5.3.</span> <span class="toc-text">请求映射原理：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-MVC"><span class="toc-number">1.5.4.</span> <span class="toc-text">自定义 MVC:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%A4%84%E7%90%86%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-number">1.5.5.</span> <span class="toc-text">参数处理原理：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%B3%A8%E8%A7%A3%E5%8F%82%E6%95%B0%EF%BC%9A"><span class="toc-number">1.5.5.1.</span> <span class="toc-text">1. 注解参数：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Servlet-API-%E5%8F%82%E6%95%B0%EF%BC%9A"><span class="toc-number">1.5.5.2.</span> <span class="toc-text">2. Servlet API 参数：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%A4%8D%E6%9D%82%E5%8F%82%E6%95%B0%EF%BC%9A"><span class="toc-number">1.5.5.3.</span> <span class="toc-text">3. 复杂参数：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%B9%E8%B1%A1%E5%8F%82%E6%95%B0%EF%BC%9A"><span class="toc-number">1.5.5.4.</span> <span class="toc-text">4. 自定义对象参数：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-Converter%EF%BC%9A"><span class="toc-number">1.5.6.</span> <span class="toc-text">自定义 Converter：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%93%8D%E5%BA%94%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-number">1.5.7.</span> <span class="toc-text">数据响应原理：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%93%8D%E5%BA%94-JSON%EF%BC%9A"><span class="toc-number">1.5.7.1.</span> <span class="toc-text">1. 响应 JSON：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-number">1.5.7.2.</span> <span class="toc-text">2. 内容协商原理：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%BC%80%E5%90%AF%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8F%82%E6%95%B0%E6%96%B9%E5%BC%8F%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86%E5%8A%9F%E8%83%BD%EF%BC%9A"><span class="toc-number">1.5.7.3.</span> <span class="toc-text">3. 开启浏览器参数方式内容协商功能：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-HttpMessageConverter%EF%BC%9A"><span class="toc-number">1.5.8.</span> <span class="toc-text">自定义 HttpMessageConverter：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90"><span class="toc-number">1.5.9.</span> <span class="toc-text">视图解析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Thymeleaf-%E6%A8%A1%E6%9D%BF%EF%BC%9A"><span class="toc-number">1.5.9.1.</span> <span class="toc-text">Thymeleaf 模板：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%BC%95%E5%85%A5-Starter%EF%BC%9A"><span class="toc-number">1.5.9.1.1.</span> <span class="toc-text">1. 引入 Starter：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-Thymeleaf-%E4%BD%BF%E7%94%A8%EF%BC%9A"><span class="toc-number">1.5.9.1.2.</span> <span class="toc-text">2. Thymeleaf 使用：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-number">1.5.9.2.</span> <span class="toc-text">视图解析原理：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">1.5.10.</span> <span class="toc-text">拦截器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HandlerInterceptor%EF%BC%9A"><span class="toc-number">1.5.10.1.</span> <span class="toc-text">HandlerInterceptor：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%8B%A6%E6%88%AA%E5%99%A8%EF%BC%9A"><span class="toc-number">1.5.10.2.</span> <span class="toc-text">使用拦截器：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-number">1.5.10.3.</span> <span class="toc-text">拦截器原理：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%EF%BC%9A"><span class="toc-number">1.5.11.</span> <span class="toc-text">文件上传：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%EF%BC%9A-1"><span class="toc-number">1.5.11.1.</span> <span class="toc-text">文件上传：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90%EF%BC%9A"><span class="toc-number">1.5.11.2.</span> <span class="toc-text">原理解析：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%EF%BC%9A"><span class="toc-number">1.5.12.</span> <span class="toc-text">错误处理：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E6%9C%BA%E5%88%B6%EF%BC%9A"><span class="toc-number">1.5.12.1.</span> <span class="toc-text">默认机制：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%EF%BC%9A"><span class="toc-number">1.5.12.2.</span> <span class="toc-text">自定义异常处理：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-number">1.5.12.3.</span> <span class="toc-text">异常处理原理：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B%EF%BC%9A"><span class="toc-number">1.5.12.4.</span> <span class="toc-text">异常处理流程：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web-%E5%8E%9F%E7%94%9F%E7%BB%84%E4%BB%B6%EF%BC%9A"><span class="toc-number">1.5.13.</span> <span class="toc-text">web 原生组件：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ServletComponentScan%EF%BC%9A"><span class="toc-number">1.5.13.1.</span> <span class="toc-text">@ServletComponentScan：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#xxxRegistrationBean%EF%BC%9A"><span class="toc-number">1.5.13.2.</span> <span class="toc-text">xxxRegistrationBean：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DispatcherServlet-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.13.3.</span> <span class="toc-text">DispatcherServlet 实现原理:</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B5%8C%E5%85%A5%E5%BC%8F-Servlet-%E5%AE%B9%E5%99%A8%EF%BC%9A"><span class="toc-number">1.5.14.</span> <span class="toc-text">嵌入式 Servlet 容器：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-number">1.5.14.1.</span> <span class="toc-text">原理：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%87%E6%8D%A2%E6%88%96%E5%8E%BB%E9%99%A4%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%9A"><span class="toc-number">1.5.14.2.</span> <span class="toc-text">切换或去除嵌入式服务器：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.5.15.</span> <span class="toc-text">数据校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Swagger"><span class="toc-number">1.5.16.</span> <span class="toc-text">Swagger</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-swagger-2-%E7%89%88%EF%BC%9A"><span class="toc-number">1.5.16.1.</span> <span class="toc-text">1. swagger 2 版：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-swagger-3-%E7%89%88%EF%BC%9A"><span class="toc-number">1.5.16.2.</span> <span class="toc-text">2. swagger 3 版：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3%EF%BC%9A"><span class="toc-number">1.5.16.3.</span> <span class="toc-text">3.常用注解：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%A8%E5%9F%9F"><span class="toc-number">1.5.17.</span> <span class="toc-text">跨域</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BC%80%E5%8F%91"><span class="toc-number">1.6.</span> <span class="toc-text">数据库开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JDBC%EF%BC%9A"><span class="toc-number">1.6.1.</span> <span class="toc-text">JDBC：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96%EF%BC%9A"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">1. 添加依赖：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">2. 数据库配置：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%88%86%E6%9E%90%EF%BC%9A"><span class="toc-number">1.6.1.2.1.</span> <span class="toc-text">自动配置分析：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">1.6.1.2.2.</span> <span class="toc-text">数据库相关配置：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%B5%8B%E8%AF%95%E4%BD%BF%E7%94%A8%EF%BC%9A"><span class="toc-number">1.6.1.3.</span> <span class="toc-text">3. 测试使用：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Druid%EF%BC%9A"><span class="toc-number">1.6.2.</span> <span class="toc-text">Druid：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%BD%BF%E7%94%A8-druid%EF%BC%9A"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">1. 使用 druid：</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96%EF%BC%9A"><span class="toc-number">1.6.2.1.1.</span> <span class="toc-text">1. 引入依赖：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AE-druid%EF%BC%9A"><span class="toc-number">1.6.2.1.2.</span> <span class="toc-text">2. 配置 druid：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-druid-starter"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">2. druid starter:</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%BC%95%E5%85%A5-druid-%E7%9A%84-starter%EF%BC%9A"><span class="toc-number">1.6.2.2.1.</span> <span class="toc-text">1. 引入 druid 的 starter：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-druid-starter-%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">1.6.2.2.2.</span> <span class="toc-text">2. druid starter 配置：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mybatis%EF%BC%9A"><span class="toc-number">1.6.3.</span> <span class="toc-text">Mybatis：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96%EF%BC%9A-1"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">1. 引入依赖：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">2. 添加配置：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%EF%BC%9A"><span class="toc-number">1.6.3.3.</span> <span class="toc-text">3. 基础使用：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mybatis-Plus%EF%BC%9A"><span class="toc-number">1.6.4.</span> <span class="toc-text">Mybatis Plus：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96%EF%BC%9A-2"><span class="toc-number">1.6.4.1.</span> <span class="toc-text">1. 引入依赖：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BE%8B%EF%BC%9A"><span class="toc-number">1.6.4.2.</span> <span class="toc-text">2. 简单实例：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis%EF%BC%9A"><span class="toc-number">1.6.5.</span> <span class="toc-text">Redis：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6"><span class="toc-number">1.6.6.</span> <span class="toc-text">事务控制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-number">1.7.</span> <span class="toc-text">单元测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B%E4%B8%8E%E4%BD%BF%E7%94%A8%EF%BC%9A"><span class="toc-number">1.7.1.</span> <span class="toc-text">简介与使用：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96%EF%BC%9A-3"><span class="toc-number">1.7.1.1.</span> <span class="toc-text">1. 引入依赖：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Junit5%EF%BC%9A"><span class="toc-number">1.7.1.2.</span> <span class="toc-text">2. Junit5：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F%EF%BC%9A"><span class="toc-number">1.7.1.3.</span> <span class="toc-text">3. 使用方式：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Junit5-%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3%EF%BC%9A"><span class="toc-number">1.7.2.</span> <span class="toc-text">Junit5 常用注解：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%AD%E8%A8%80%E6%9C%BA%E5%88%B6%EF%BC%9A"><span class="toc-number">1.7.3.</span> <span class="toc-text">断言机制：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%AE%80%E5%8D%95%E6%96%AD%E8%A8%80%EF%BC%9A"><span class="toc-number">1.7.3.1.</span> <span class="toc-text">1. 简单断言：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%BB%84%E5%90%88%E6%96%AD%E8%A8%80%EF%BC%9A"><span class="toc-number">1.7.3.2.</span> <span class="toc-text">2. 组合断言：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%BC%82%E5%B8%B8%E6%96%AD%E8%A8%80%EF%BC%9A"><span class="toc-number">1.7.3.3.</span> <span class="toc-text">3. 异常断言：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E8%B6%85%E6%97%B6%E6%96%AD%E8%A8%80%EF%BC%9A"><span class="toc-number">1.7.3.4.</span> <span class="toc-text">4. 超时断言：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%BF%AB%E9%80%9F%E5%A4%B1%E8%B4%A5%EF%BC%9A"><span class="toc-number">1.7.3.5.</span> <span class="toc-text">5. 快速失败：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6%EF%BC%9A"><span class="toc-number">1.7.4.</span> <span class="toc-text">前置条件：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E6%B5%8B%E8%AF%95%EF%BC%9A"><span class="toc-number">1.7.5.</span> <span class="toc-text">嵌套测试：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%8C%96%E6%B5%8B%E8%AF%95%EF%BC%9A"><span class="toc-number">1.7.6.</span> <span class="toc-text">参数化测试：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7"><span class="toc-number">1.8.</span> <span class="toc-text">指标监控</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SpringBoot-Actuator"><span class="toc-number">1.8.1.</span> <span class="toc-text">SpringBoot Actuator:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.9.</span> <span class="toc-text">启动过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E5%8E%9F%E7%90%86%EF%BC%9A"><span class="toc-number">1.9.1.</span> <span class="toc-text">启动原理：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9B%91%E5%90%AC%E7%BB%84%E4%BB%B6%EF%BC%9A"><span class="toc-number">1.9.2.</span> <span class="toc-text">自定义监听组件：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B4%E5%90%88-Jsp"><span class="toc-number">1.10.</span> <span class="toc-text">整合 Jsp</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%89%80%E9%9C%80%E4%BE%9D%E8%B5%96%EF%BC%9A"><span class="toc-number">1.10.1.</span> <span class="toc-text">1. 所需依赖：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-application-%E9%85%8D%E7%BD%AE%EF%BC%9A"><span class="toc-number">1.10.2.</span> <span class="toc-text">2. application 配置：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-idea-%E8%AE%BE%E7%BD%AE%E5%92%8C%E9%97%AE%E9%A2%98%EF%BC%9A"><span class="toc-number">1.10.3.</span> <span class="toc-text">3. idea 设置和问题：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E8%B5%84%E6%BA%90%E8%BF%87%E6%BB%A4%E9%97%AE%E9%A2%98%EF%BC%9A"><span class="toc-number">1.10.3.1.</span> <span class="toc-text">1. 资源过滤问题：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%B0%86webapp%E5%9C%A8idea%E4%B8%AD%E8%AE%BE%E7%BD%AE%E4%B8%BAweb%E8%B5%84%E6%BA%90%E6%96%87%E4%BB%B6%E5%A4%B9%EF%BC%9A"><span class="toc-number">1.10.3.2.</span> <span class="toc-text">2. 将webapp在idea中设置为web资源文件夹：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%A1%B9%E7%9B%AE%E6%89%BE%E4%B8%8D%E5%88%B0-jsp-%E6%96%87%E4%BB%B6%EF%BC%9A"><span class="toc-number">1.10.3.3.</span> <span class="toc-text">3. 项目找不到 jsp 文件：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot-%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.11.</span> <span class="toc-text">SpringBoot 任务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.11.1.</span> <span class="toc-text">异步任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%82%AE%E4%BB%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.11.2.</span> <span class="toc-text">邮件任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.11.3.</span> <span class="toc-text">定时任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WebSocket"><span class="toc-number">1.11.4.</span> <span class="toc-text">WebSocket</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96%EF%BC%9A"><span class="toc-number">1.11.4.1.</span> <span class="toc-text">添加依赖：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Server%EF%BC%88%E6%9C%8D%E5%8A%A1%E7%AB%AF%EF%BC%89%EF%BC%9A"><span class="toc-number">1.11.4.2.</span> <span class="toc-text">Server（服务端）：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Client%EF%BC%88%E5%AE%A2%E6%88%B7%E7%AB%AF%EF%BC%89%EF%BC%9A"><span class="toc-number">1.11.4.3.</span> <span class="toc-text">Client（客户端）：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97"><span class="toc-number">1.12.</span> <span class="toc-text">日志</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/04/29/java/springboot/SpringSecurity/" title="SpringSecurity"><img src="https://www.ruoxijun.top/getRandomImageR2?_r_=50921c90-c577-0c73-1e9f-153cc3a425ca" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringSecurity"/></a><div class="content"><a class="title" href="/2023/04/29/java/springboot/SpringSecurity/" title="SpringSecurity">SpringSecurity</a><time datetime="2023-04-29T02:10:14.000Z" title="Created 2023-04-29 10:10:14">2023-04-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/04/29/java/springboot/mybatisplus/" title="MyBatis-Plus"><img src="https://www.ruoxijun.top/getRandomImageR2?_r_=6fef2cb2-2e14-a532-192e-39ff78f9ed3a" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MyBatis-Plus"/></a><div class="content"><a class="title" href="/2023/04/29/java/springboot/mybatisplus/" title="MyBatis-Plus">MyBatis-Plus</a><time datetime="2023-04-29T02:10:14.000Z" title="Created 2023-04-29 10:10:14">2023-04-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/04/20/interest/Arduino/" title="Arduino"><img src="https://www.ruoxijun.top/getRandomImageR2?_r_=5d562a5c-0dc6-79ed-67b4-3cee595a5d41" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Arduino"/></a><div class="content"><a class="title" href="/2023/04/20/interest/Arduino/" title="Arduino">Arduino</a><time datetime="2023-04-20T12:43:00.000Z" title="Created 2023-04-20 20:43:00">2023-04-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/04/15/interest/Termux/" title="ZeroTermux"><img src="https://www.ruoxijun.top/getRandomImageR2?_r_=1fca17e0-a5e1-1bfb-5439-2e85a92c0268" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ZeroTermux"/></a><div class="content"><a class="title" href="/2023/04/15/interest/Termux/" title="ZeroTermux">ZeroTermux</a><time datetime="2023-04-15T12:45:00.000Z" title="Created 2023-04-15 20:45:00">2023-04-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/04/02/interest/%E4%BA%91%E5%8E%9F%E7%94%9F/" title="云原生"><img src="https://www.ruoxijun.top/getRandomImageR2?_r_=a7fb4d43-d179-dd02-fce2-3495ecb01da8" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="云原生"/></a><div class="content"><a class="title" href="/2023/04/02/interest/%E4%BA%91%E5%8E%9F%E7%94%9F/" title="云原生">云原生</a><time datetime="2023-04-02T02:04:00.000Z" title="Created 2023-04-02 10:04:00">2023-04-02</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><img class="workSituationImg boardsign" src="https://bu.dusays.com/2021/01/15/078d1936ddf32.png" alt="大佬带我~" title="大佬带我~"/><div id="runtimeTextTip"></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="ruoxijun" target="_blank">ruoxijun</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = []
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" href="https://ruoxijun.top/" title="湘ICP备-不备案号">湘ICP备-不备案号</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">Articles</div><div class="length-num">48</div></a><a href="/tags/" title="tag"><div class="headline">Tags</div><div class="length-num">117</div></a><a href="/categories/" title="category"><div class="headline">Categories</div><div class="length-num">10</div></a></div><span class="sidebar-menu-item-title">Function</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="Display Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>Display Mode</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://ruoxijun.top/" title="博客"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" href="https://ruoxijun.top/" title="其它"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="其它"/><span class="back-menu-item-text">其它</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> Article</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-box-archive"></use></svg><span> Tunnel</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-shapes"></use></svg><span> Classification</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-tags"></use></svg><span> Label</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> Friend</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-link"></use></svg><span> Friends account</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-artstation"></use></svg><span> Moments</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-envelope"></use></svg><span> Message board</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> My</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-music"></use></svg><span> Music Hall</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/bangumis/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-bilibili1"></use></svg><span> Chasing</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-images"></use></svg><span> Album Set</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-fan"></use></svg><span> Conditioning</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/about/"><svg class="icon faa-tada" aria-hidden="true"><use xlink:href="#icon-zhifeiji"></use></svg><span> About</span></a></div></div><span class="sidebar-menu-item-title">标签</span></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("04/01/2021 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "https://bu.dusays.com/2021/01/15/078d1936ddf32.png";
        img.title = "嘿嘿~";
        img.alt = "嘿嘿~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'http://43.142.114.172:8080/',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'http://43.142.114.172:8080/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><script>(() => {
  const initWaline = () => {
    const waline = Waline.init(Object.assign({
      el: '#waline-wrap',
      serverURL: 'https://blog-waline-b3qy7x4i1-ruoxijun.vercel.app/',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      path: window.location.pathname,
      comment: true,
    }, {"pageSize":10,"requiredMeta":["nick","mail"],"login":"enable","copyright":true,"locale":{"admin":"若惜君","sofa":"好像什么都没有诶~~~","placeholder":"悄悄的说句话~~~"}}))
  }

  const loadWaline = async () => {
    if (typeof Waline === 'object') initWaline()
    else {
      await getCSS('https://cdn.cbd.int/@waline/client@2.15.5/dist/waline.css')
      await getScript('https://cdn.cbd.int/@waline/client@2.15.5/dist/waline.js')
      initWaline()
    }
  }

  if ('Twikoo' === 'Waline' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[image]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[link]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[code]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'http://43.142.114.172:8080/',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "Unable to get the data, please make sure the settings are correct."
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += 'No Comment'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: true,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', 'G-7JZFCVWT7S', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>